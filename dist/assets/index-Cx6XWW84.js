import{r as c,u as ke,o as Ie,e as V,f as G,g as A,j as e,L as I,h as Y,k as me,l as Z,n as k,V as P,p as H,M as Pe,U as De,H as Le,S as Re,q as Fe,s as Oe,t as Me,D as Ae,O as Ue,v as ee,x as Te,y as ue,C as qe,A as $e,Z as ze,z as Be,P as Ve,B as Ge,E as He,F as We,G as Je,I as Qe,J as Ke,K as Xe,N as xe,Q as Ye,R as Ze,T as et,W as D,X as tt,Y as st,_ as rt,$ as v,a0 as nt,a1 as at,a2 as ot,a3 as it,a4 as lt}from"./react-BSMgPWLp.js";import{D as fe,P as pe,_ as ct}from"./pdf-CShKmQ_n.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=r(o);fetch(o.href,n)}})();const he=c.createContext(void 0),W=()=>{const t=c.useContext(he);if(!t)throw new Error("useSession debe ser usado dentro de un SessionProvider");return t};function J(t,s){const r=ke({resolver:Ie(t),defaultValues:s==null?void 0:s.defaultValues});return{...r,handleSubmit:(o,n)=>r.handleSubmit(o,i=>{n&&n(i)})}}class B extends Error{constructor(s){super(s),this.name="ApiError"}}class dt extends Error{constructor(){super("No hay conexión a internet 😵"),this.name="InternetError"}}class mt extends Error{constructor(){super("No hay conexión con el servicio 😵"),this.name="InternetError"}}class ut extends Error{constructor(){super("Error en la comunicacion con el servicio 😢"),this.name="SyntaxJsonError"}}const xt=()=>{const t=localStorage.getItem("session");if(!t)return null;const{token:s}=JSON.parse(t),r=new Date;return localStorage.setItem("last_token_used",r.toISOString()),s},te=async(t,s)=>{try{const r=xt();return await fetch(t,{...s,headers:{...s==null?void 0:s.headers,...r&&{Authorization:r}}})}catch(r){throw r instanceof TypeError?new mt:r}},se=(...t)=>{const s=new RegExp("^/+"),r=new RegExp("/+$");return t.map(a=>a.replace(s,"").replace(r,"")).filter(Boolean).join("/")},F="http://192.16.0.15:7771/",re="http://192.16.0.10:8765/",ne=async({baseUrl:t,path:s,method:r,body:a,abortSignal:o,fullResponse:n=!1})=>{const i=await te(se(t??re,s),{method:r,headers:{"Content-Type":"application/json"},...a?{body:JSON.stringify(a)}:{},signal:o}),d=await i.json();if(!i.ok){const m=typeof(d==null?void 0:d.message)=="string"?d.message:"Unexpected error";throw new B(m)}return n?d:d.data},ge=async t=>{try{const s=await te(se(t.baseUrl??re,t.path),{method:t.method??"GET",headers:{"Content-Type":"application/json"},...t.body?{body:JSON.stringify(t.body)}:{},signal:t.abortSignal});if(!s.ok){const d=await s.json(),m=typeof(d==null?void 0:d.message)=="string"?d.message:"Unexpected error";throw new B(m)}const r=s.body;if(!r)throw new B("Archivo no encontrado");const a=r.getReader(),o=parseInt(s.headers.get("Content-Length")??"");let n=0;const i=[];for(;;){const{done:d,value:m}=await a.read();if(d)break;i.push(m),n+=m.length,t.progress(Math.round(n/o*100))}return new Blob(i)}catch(s){throw s instanceof SyntaxError?new ut:s instanceof TypeError?new dt:s}},$=t=>ne({...t,method:"GET"}),z=t=>ne({...t,method:"POST"}),ft=t=>ne({...t,method:"PUT"}),pt=async({baseUrl:t,path:s,body:r,method:a="POST",abortSignal:o})=>{const n=await te(se(t??re,s),{method:a,body:r,signal:o}),i=await n.json();if(!n.ok){const d=i.message;throw new B(d)}return i.data},ae={login:async t=>await z({baseUrl:F,path:"/v1/global/login",body:t}),register:async t=>await z({baseUrl:F,path:"/v1/global/users",body:{username:t.dni,first_name:t.first_name,last_name_paterno:t.last_name_paterno,last_name_materno:t.last_name_materno,email:t.email,phone:t.phone,gender:t.gender,password:t.new_password,origin_request:window.location.origin}}),recoverAccount:async t=>await z({baseUrl:F,path:"/v1/global/users/post/recovery/email",body:{dni:t,origin_request:window.location.origin}})},be="Este campo es requerido",ht="Introduce una dirección de correo electrónico válida",gt="El correo electrónico es obligatorio",bt="Introduce un número de celular válido",je=t=>{if(t==null)return null;if(typeof t!="string")return t;const s=t.trim();return s===""?null:s},w=(t=be)=>V().transform(je).required(t),K=()=>V().transform(je).nullable().default(null),ye=(t=gt)=>V().email(ht).required(t),jt=/^(?:\+51)\s?[0-9]{3}\s?[0-9]{3}\s?[0-9]{3}$/,yt=t=>{if(t==null)return null;if(typeof t!="string")return t;const s=t.trim().replace(/\s+/g,"");return s===""?null:s.startsWith("+")?s:`+51 ${s}`},we=(t=bt)=>V().transform(yt).test("valid-phone",t,s=>s==null||s===""?!0:jt.test(s)).required(be),wt=G({username:w("DNI requerido").min(7,"El DNI debe tener al menos 7 caracteres").max(10,"El DNI no debe superar los 10 caracteres"),password:w("Contraseña requerida").min(6,"La contraseña debe tener al menos 6 caracteres")}),Nt=()=>{const{login:t}=W(),s=A({mutationFn:ae.login,onSuccess:o=>t(o),onError:()=>Y.error("Error al iniciar sesión")}),r=J(wt,{defaultValues:{username:"",password:""}}),a=r.handleSubmit(({password:o,username:n})=>{s.mutate({password:o??"",username:n??""})});return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-sm bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Iniciar sesión"}),e.jsx("p",{className:"text-base-content/70 text-sm mt-1",children:"Ingresa tus credenciales para continuar"})]}),e.jsxs("form",{onSubmit:a,className:"space-y-5",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"DNI"})}),e.jsx("input",{type:"text",placeholder:"Ingresa tu DNI",className:"input input-bordered w-full",...r.register("username")}),r.formState.errors.username&&e.jsx("p",{className:"text-error text-xs mt-1",children:r.formState.errors.username.message})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"Contraseña"})}),e.jsx("input",{type:"password",placeholder:"Ingresa tu contraseña",className:"input input-bordered w-full",...r.register("password")}),r.formState.errors.password&&e.jsx("p",{className:"text-error text-xs mt-1",children:r.formState.errors.password.message})]}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-block",disabled:r.formState.isSubmitting,children:s.isPending?"Iniciando...":"Iniciar"})]}),e.jsxs("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300 space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{children:"¿Aún no tienes cuenta? "}),e.jsx(I,{to:"/register",className:"link link-primary font-semibold",children:"Regístrate"})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{children:"¿Olvidaste tu contraseña? "}),e.jsx(I,{to:"/recover",className:"link link-primary font-semibold",children:"Recuperar cuenta"})]})]})]})})},S=({label:t,error:s,registration:r,placeholder:a,...o})=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{className:"font-medium",children:t}),e.jsx("input",{...r,...o,className:"input input-bordered w-full",placeholder:a}),s&&e.jsx("p",{className:"text-xs text-error mt-1",children:s.message})]}),Ne=({label:t,options:s,error:r,registration:a,...o})=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{className:"font-medium",children:t}),e.jsxs("select",{...a,...o,className:"select select-bordered w-full",children:[e.jsx("option",{value:"",children:"Selecciona una opción"}),s.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))]}),r&&e.jsx("p",{className:"text-xs text-error mt-1",children:r.message})]}),O=({label:t,error:s,registration:r,...a})=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{className:"font-medium",children:t}),e.jsx("input",{type:"password",...r,...a,className:"input input-bordered w-full"}),s&&e.jsx("p",{className:"text-xs text-error mt-1",children:s.message})]}),vt=G({dni:w().min(7,"El DNI debe tener al menos 7 caracteres").max(10,"El DNI no debe superar los 10 caracteres"),first_name:w("Nombre requerido"),last_name_paterno:w("Apellido paterno requerido"),last_name_materno:w("Apellido materno requerido"),email:ye("Correo requerido"),phone:we("Debe ser un número de celular válido de 9 dígitos"),gender:w("Género requerido").oneOf(["f","m"],"Selecciona un género válido"),new_password:w().min(8,"La contraseña debe tener al menos 8 caracteres"),confirm_password:w().oneOf([me("new_password")],"Las nuevas contraseñas no coinciden")}),St=()=>{const t=Z(),[s,r]=c.useState(1),a=J(vt),o=A({mutationFn:ae.register,onSuccess:()=>{P.success("Usuario registrado con éxito"),t("/login",{replace:!0})},onError:()=>P.error("Error al registrar el usuario")}),n=async()=>{await a.trigger(["first_name","last_name_materno","last_name_paterno","gender"])&&r(2)},i=a.handleSubmit(d=>o.mutate(d));return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-md bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Crear cuenta"}),e.jsx("p",{className:"text-base-content/70 text-sm mt-1",children:"Completa el formulario para registrarte"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("ul",{className:"steps flex",children:[e.jsx("li",{className:k("step",{"step-primary":s>0}),onClick:()=>r(1)}),e.jsx("li",{className:k("step",{"step-primary":s>1})})]})}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[s===1&&e.jsxs(e.Fragment,{children:[e.jsx(S,{label:"Nombre",registration:a.register("first_name"),error:a.formState.errors.first_name}),e.jsx(S,{label:"Apellido paterno",registration:a.register("last_name_paterno"),error:a.formState.errors.last_name_paterno}),e.jsx(S,{label:"Apellido materno",registration:a.register("last_name_materno"),error:a.formState.errors.last_name_materno}),e.jsx(Ne,{label:"Género",registration:a.register("gender"),error:a.formState.errors.gender,options:[{label:"Femenino",value:"f"},{label:"Masculino",value:"m"}]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{type:"button",onClick:n,className:"btn btn-primary",children:"Siguiente"})})]}),s===2&&e.jsxs(e.Fragment,{children:[e.jsx(S,{label:"DNI",registration:a.register("dni"),error:a.formState.errors.dni}),e.jsx(S,{label:"Correo electrónico",registration:a.register("email"),error:a.formState.errors.email}),e.jsx(S,{label:"Teléfono",registration:a.register("phone"),error:a.formState.errors.phone}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(O,{label:"Contraseña",registration:a.register("new_password"),error:a.formState.errors.new_password}),e.jsx(O,{label:"Confirmar contraseña",registration:a.register("confirm_password"),error:a.formState.errors.confirm_password})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Crear cuenta"})})]})]}),e.jsxs("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300",children:[e.jsx("span",{children:"¿Ya tienes cuenta? "}),e.jsx(I,{to:"/login",replace:!0,className:"link link-primary font-semibold",children:"Inicia sesión"})]})]})})},_t=G({dni:w().min(7,"El DNI debe tener al menos 7 caracteres").max(10,"El DNI no debe superar los 10 caracteres")}),Ct=()=>{var a;const t=J(_t),s=A({mutationFn:ae.recoverAccount,onError:()=>P.error("Hubo un problema al enviar el correo con las instrucciones. Intenta nuevamente"),onSuccess:()=>t.reset()}),r=t.handleSubmit(o=>s.mutate(o.dni));return s.isSuccess?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-sm bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Recuperar cuenta"}),e.jsxs("p",{className:"text-base-content/70 text-sm mt-1",children:["Se envió un correo con las instrucciones a ",e.jsx("span",{className:"font-bold",children:(a=s.data)==null?void 0:a.email})]})]}),e.jsx("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300",children:e.jsx(I,{to:"/login",replace:!0,className:"link link-primary font-semibold",children:"Iniciar sesión"})})]})}):e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-sm bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Recuperar cuenta"}),e.jsx("p",{className:"text-base-content/70 text-sm mt-1",children:"Ingresa tu DNI para recuperar tu cuenta"})]}),e.jsxs("form",{onSubmit:r,className:"space-y-5",children:[e.jsx(S,{label:"DNI",registration:t.register("dni"),error:t.formState.errors.dni}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-block",disabled:s.isPending,children:s.isPending?"Enviando...":"Enviar instrucciones"})]}),e.jsxs("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300",children:[e.jsx("span",{children:"¿Ya recordaste tu contraseña? "}),e.jsx(I,{to:"/login",replace:!0,className:"link link-primary font-semibold",children:"Iniciar sesión"})]})]})})},ve=c.createContext(void 0),Se=()=>{const t=c.useContext(ve);if(!t)throw new Error("useModal debe ser usado dentro de un ModalProvider");return t},_e=()=>{const[t,s]=c.useState(window.innerWidth<768);return c.useEffect(()=>{const r=()=>{s(window.innerWidth<768)};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),{isMobile:t}},Et=()=>{var l,u,x;const t=H(),{openModal:s}=Se(),{user:r,logout:a}=W(),{isMobile:o}=_e(),[n,i]=c.useState(!o),d=async()=>{await s("Cerrar sesión","¿Estás seguro de que quieres cerrar sesión?")&&a()},m=()=>{o&&i(!1)};return e.jsxs("div",{className:"min-h-screen flex flex-col md:grid md:grid-cols-[250px_1fr] bg-base-200",children:[o&&e.jsxs("div",{className:"flex items-center justify-between bg-base-100 p-4",children:[e.jsx("button",{onClick:()=>i(!n),className:"btn btn-ghost",children:e.jsx(Pe,{className:"w-6 h-6"})}),e.jsx("div",{className:"text-lg font-bold",children:"Dashboard"})]}),(n||!o)&&e.jsxs("aside",{className:"bg-base-100 border-b md:border-b-0 md:border-r border-base-300 p-4 flex flex-col space-y-6 md:static absolute w-full md:w-auto z-50",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[(l=r==null?void 0:r.user_info)!=null&&l.avatarUrl?e.jsx("img",{src:r.user_info.avatarUrl,alt:"Avatar",className:"w-20 h-20 md:w-24 md:h-24 rounded-full object-cover mb-2"}):e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-full bg-base-300 flex items-center justify-center mb-2",children:e.jsx(De,{className:"w-10 h-10 md:w-12 md:h-12 text-base-content/70"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-base md:text-lg",children:((u=r==null?void 0:r.user_info)==null?void 0:u.username)??""}),e.jsx("p",{className:"text-xs md:text-sm text-base-content/70",children:((x=r==null?void 0:r.user_info)==null?void 0:x.first_name)??""})]})]}),e.jsxs("nav",{className:"flex flex-col items-start gap-2",children:[e.jsxs(I,{to:"/dashboard",onClick:m,className:`btn btn-ghost justify-start w-full ${t.pathname==="/dashboard"?"btn-active":""}`,children:[e.jsx(Le,{className:"w-5 h-5 mr-2"})," Inicio"]}),e.jsxs(I,{to:"/dashboard/documentos/firmar",onClick:m,className:`btn btn-ghost justify-start w-full ${t.pathname==="/dashboard/documentos/firmar"?"btn-active":""}`,children:[e.jsx(Re,{className:"w-5 h-5 mr-2"})," ",e.jsx("span",{className:"text-start",children:"Documentos por Firmar"})]}),e.jsxs(I,{to:"/dashboard/signature",onClick:m,className:`btn btn-ghost justify-start w-full ${t.pathname==="/dashboard/signature"?"btn-active":""}`,children:[e.jsx(Fe,{className:"w-5 h-5 mr-2"})," Firma"]}),e.jsxs(I,{to:"/dashboard/perfil",onClick:m,className:`btn btn-ghost justify-start w-full ${t.pathname==="/dashboard/perfil"?"btn-active":""}`,children:[e.jsx(Oe,{className:"w-5 h-5 mr-2"})," Mi Perfil"]}),e.jsxs("button",{onClick:()=>{m(),d()},className:"btn btn-ghost text-error justify-start w-full",children:[e.jsx(Me,{className:"w-5 h-5 mr-2"})," Cerrar Sesión"]})]})]}),e.jsx(Ae,{className:"flex-1 overflow-y-auto",children:e.jsx(Ue,{})})]})},oe={updateProfile:async t=>(console.log(t),await ft({baseUrl:F,path:"/v1/global/users/session",body:t})),getProfile:async()=>$({baseUrl:F,path:"/v1/global/users/session"})},kt=G({first_name:w("Nombre requerido"),last_name_paterno:w("Apellido paterno requerido"),last_name_materno:w("Apellido materno requerido"),email:ye("Correo requerido"),phone:we("Debe ser un número de celular válido de 9 dígitos"),gender:w("Género requerido").oneOf(["f","m"],"Selecciona un género válido"),current_password:K(),new_password:K(),confirm_password:K().oneOf([me("new_password")],"Las nuevas contraseñas no coinciden")}),It=()=>{const t=A({mutationFn:oe.updateProfile,onSuccess:()=>{Y.success("Perfil actualizado exitosamente"),s.setValue("current_password",""),s.setValue("new_password",""),s.setValue("confirm_password","")},onError:()=>Y.error("Error al actualizar el perfil")}),s=J(kt),{isLoading:r,isError:a,data:o,refetch:n}=ee({queryKey:["profile"],queryFn:oe.getProfile});c.useEffect(()=>{o!=null&&s.reset({email:o.email,first_name:o.first_name,gender:o.gender,last_name_materno:o.last_name_materno,last_name_paterno:o.last_name_paterno,phone:o.phone,current_password:"",new_password:"",confirm_password:""})},[o]);const i=d=>t.mutate(d);return r?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("span",{className:"loading loading-spinner loading-lg"})}):a?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen space-y-4",children:[e.jsx("p",{className:"text-lg font-semibold text-error",children:"No se pudo cargar tu perfil."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>n(),children:"Reintentar"})]}):e.jsxs("div",{className:"flex flex-col w-full h-full px-4 md:px-10 py-8 space-y-10",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Mi Perfil"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Actualiza tu información personal"})]}),e.jsxs("form",{onSubmit:s.handleSubmit(i),className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(S,{label:"Nombre",registration:s.register("first_name"),error:s.formState.errors.first_name}),e.jsx(S,{label:"Apellido paterno",registration:s.register("last_name_paterno"),error:s.formState.errors.last_name_paterno}),e.jsx(S,{label:"Apellido materno",registration:s.register("last_name_materno"),error:s.formState.errors.last_name_materno}),e.jsx(S,{label:"Correo electrónico",registration:s.register("email"),error:s.formState.errors.email}),e.jsx(S,{label:"Teléfono",registration:s.register("phone"),error:s.formState.errors.phone}),e.jsx(Ne,{label:"Género",registration:s.register("gender"),error:s.formState.errors.gender,options:[{label:"Femenino",value:"f"},{label:"Masculino",value:"m"}]}),e.jsxs("div",{className:"md:col-span-2 pt-8 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Cambio de contraseña"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completa los campos si deseas actualizar tu contraseña."})]}),e.jsx(O,{label:"Contraseña actual",registration:s.register("current_password"),error:s.formState.errors.current_password}),e.jsx(O,{label:"Nueva contraseña",registration:s.register("new_password"),error:s.formState.errors.new_password}),e.jsx(O,{label:"Confirmar nueva contraseña",registration:s.register("confirm_password"),error:s.formState.errors.confirm_password})]}),e.jsx("div",{className:"md:col-span-2 flex justify-end",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:s.formState.isSubmitting,children:s.formState.isSubmitting?"Guardando...":"Guardar cambios"})})]})]})},M={getDocumentoResumen:async(t,s,r)=>$({path:`/api/v1/public/documentos/${t}/${s}`,abortSignal:r}),getDocumentos:async t=>$({path:"/api/v1/public/documentos",abortSignal:t}),downloadPdf:async(t,s)=>await ge({path:`/api/v1/procesos/documentos/download/${t}`,progress:r=>s==null?void 0:s(r)}),signPDF:async t=>$({path:`/api/v1/public/sign/documento/${t}`}),logOpenLink:async t=>{await z({path:"/api/v1/public/_open_link/event",body:{record_codigo:t.codigo,empresa:t.empresa,method:t.metodo,referer:t.referencia}})}},Pt=function(){const t=document.createElement("a");return function(s,r){const a=window.URL.createObjectURL(r);t.href=a,t.download=s,t.click(),window.URL.revokeObjectURL(a)}}(),Dt=()=>{const t=H(),{openModal:s}=Se(),{isMobile:r}=_e();let a=Te();a??(a=window.innerHeight);const o=Z(),{pdfname:n,estado:i}=ue(),[d,m]=c.useState(i==="published"),[l,u]=c.useState(!0),[x,p]=c.useState(null),[b,_]=c.useState(null),[C,E]=c.useState(null),[R,L]=c.useState(1),j=c.useRef(!1),y=A({mutationFn:M.signPDF,onSuccess:()=>{P.success("Documento firmado correctamente."),m(!1)},onError:h=>P.error(`Error al firmar el documento: ${h.message}`)}),N=async()=>{if(!n){alert("No se ha seleccionado ningún documento para firmar.");return}await s("Confirmar Firma","¿Estás seguro de que deseas firmar este documento?")&&y.mutate(n)};return c.useEffect(()=>{j.current||(j.current=!0,(async()=>{if(n==null){p("No PDF name provided"),u(!1);return}try{const h=await M.downloadPdf(n);_(new File([h],n,{type:"application/pdf"})),u(!1)}catch(h){p(h instanceof Error?h.message:"An unknown error occurred"),u(!1)}})())},[n]),l?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):x!=null?e.jsxs("div",{className:"flex items-center justify-center h-screen text-red-500",children:["Error: ",typeof x=="string"?x:x.message]}):b==null?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Unable to load PDF."}):e.jsxs("div",{className:k("w-full relative bg-base-100"),style:{height:r?a-72:a},children:[e.jsxs("div",{className:"absolute bg-black/20 w-full h-10 top-0 flex justify-between items-center px-4 z-10",children:[e.jsx(qe,{className:"w-5 h-5 cursor-pointer select-none",onClick:()=>{var h;if(console.log(t.state),((h=t.state)==null?void 0:h.from)==="_link"){o("/dashboard",{replace:!0});return}o(-1)}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>Pt(b.name,b),children:e.jsx($e,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-2"}),e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>L(h=>Math.min(h+.1,3)),children:e.jsx(ze,{className:"w-5 h-5"})}),e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>L(h=>Math.max(h-.1,.5)),children:e.jsx(Be,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-auto flex flex-col items-center gap-4 h-full pt-10",children:e.jsx(fe,{file:b,onLoadSuccess:({numPages:h})=>E(h),loading:"Loading PDF...",error:"Error while loading PDF",className:"flex flex-col items-center w-full",children:Array.from(new Array(C),(h,U)=>e.jsx(pe,{pageNumber:U+1,width:r?window.innerWidth:800,scale:R,className:"shadow-md rounded-lg border border-base-300"},`page_${U+1}`))})}),d&&e.jsx("div",{className:"absolute bottom-0 h-20 w-full flex justify-center items-center gap-4 z-[9999]",children:e.jsx("button",{className:"btn btn-primary flex items-center gap-2",onClick:N,disabled:l,children:y.isPending?e.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Firmando..."})}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Firmar Documento"}),e.jsx(Ve,{})]})})})]})},ie=800;function Lt(){const[t,s]=c.useState("./sample.pdf"),[r,a]=c.useState(),[o]=c.useState(),n=d=>{var l;const m=(l=d.target.files)==null?void 0:l[0];m&&s(m)},i=({numPages:d})=>{a(d)};return e.jsxs("div",{children:[e.jsx("header",{children:e.jsx("h1",{children:"react-pdf sample"})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"file",children:"Load PDF:"}),e.jsx("input",{type:"file",onChange:n}),e.jsx("div",{style:{border:"2px solid #000",padding:"10px"},children:e.jsx(fe,{file:t,onLoadSuccess:i,children:Array.from({length:r??0},(d,m)=>e.jsx(pe,{pageNumber:m+1,width:o?Math.min(o,ie):ie},m))})})]})]})}const Rt=({initialOffset:t=0,initialLimit:s=1,total:r,onUpdate:a})=>{const[o,n]=c.useState(t),[i,d]=c.useState(s),[m,l]=c.useState(!1),[u,x]=c.useState(""),p=c.useRef(null),b=o+1,_=Math.min(o+i,r),C=i>1?`${b}-${_}`:`${b}`;c.useEffect(()=>{const f=g=>{p.current&&!p.current.contains(g.target)&&y()};return m&&document.addEventListener("mousedown",f,{capture:!0}),()=>document.removeEventListener("mousedown",f)},[m]);const E=(f,g,T)=>Math.max(Math.min(f,T),g),R=f=>{const[g,T]=f.trim().split(/[-,;\s]+/);let q=parseInt(g,10),Q=T?parseInt(T,10):q;return q=E(q,1,r),Q=E(Q,1,r),{minimum:q-1,maximum:Q}},L=(f,g)=>{n(f),d(g),a({offset:f,limit:g}),l(!1)},j=f=>{let g=o+i*f;g>=r?g=0:g<0&&i===1?g=r-1:g<0&&i>1&&(g=r-(r%i||i)),L(g,i)},y=()=>{const{minimum:f,maximum:g}=R(u);!isNaN(f)&&!isNaN(g)&&f<g?L(f,g-f):l(!1)},N=f=>{x(f.target.value)},h=f=>{f.key==="Enter"?(f.preventDefault(),y()):f.key==="Escape"&&(f.preventDefault(),l(!1))},U=()=>{m||(x(C),l(!0),setTimeout(()=>{var f;return(f=p.current)==null?void 0:f.focus()},0))};return e.jsxs("nav",{className:"flex gap-2 h-full items-center my-2","aria-label":"Pager",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[m?e.jsx("input",{ref:p,type:"text",className:"text-sm h-5 p-0 m-0 text-end outline-none input-sm",value:u,onBlur:y,onChange:N,onKeyDown:h}):e.jsx("span",{className:"text-sm border-transparent cursor-pointer",onClick:U,children:C}),e.jsx("span",{className:"text-sm",children:"/"}),e.jsx("span",{className:"text-sm",children:r})]}),e.jsxs("span",{className:"btn-group flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm","aria-label":"Previous",onClick:()=>j(-1),children:e.jsx(Ge,{})}),e.jsx("button",{type:"button",className:"btn btn-sm","aria-label":"Next",onClick:()=>j(1),children:e.jsx(He,{})})]})]})},Ft=({table:t})=>e.jsx("thead",{className:"bg-gray-200 dark:bg-gray-800 border-b border-gray-300 dark:border-gray-700",children:t.getHeaderGroups().map(s=>e.jsx("tr",{children:s.headers.map(r=>{var a,o;return e.jsx("th",{className:k("px-4 py-3 font-semibold text-xs text-gray-600 dark:text-gray-200 uppercase tracking-wider",{"text-left":r.column.id!=="actions","text-center":r.column.id==="actions","text-right":["amount","price"].includes(r.column.id)}),children:r.isPlaceholder?null:typeof r.column.columnDef.header=="string"?r.column.columnDef.header:(o=(a=r.column.columnDef).header)==null?void 0:o.call(a,r.getContext())},r.id)})},s.id))}),Ot=({error:t,onRetry:s,columns:r})=>e.jsx("tr",{children:e.jsxs("td",{colSpan:r.length,className:"p-6 text-center text-red-500 dark:text-red-400",children:[e.jsx("div",{children:typeof t=="string"?t:t.message}),s&&e.jsx("button",{onClick:s,className:"mt-2 px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/80",children:"Intentar nuevamente"})]})}),Ce=c.createContext(null),Mt=()=>{const t=c.useContext(Ce);if(!t)throw new Error("useContextMenu must be used inside ContextMenuProvider");return t};function At({table:t,onRowClick:s,onRowDoubleClick:r,contextMenuAcctions:a}){const o=c.useRef(null),{openContextMenu:n}=Mt(),[i,d]=c.useState(null),m=(l,u)=>x=>{if(a==null)return;let p=[];typeof a=="function"?p=a(l):p=a,p.length!==0&&(d(u),n(x,p,l))};return e.jsx(e.Fragment,{children:t.getRowModel().rows.map(l=>{const u=l.id;return e.jsx("tr",{onClick:()=>{d(u),s==null||s(l.original)},onDoubleClick:()=>r==null?void 0:r(l.original),className:k("hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition-all duration-200 relative",{"bg-primary/10 dark:bg-primary/20":l.getIsSelected(),"bg-primary/5 dark:bg-primary/10":i===u&&!l.getIsSelected(),"after:content-[''] after:absolute after:inset-y-0 after:left-0 after:w-1 after:bg-primary":i===u}),onContextMenu:x=>m(l.original,u)(x),onTouchStart:x=>{o.current=setTimeout(()=>{m(l.original,u)(x)},500)},onTouchEnd:()=>{o.current&&clearTimeout(o.current)},children:l.getVisibleCells().map(x=>e.jsx("td",{className:k("px-4 py-3 text-sm text-gray-700 dark:text-gray-300 border-b border-gray-200 dark:border-gray-700","select-none",{"text-left":x.column.id!=="actions","text-center":x.column.id==="actions","text-right":["amount","price"].includes(x.column.id)}),children:We(x.column.columnDef.cell,x.getContext())},x.id))},u)})})}function Ut({data:t,columns:s,loading:r=!1,error:a,rowSelectionEnabled:o=!1,onRowClick:n,onRowDoubleClick:i,getRowId:d,onRetry:m,contextMenuAcctions:l}){const[u,x]=c.useState({}),p=Je({data:t,columns:s,state:{rowSelection:u},enableRowSelection:o,getRowId:d?b=>d(b):void 0,getCoreRowModel:Qe(),onRowSelectionChange:x});return e.jsx("div",{className:k("overflow-x-auto border border-gray-200 dark:border-gray-700 rounded-md shadow-lg"),children:e.jsxs("table",{className:"w-full table-auto text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(Ft,{table:p}),e.jsx("tbody",{children:r?e.jsx("tr",{children:e.jsx("td",{colSpan:s.length,className:"p-6 text-center text-gray-500 dark:text-gray-400",children:"Cargando..."})}):a?e.jsx(Ot,{error:a,onRetry:m,columns:s}):e.jsx(At,{table:p,onRowClick:n,onRowDoubleClick:i,contextMenuAcctions:l})})]})})}const Tt=({onSearch:t})=>{const[s,r]=c.useState(""),a=()=>{t&&t(s)},o=n=>{n.key==="Enter"&&a()};return e.jsxs("div",{className:"mb-4 flex justify-center",children:[e.jsxs("div",{className:"relative w-full max-w-xs",children:[e.jsx("input",{type:"text",className:k("w-full","input-sm","pl-10","pr-4","py-2","rounded-md","border","border-gray-300","bg-transparent","text-gray-800","dark:text-gray-200","dark:border-gray-700","dark:focus:ring-0","focus:outline-none","focus:ring-2","focus:ring-gray-400","focus:border-gray-400","dark:focus:ring-gray-500","dark:focus:border-gray-500"),placeholder:"Search...",value:s,onChange:n=>r(n.target.value),onKeyDown:o}),e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 18l6-6-6-6"})})})]}),e.jsx("button",{type:"button",onClick:a,className:k("ml-2","px-2","py-2","btn","btn-sm","h-[36px]","filter-reset","border","border-gray-300","bg-transparent","text-gray-800","dark:text-gray-200","dark:border-gray-700","dark:focus:ring-0","focus:outline-none","focus:ring-2","focus:ring-gray-400","focus:border-gray-400","dark:focus:ring-gray-500","dark:focus:border-gray-500"),children:e.jsx(Ke,{})})]})},qt=t=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.title&&e.jsx("h2",{className:"text-2xl font-semibold",children:t.title}),t.onSearch&&e.jsx(Tt,{onSearch:t.onSearch})]})}),e.jsx(Ut,{...t}),t.pageProps&&e.jsx("div",{className:"flex justify-end",children:e.jsx(Rt,{initialLimit:t.pageProps.initialLimit,initialOffset:t.pageProps.initialOffset,total:t.pageProps.total,onUpdate:t.pageProps.onUpdate})})]}),$t=t=>{const s=Xe();return t(s)},zt=t=>{const s=c.useMemo(()=>["LISTA/DOCUMENTOS",t],[t]),r=xe(),{data:a,error:o,isFetching:n,isError:i}=ee({queryKey:s,queryFn:({signal:m})=>M.getDocumentos(m)});return{documentos:a??[],refresh:()=>r.invalidateQueries({queryKey:s}),isFetching:n,error:o,isError:i}},le=t=>(t??"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();function Bt(t,s){const r=le(String(s??"").trim());return r.length<2?t:t.filter(a=>Object.entries(a).some(([o,n])=>{if(n==null)return!1;let i=le(String(n));return typeof n=="number"&&(i=`#${i}`),o.endsWith("codigo")&&!i.startsWith("#")&&(i=`.${i}`),i.includes(r)}))}const Vt=t=>{const[s,r]=c.useState("");return[c.useMemo(()=>!t||!s.trim()?t??[]:s.split(";").map(n=>n.trim()).filter(Boolean).reduce((n,i)=>Bt(n,i),t),[t,s]),r]},Gt={"01":"Enero","02":"Febrero","03":"Marzo","04":"Abril","05":"Mayo","06":"Junio","07":"Julio","08":"Agosto","09":"Septiembre",10:"Octubre",11:"Noviembre",12:"Diciembre"},Ht=$t(t=>[t.accessor("empresa_descripcion",{header:"Empresa",cell:({getValue:s})=>s()}),t.accessor("descripcion_proceso",{header:"Descripción del Proceso",cell:({getValue:s})=>s()}),t.accessor("anio",{header:"Año",cell:({getValue:s})=>s()}),t.accessor("mes",{header:"Mes",cell:({getValue:s})=>{const r=s();return r==null||typeof r!="string"?r:Gt[r]}}),t.accessor("item",{header:"Semana",cell:({getValue:s})=>s()}),t.accessor("estado",{header:"Estado",cell:({getValue:s})=>{const r=s();let a,o,n;switch(r){case"published":a=e.jsx(et,{className:"w-5 h-5"}),o="bg-green-500 text-white",n="Pendiente";break;case"signed":a=e.jsx(Ze,{className:"w-5 h-5"}),o="bg-blue-500 text-white",n="Firmado";break;case"canceled":a=e.jsx(Ye,{className:"w-5 h-5"}),o="bg-red-500 text-white",n="Cancelado";break;default:a=null,o="bg-gray-500 text-white",n="-"}return e.jsxs("div",{className:`max-w-[150px] grid items-center grid-cols-[1fr_3fr] p-2 rounded-lg ${o} dark:bg-opacity-20`,children:[e.jsx("p",{children:a}),e.jsx("p",{children:n})]})}})]),ce=({tosign:t})=>{const s=Z(),{documentos:r,isFetching:a,error:o,refresh:n}=zt(),i=c.useMemo(()=>t?r.filter(l=>l.estado=="published"):r,[t,r]),[d,m]=Vt(i);return e.jsx("div",{className:"p-4 md:p-8",children:e.jsx(qt,{title:"Lista de documentos",loading:a,error:o,onRetry:n,columns:Ht,data:d,onSearch:m,contextMenuAcctions:l=>[{label:"Ver Documeto",onClick:()=>{if(l.signed_pdf_name){s(`/dashboard/pdf/${l.signed_pdf_name}/${l.estado}`);return}if(l.nombre_pdf){s(`/dashboard/pdf/${l.nombre_pdf}/${l.estado}`);return}}}],onRowDoubleClick:l=>{if(l.signed_pdf_name){s(`/dashboard/pdf/${l.signed_pdf_name}/${l.estado}`);return}if(l.nombre_pdf){s(`/dashboard/pdf/${l.nombre_pdf}/${l.estado}`);return}}})})},Wt=()=>{const{empresa:t,origin:s,record_codigo:r}=ue();return t==null||s==null||r==null?e.jsx(D,{to:"/dashboard",replace:!0}):e.jsx(Jt,{empresa:t,origin:s,record_codigo:r})},Jt=({empresa:t,origin:s,record_codigo:r})=>{const a=c.useRef(!1);c.useEffect(()=>{if(a.current)return;(async()=>{try{await M.logOpenLink({codigo:r,empresa:t,metodo:s,referencia:window.location.href})}catch(x){console.error("Failed to log open link:",x)}finally{a.current=!0}})()},[t,s,r]);const o=c.useMemo(()=>["RESUMEN_INFO_DOC_RECORD",t,s,r],[t,s,r]),n=xe(),{data:i,error:d,isLoading:m}=ee({queryKey:o,queryFn:({signal:u})=>M.getDocumentoResumen(t,r,u)}),l=()=>n.invalidateQueries({queryKey:o});return m?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):d!=null?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen text-red-500",children:[e.jsxs("p",{children:["Error: ",typeof d=="string"?d:d.message]}),e.jsx("button",{onClick:l,className:"mt-4 px-6 py-2 bg-red-600 text-white rounded-lg shadow-md hover:bg-red-700 transition",children:"Retry"})]}):i==null||i.length===0?e.jsx(D,{to:"/dashboard",replace:!0}):i[0].signed_pdf_name?e.jsx(D,{to:`/dashboard/pdf/${i[0].signed_pdf_name}/${i[0].estado}`,replace:!0,state:{from:"_link"}}):i[0].nombre_pdf?e.jsx(D,{to:`/dashboard/pdf/${i[0].nombre_pdf}/${i[0].estado}`,replace:!0,state:{from:"_link"}}):e.jsx("div",{className:"flex flex-col items-center justify-center h-screen text-red-500",children:e.jsx("button",{onClick:l,className:"mt-4 px-6 py-2 bg-red-600 text-white rounded-lg shadow-md hover:bg-red-700 transition",children:"Retry"})})},Qt=async(t,s,r)=>{const a=await Kt(t),o=document.createElement("canvas"),n=a.naturalWidth/a.width,i=a.naturalHeight/a.height,d=r,m=r/2;return o.width=d,o.height=m,o.getContext("2d").drawImage(a,s.x*n,s.y*i,s.width*n,s.height*i,0,0,d,m),new Promise(u=>o.toBlob(x=>u(x),"image/jpeg",.95))},Kt=t=>new Promise((s,r)=>{const a=new Image;a.src=t,a.onload=()=>s(a),a.onerror=r}),Xt="/assets/no_image_placeholder-B4dLisTe.jpg",Ee={getFirmaImange:async t=>ge({abortSignal:t,path:"/api/v1/public/firma/jpg",progress:()=>{}}),uploadFirmaImange:async t=>{const s=new FormData;return s.append("image",t),pt({path:"/api/v1/public/firma/jpg",body:s})}},Yt=()=>{const[t,s]=c.useState(null),r=c.useRef(null),[a,o]=c.useState(!1),[n,i]=c.useState(null),d=async l=>{o(!0),i(null);try{const u=await Ee.getFirmaImange(l);u!=null&&s(URL.createObjectURL(u)),o(!1)}catch(u){u instanceof DOMException&&u.name==="AbortError"||u instanceof Error&&u.message!=="no hay ninguna imagen"&&i(u)}},m=c.useCallback(()=>{const l=new AbortController;r.current=l,d(l.signal)},[]);return c.useEffect(()=>(m(),()=>{var l;(l=r.current)==null||l.abort()}),[m]),a?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):n!=null?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen text-red-500",children:[e.jsxs("p",{children:["Error: ",typeof n=="string"?n:n.message]}),e.jsx("button",{onClick:m,className:"mt-4 px-6 py-2 bg-red-600 text-white rounded-lg shadow-md hover:bg-red-700 transition",children:"Retry"})]}):e.jsx(Zt,{image:t})},Zt=({image:t})=>{const s=c.useRef(null),[r,a]=c.useState(!1),[o,n]=c.useState("view"),[i,d]=c.useState(t),[m,l]=c.useState(null),[u,x]=c.useState({x:0,y:0}),[p,b]=c.useState(1),[_,C]=c.useState(null),E=c.useCallback((j,y)=>{C(y)},[]),R=j=>{var h;const y=(h=j.target.files)==null?void 0:h[0];if(!y)return;const N=new FileReader;N.onload=()=>{l(N.result),n("crop")},N.readAsDataURL(y)},L=async()=>{if(!m||!_)return;const j=await Qt(m,_,860),y=P.loading("Guardando firma...");try{a(!0),await Ee.uploadFirmaImange(j),d(URL.createObjectURL(j)),n("view"),P.success("Firma guardada correctamente",{id:y})}catch(N){const h=typeof N=="string"?N:N instanceof Error?N.message:"Error al guardar la firma";P.error(h,{id:y})}finally{a(!1)}};return e.jsxs("div",{className:"w-full h-full px-4 py-8 flex flex-col items-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Firma"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center max-w-[860px] mb-4",children:"Esta imagen será utilizada como firma visual en los documentos que firmes digitalmente desde el sistema."}),o==="view"&&e.jsxs("div",{className:"w-full max-w-[860px] space-y-4",children:[e.jsxs("div",{className:"relative aspect-[2/1] rounded-lg shadow-2xl bg-white overflow-hidden",children:[e.jsx("img",{src:i||Xt,alt:"Firma",className:"w-full h-full object-contain bg-white"}),e.jsx("label",{htmlFor:"fileInput",className:k("absolute inset-0","flex items-center justify-center","transition duration-200","cursor-pointer")}),e.jsx("input",{ref:s,type:"file",id:"fileInput",accept:"image/png,image/jpeg",onChange:R,className:"hidden"})]}),e.jsx("div",{className:"pt-8 flex justify-center",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{var j;return(j=s.current)==null?void 0:j.click()},children:"Subir Firma"})})]}),o==="crop"&&m&&e.jsxs("div",{className:"w-full max-w-[860px] space-y-4",children:[e.jsx("div",{className:"relative aspect-[2/1] rounded-lg shadow-2xl bg-white overflow-hidden",children:e.jsx(tt,{image:m,crop:u,zoom:p,aspect:2/1,onCropChange:x,onZoomChange:b,onCropComplete:E,restrictPosition:!1,cropShape:"rect",showGrid:!1,style:{containerStyle:{backgroundImage:"linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%)",backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px"},mediaStyle:{backgroundColor:"transparent"}}})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("label",{className:"text-sm font-medium",children:["Zoom: ",p.toFixed(1),"x"]}),e.jsx("input",{type:"range",min:1,max:3,step:.1,value:p,onChange:j=>b(parseFloat(j.target.value)),className:"range range-primary"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-2",children:[e.jsx("button",{className:"btn btn-ghost",onClick:()=>n("view"),children:"Cancelar"}),e.jsx("button",{className:"btn btn-primary disabled:opacity-50",onClick:L,disabled:r,children:r?"Guardando...":"Guardar"})]})]})]})]})},de=({children:t})=>{const s=H(),{user:r}=W(),a=!!r;let o;return s.pathname.startsWith("/_sign/")&&(o={from:s.pathname}),console.log(r),a?t:e.jsx(D,{to:"/login",replace:!0,state:o})},X=({children:t})=>{var o;const{user:s}=W(),r=!!s,a=H();return r?(o=a.state)!=null&&o.from?e.jsx(D,{to:a.state.from,replace:!0}):e.jsx(D,{to:"/dashboard",replace:!0}):t},es=()=>e.jsx(st,{children:e.jsxs(rt,{children:[e.jsx(v,{path:"/login",element:e.jsx(X,{children:e.jsx(Nt,{})})}),e.jsx(v,{path:"/register",element:e.jsx(X,{children:e.jsx(St,{})})}),e.jsx(v,{path:"/recover",element:e.jsx(X,{children:e.jsx(Ct,{})})}),e.jsx(v,{path:"/_sign/:empresa/:record_codigo/:origin",element:e.jsx(de,{children:e.jsx(Wt,{})})}),e.jsxs(v,{path:"/dashboard",element:e.jsx(de,{children:e.jsx(Et,{})}),children:[e.jsx(v,{index:!0,element:e.jsx(ce,{})}),e.jsx(v,{path:"pdf/:pdfname/:estado",element:e.jsx(Dt,{})}),e.jsx(v,{path:"documentos/firmar",element:e.jsx(ce,{tosign:!0})}),e.jsx(v,{path:"perfil",element:e.jsx(It,{})}),e.jsx(v,{path:"signature",element:e.jsx(Yt,{})}),e.jsx(v,{path:"sample",element:e.jsx(Lt,{})})]}),e.jsx(v,{path:"*",element:e.jsx(D,{to:"/login",replace:!0})})]})}),ts=({children:t})=>{const[s,r]=c.useState(()=>{try{const n=localStorage.getItem("session");if(n==null)return null;const i=localStorage.getItem("last_token_used");if(i!=null){const d=new Date(i),m=new Date;if(!isNaN(d.getTime())&&m.getTime()-d.getTime()>18e6)return localStorage.removeItem("session"),null}return n?JSON.parse(n):null}catch(n){return console.error("Error retrieving session data from localStorage",n),null}}),a=n=>{r(n);const i=new Date;localStorage.setItem("last_token_used",i.toISOString()),localStorage.setItem("session",JSON.stringify(n))},o=()=>{r(null),localStorage.removeItem("session")};return e.jsx(he.Provider,{value:{user:s,login:a,logout:o},children:t})},ss=({children:t})=>{const[s,r]=c.useState(!1),[a,o]=c.useState(()=>{}),[n,i]=c.useState("Confirmación"),[d,m]=c.useState("¿Estás seguro de esta acción?"),l=(_,C)=>(r(!0),i(_),m(C),new Promise(E=>o(()=>E))),u=()=>{r(!1)},x=()=>{a(!0),u()},p=()=>{a(!1),u()},b=()=>s?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{className:"bg-base-100 p-6 rounded-lg shadow-lg w-full max-w-sm",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:n}),e.jsx("p",{className:"text-base-content/80 mb-6",children:d}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{className:"btn btn-ghost",onClick:p,children:"Cancelar"}),e.jsx("button",{className:"btn btn-primary",onClick:x,children:"Confirmar"})]})]})}):null;return e.jsx(ve.Provider,{value:{openModal:l},children:e.jsxs(e.Fragment,{children:[e.jsx(b,{}),t]})})},rs=({children:t})=>{const[s,r]=c.useState({isOpen:!1,x:0,y:0,items:[]}),a=c.useCallback((n,i,d)=>{n.preventDefault();let m=0,l=0;"touches"in n&&n.touches.length>0?(m=n.touches[0].clientX,l=n.touches[0].clientY):"clientX"in n&&(m=n.clientX,l=n.clientY);const u=10,x=180,p=200,b=window.innerWidth,_=window.innerHeight;let C=m,E=l;m+x+u>b&&(C=b-x-u),l+p+u>_&&(E=_-p-u),r({isOpen:!0,x:C,y:E,items:i,data:d})},[]),o=c.useCallback(()=>{r(n=>({...n,isOpen:!1}))},[]);return c.useEffect(()=>{const n=()=>{o()};return window.addEventListener("click",n),window.addEventListener("scroll",n),()=>{window.removeEventListener("click",n),window.removeEventListener("scroll",n)}},[o]),e.jsxs(Ce.Provider,{value:{openContextMenu:a,closeContextMenu:o,state:s},children:[t,s.isOpen&&e.jsx("div",{className:"absolute  min-w-[180px] rounded-md shadow-md border border-base-300 bg-base-100 text-base-content z-50 overflow-hidden",style:{top:s.y,left:s.x},onClick:n=>n.stopPropagation(),children:s.items.map((n,i)=>{const d=n.icon,m=n.disabled;return e.jsxs("button",{onClick:()=>{m||n.onClick(s.data),o()},className:`flex items-center gap-2 w-full text-left px-4 py-2 text-sm ${m?"cursor-not-allowed text-base-content/50 hover:bg-transparent":"hover:bg-base-200"}`,disabled:m,children:[d&&e.jsx(d,{className:`w-4 h-4 ${m?"opacity-50":""}`}),e.jsx("span",{className:"select-none",children:n.label})]},i)})})]})};ct.workerSrc=new URL("/assets/pdf.worker.min-GB3t0DcA.mjs",import.meta.url).toString();const ns=new nt;at.createRoot(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsxs(rs,{children:[e.jsx(ot,{}),e.jsx(ss,{children:e.jsxs(it,{client:ns,children:[e.jsx(ts,{children:e.jsx(es,{})}),e.jsx(lt,{initialIsOpen:!1})]})})]})}));
