import{r as c,u as Ie,o as Pe,e as V,f as G,g as U,j as e,L as k,h as Y,k as me,l as Z,n as E,V as I,p as H,M as De,U as Re,H as Le,S as Fe,q as Me,s as Oe,t as Ae,D as Ue,O as Te,v as ee,x as qe,y as ue,C as $e,A as ze,Z as Be,z as Ve,P as Ge,B as He,E as We,F as Je,G as Qe,I as Ke,J as Xe,K as Ye,N as xe,Q as Ze,R as et,T as tt,W as D,X as st,Y as rt,_ as nt,$ as at,a0 as ot,a1 as _,a2 as it,a3 as lt,a4 as ct,a5 as dt,a6 as mt}from"./react-DsJtaBO0.js";import{D as fe,P as he,_ as ut}from"./pdf-AIDK7-hu.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();const pe=c.createContext(void 0),W=()=>{const t=c.useContext(pe);if(!t)throw new Error("useSession debe ser usado dentro de un SessionProvider");return t};function J(t,s){const r=Ie({resolver:Pe(t),defaultValues:s==null?void 0:s.defaultValues});return{...r,handleSubmit:(o,a)=>r.handleSubmit(o,i=>{a&&a(i)})}}class B extends Error{constructor(s){super(s),this.name="ApiError"}}class xt extends Error{constructor(){super("No hay conexión a internet 😵"),this.name="InternetError"}}class ft extends Error{constructor(){super("No hay conexión con el servicio 😵"),this.name="InternetError"}}class ht extends Error{constructor(){super("Error en la comunicacion con el servicio 😢"),this.name="SyntaxJsonError"}}const pt=()=>{const t=localStorage.getItem("session");if(!t)return null;const{token:s}=JSON.parse(t),r=new Date;return localStorage.setItem("last_token_used",r.toISOString()),s},te=async(t,s)=>{try{const r=pt();return await fetch(t,{...s,headers:{...s==null?void 0:s.headers,...r&&{Authorization:r}}})}catch(r){throw r instanceof TypeError?new ft:r}},se=(...t)=>{const s=new RegExp("^/+"),r=new RegExp("/+$");return t.map(n=>n.replace(s,"").replace(r,"")).filter(Boolean).join("/")},M="http://192.16.0.15:7771/",re="http://192.16.0.10:8765/",ne=async({baseUrl:t,path:s,method:r,body:n,abortSignal:o,fullResponse:a=!1})=>{const i=await te(se(t??re,s),{method:r,headers:{"Content-Type":"application/json"},...n?{body:JSON.stringify(n)}:{},signal:o}),m=await i.json();if(!i.ok){const d=typeof(m==null?void 0:m.message)=="string"?m.message:"Unexpected error";throw new B(d)}return a?m:m.data},ge=async t=>{try{const s=await te(se(t.baseUrl??re,t.path),{method:t.method??"GET",headers:{"Content-Type":"application/json"},...t.body?{body:JSON.stringify(t.body)}:{},signal:t.abortSignal});if(!s.ok){const m=await s.json(),d=typeof(m==null?void 0:m.message)=="string"?m.message:"Unexpected error";throw new B(d)}const r=s.body;if(!r)throw new B("Archivo no encontrado");const n=r.getReader(),o=parseInt(s.headers.get("Content-Length")??"");let a=0;const i=[];for(;;){const{done:m,value:d}=await n.read();if(m)break;i.push(d),a+=d.length,t.progress(Math.round(a/o*100))}return new Blob(i)}catch(s){throw s instanceof SyntaxError?new ht:s instanceof TypeError?new xt:s}},$=t=>ne({...t,method:"GET"}),z=t=>ne({...t,method:"POST"}),gt=t=>ne({...t,method:"PUT"}),bt=async({baseUrl:t,path:s,body:r,method:n="POST",abortSignal:o})=>{const a=await te(se(t??re,s),{method:n,body:r,signal:o}),i=await a.json();if(!a.ok){const m=i.message;throw new B(m)}return i.data},ae={login:async t=>await z({baseUrl:M,path:"/v1/global/login",body:t}),register:async t=>await z({baseUrl:M,path:"/v1/global/users",body:{username:t.dni,first_name:t.first_name,last_name_paterno:t.last_name_paterno,last_name_materno:t.last_name_materno,email:t.email,phone:t.phone,gender:t.gender,password:t.new_password,origin_request:window.location.origin}}),recoverAccount:async t=>await z({baseUrl:M,path:"/v1/global/users/post/recovery/email",body:{dni:t,origin_request:window.location.origin}})},be="Este campo es requerido",jt="Introduce una dirección de correo electrónico válida",wt="El correo electrónico es obligatorio",yt="Introduce un número de celular válido",je=t=>{if(t==null)return null;if(typeof t!="string")return t;const s=t.trim();return s===""?null:s},y=(t=be)=>V().transform(je).required(t),K=()=>V().transform(je).nullable().default(null),we=(t=wt)=>V().email(jt).required(t),Nt=/^(?:\+51)\s?[0-9]{3}\s?[0-9]{3}\s?[0-9]{3}$/,vt=t=>{if(t==null)return null;if(typeof t!="string")return t;const s=t.trim().replace(/\s+/g,"");return s===""?null:s.startsWith("+")?s:`+51 ${s}`},ye=(t=yt)=>V().transform(vt).test("valid-phone",t,s=>s==null||s===""?!0:Nt.test(s)).required(be),St=G({username:y("DNI requerido").min(7,"El DNI debe tener al menos 7 caracteres").max(10,"El DNI no debe superar los 10 caracteres"),password:y("Contraseña requerida").min(6,"La contraseña debe tener al menos 6 caracteres")}),_t=()=>{const{login:t}=W(),s=U({mutationFn:ae.login,onSuccess:o=>t(o),onError:()=>Y.error("Error al iniciar sesión")}),r=J(St,{defaultValues:{username:"",password:""}}),n=r.handleSubmit(({password:o,username:a})=>{s.mutate({password:o??"",username:a??""})});return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-sm bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Iniciar sesión"}),e.jsx("p",{className:"text-base-content/70 text-sm mt-1",children:"Ingresa tus credenciales para continuar"})]}),e.jsxs("form",{onSubmit:n,className:"space-y-5",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"DNI"})}),e.jsx("input",{type:"text",placeholder:"Ingresa tu DNI",className:"input input-bordered w-full",...r.register("username")}),r.formState.errors.username&&e.jsx("p",{className:"text-error text-xs mt-1",children:r.formState.errors.username.message})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"Contraseña"})}),e.jsx("input",{type:"password",placeholder:"Ingresa tu contraseña",className:"input input-bordered w-full",...r.register("password")}),r.formState.errors.password&&e.jsx("p",{className:"text-error text-xs mt-1",children:r.formState.errors.password.message})]}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-block",disabled:r.formState.isSubmitting,children:s.isPending?"Iniciando...":"Iniciar"})]}),e.jsxs("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300 space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{children:"¿Aún no tienes cuenta? "}),e.jsx(k,{to:"/register",className:"link link-primary font-semibold",children:"Regístrate"})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{children:"¿Olvidaste tu contraseña? "}),e.jsx(k,{to:"/recover",className:"link link-primary font-semibold",children:"Recuperar cuenta"})]})]})]})})},C=({label:t,error:s,registration:r,placeholder:n,...o})=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{className:"font-medium",children:t}),e.jsx("input",{...r,...o,className:"input input-bordered w-full",placeholder:n}),s&&e.jsx("p",{className:"text-xs text-error mt-1",children:s.message})]}),Ne=({label:t,options:s,error:r,registration:n,...o})=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{className:"font-medium",children:t}),e.jsxs("select",{...n,...o,className:"select select-bordered w-full",children:[e.jsx("option",{value:"",children:"Selecciona una opción"}),s.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),r&&e.jsx("p",{className:"text-xs text-error mt-1",children:r.message})]}),O=({label:t,error:s,registration:r,...n})=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{className:"font-medium",children:t}),e.jsx("input",{type:"password",...r,...n,className:"input input-bordered w-full"}),s&&e.jsx("p",{className:"text-xs text-error mt-1",children:s.message})]}),Ct=G({dni:y().min(7,"El DNI debe tener al menos 7 caracteres").max(10,"El DNI no debe superar los 10 caracteres"),first_name:y("Nombre requerido"),last_name_paterno:y("Apellido paterno requerido"),last_name_materno:y("Apellido materno requerido"),email:we("Correo requerido"),phone:ye("Debe ser un número de celular válido de 9 dígitos"),gender:y("Género requerido").oneOf(["f","m"],"Selecciona un género válido"),new_password:y().min(8,"La contraseña debe tener al menos 8 caracteres"),confirm_password:y().oneOf([me("new_password")],"Las nuevas contraseñas no coinciden")}),Et=()=>{const t=Z(),[s,r]=c.useState(1),n=J(Ct),o=U({mutationFn:ae.register,onSuccess:()=>{I.success("Usuario registrado con éxito"),t("/login",{replace:!0})},onError:()=>I.error("Error al registrar el usuario")}),a=async()=>{await n.trigger(["first_name","last_name_materno","last_name_paterno","gender"])&&r(2)},i=n.handleSubmit(m=>o.mutate(m));return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-md bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Crear cuenta"}),e.jsx("p",{className:"text-base-content/70 text-sm mt-1",children:"Completa el formulario para registrarte"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("ul",{className:"steps flex",children:[e.jsx("li",{className:E("step",{"step-primary":s>0}),onClick:()=>r(1)}),e.jsx("li",{className:E("step",{"step-primary":s>1})})]})}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[s===1&&e.jsxs(e.Fragment,{children:[e.jsx(C,{label:"Nombre",registration:n.register("first_name"),error:n.formState.errors.first_name}),e.jsx(C,{label:"Apellido paterno",registration:n.register("last_name_paterno"),error:n.formState.errors.last_name_paterno}),e.jsx(C,{label:"Apellido materno",registration:n.register("last_name_materno"),error:n.formState.errors.last_name_materno}),e.jsx(Ne,{label:"Género",registration:n.register("gender"),error:n.formState.errors.gender,options:[{label:"Femenino",value:"f"},{label:"Masculino",value:"m"}]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{type:"button",onClick:a,className:"btn btn-primary",children:"Siguiente"})})]}),s===2&&e.jsxs(e.Fragment,{children:[e.jsx(C,{label:"DNI",registration:n.register("dni"),error:n.formState.errors.dni}),e.jsx(C,{label:"Correo electrónico",registration:n.register("email"),error:n.formState.errors.email}),e.jsx(C,{label:"Teléfono",registration:n.register("phone"),error:n.formState.errors.phone}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(O,{label:"Contraseña",registration:n.register("new_password"),error:n.formState.errors.new_password}),e.jsx(O,{label:"Confirmar contraseña",registration:n.register("confirm_password"),error:n.formState.errors.confirm_password})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Crear cuenta"})})]})]}),e.jsxs("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300",children:[e.jsx("span",{children:"¿Ya tienes cuenta? "}),e.jsx(k,{to:"/login",replace:!0,className:"link link-primary font-semibold",children:"Inicia sesión"})]})]})})},kt=G({dni:y().min(7,"El DNI debe tener al menos 7 caracteres").max(10,"El DNI no debe superar los 10 caracteres")}),It=()=>{var n;const t=J(kt),s=U({mutationFn:ae.recoverAccount,onError:()=>I.error("Hubo un problema al enviar el correo con las instrucciones. Intenta nuevamente"),onSuccess:()=>t.reset()}),r=t.handleSubmit(o=>s.mutate(o.dni));return s.isSuccess?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-sm bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Recuperar cuenta"}),e.jsxs("p",{className:"text-base-content/70 text-sm mt-1",children:["Se envió un correo con las instrucciones a ",e.jsx("span",{className:"font-bold",children:(n=s.data)==null?void 0:n.email})]})]}),e.jsx("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300",children:e.jsx(k,{to:"/login",replace:!0,className:"link link-primary font-semibold",children:"Iniciar sesión"})})]})}):e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-sm bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Recuperar cuenta"}),e.jsx("p",{className:"text-base-content/70 text-sm mt-1",children:"Ingresa tu DNI para recuperar tu cuenta"})]}),e.jsxs("form",{onSubmit:r,className:"space-y-5",children:[e.jsx(C,{label:"DNI",registration:t.register("dni"),error:t.formState.errors.dni}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-block",disabled:s.isPending,children:s.isPending?"Enviando...":"Enviar instrucciones"})]}),e.jsxs("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300",children:[e.jsx("span",{children:"¿Ya recordaste tu contraseña? "}),e.jsx(k,{to:"/login",replace:!0,className:"link link-primary font-semibold",children:"Iniciar sesión"})]})]})})},ve=c.createContext(void 0),Se=()=>{const t=c.useContext(ve);if(!t)throw new Error("useModal debe ser usado dentro de un ModalProvider");return t},_e=()=>{const[t,s]=c.useState(window.innerWidth<768);return c.useEffect(()=>{const r=()=>{s(window.innerWidth<768)};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),{isMobile:t}},Pt=()=>{var l,u,x;const t=H(),{openModal:s}=Se(),{user:r,logout:n}=W(),{isMobile:o}=_e(),[a,i]=c.useState(!o),m=async()=>{await s("Cerrar sesión","¿Estás seguro de que quieres cerrar sesión?")&&n()},d=()=>{o&&i(!1)};return e.jsxs("div",{className:"min-h-screen flex flex-col md:grid md:grid-cols-[250px_1fr] bg-base-200",children:[o&&e.jsxs("div",{className:"flex items-center justify-between bg-base-100 p-4",children:[e.jsx("button",{onClick:()=>i(!a),className:"btn btn-ghost",children:e.jsx(De,{className:"w-6 h-6"})}),e.jsx("div",{className:"text-lg font-bold",children:"Dashboard"})]}),(a||!o)&&e.jsxs("aside",{className:"bg-base-100 border-b md:border-b-0 md:border-r border-base-300 p-4 flex flex-col space-y-6 md:static absolute w-full md:w-auto z-50",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[(l=r==null?void 0:r.user_info)!=null&&l.avatarUrl?e.jsx("img",{src:r.user_info.avatarUrl,alt:"Avatar",className:"w-20 h-20 md:w-24 md:h-24 rounded-full object-cover mb-2"}):e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-full bg-base-300 flex items-center justify-center mb-2",children:e.jsx(Re,{className:"w-10 h-10 md:w-12 md:h-12 text-base-content/70"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-base md:text-lg",children:((u=r==null?void 0:r.user_info)==null?void 0:u.username)??""}),e.jsx("p",{className:"text-xs md:text-sm text-base-content/70",children:((x=r==null?void 0:r.user_info)==null?void 0:x.first_name)??""})]})]}),e.jsxs("nav",{className:"flex flex-col items-start gap-2",children:[e.jsxs(k,{to:"/dashboard",onClick:d,className:`btn btn-ghost justify-start w-full ${t.pathname==="/dashboard"?"btn-active":""}`,children:[e.jsx(Le,{className:"w-5 h-5 mr-2"})," Inicio"]}),e.jsxs(k,{to:"/dashboard/documentos/firmar",onClick:d,className:`btn btn-ghost justify-start w-full ${t.pathname==="/dashboard/documentos/firmar"?"btn-active":""}`,children:[e.jsx(Fe,{className:"w-5 h-5 mr-2"})," ",e.jsx("span",{className:"text-start",children:"Documentos por Firmar"})]}),e.jsxs(k,{to:"/dashboard/signature",onClick:d,className:`btn btn-ghost justify-start w-full ${t.pathname==="/dashboard/signature"?"btn-active":""}`,children:[e.jsx(Me,{className:"w-5 h-5 mr-2"})," Firma"]}),e.jsxs(k,{to:"/dashboard/perfil",onClick:d,className:`btn btn-ghost justify-start w-full ${t.pathname==="/dashboard/perfil"?"btn-active":""}`,children:[e.jsx(Oe,{className:"w-5 h-5 mr-2"})," Mi Perfil"]}),e.jsxs("button",{onClick:()=>{d(),m()},className:"btn btn-ghost text-error justify-start w-full",children:[e.jsx(Ae,{className:"w-5 h-5 mr-2"})," Cerrar Sesión"]})]})]}),e.jsx(Ue,{className:"flex-1 overflow-y-auto",children:e.jsx(Te,{})})]})},oe={updateProfile:async t=>await gt({baseUrl:M,path:"/v1/global/users/session",body:t}),getProfile:async()=>$({baseUrl:M,path:"/v1/global/users/session"})},Dt=G({first_name:y("Nombre requerido"),last_name_paterno:y("Apellido paterno requerido"),last_name_materno:y("Apellido materno requerido"),email:we("Correo requerido"),phone:ye("Debe ser un número de celular válido de 9 dígitos"),gender:y("Género requerido").oneOf(["f","m"],"Selecciona un género válido"),current_password:K(),new_password:K(),confirm_password:K().oneOf([me("new_password")],"Las nuevas contraseñas no coinciden")}),Rt=()=>{const t=U({mutationFn:oe.updateProfile,onSuccess:()=>{Y.success("Perfil actualizado exitosamente"),s.setValue("current_password",""),s.setValue("new_password",""),s.setValue("confirm_password","")},onError:()=>Y.error("Error al actualizar el perfil")}),s=J(Dt),{isLoading:r,isError:n,data:o,refetch:a}=ee({queryKey:["profile"],queryFn:oe.getProfile});c.useEffect(()=>{o!=null&&s.reset({email:o.email,first_name:o.first_name,gender:o.gender,last_name_materno:o.last_name_materno,last_name_paterno:o.last_name_paterno,phone:o.phone,current_password:"",new_password:"",confirm_password:""})},[o]);const i=m=>t.mutate(m);return r?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("span",{className:"loading loading-spinner loading-lg"})}):n?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen space-y-4",children:[e.jsx("p",{className:"text-lg font-semibold text-error",children:"No se pudo cargar tu perfil."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>a(),children:"Reintentar"})]}):e.jsxs("div",{className:"flex flex-col w-full h-full px-4 md:px-10 py-8 space-y-10",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Mi Perfil"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Actualiza tu información personal"})]}),e.jsxs("form",{onSubmit:s.handleSubmit(i),className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(C,{label:"Nombre",registration:s.register("first_name"),error:s.formState.errors.first_name}),e.jsx(C,{label:"Apellido paterno",registration:s.register("last_name_paterno"),error:s.formState.errors.last_name_paterno}),e.jsx(C,{label:"Apellido materno",registration:s.register("last_name_materno"),error:s.formState.errors.last_name_materno}),e.jsx(C,{label:"Correo electrónico",registration:s.register("email"),error:s.formState.errors.email}),e.jsx(C,{label:"Teléfono",registration:s.register("phone"),error:s.formState.errors.phone}),e.jsx(Ne,{label:"Género",registration:s.register("gender"),error:s.formState.errors.gender,options:[{label:"Femenino",value:"f"},{label:"Masculino",value:"m"}]}),e.jsxs("div",{className:"md:col-span-2 pt-8 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Cambio de contraseña"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completa los campos si deseas actualizar tu contraseña."})]}),e.jsx(O,{label:"Contraseña actual",registration:s.register("current_password"),error:s.formState.errors.current_password}),e.jsx(O,{label:"Nueva contraseña",registration:s.register("new_password"),error:s.formState.errors.new_password}),e.jsx(O,{label:"Confirmar nueva contraseña",registration:s.register("confirm_password"),error:s.formState.errors.confirm_password})]}),e.jsx("div",{className:"md:col-span-2 flex justify-end",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:s.formState.isSubmitting,children:s.formState.isSubmitting?"Guardando...":"Guardar cambios"})})]})]})},A={getDocumentoResumen:async(t,s,r)=>$({path:`/api/v1/public/documentos/${t}/${s}`,abortSignal:r}),getDocumentos:async t=>$({path:"/api/v1/public/documentos",abortSignal:t}),downloadPdf:async(t,s)=>await ge({path:`/api/v1/procesos/documentos/download/${t}`,progress:r=>s==null?void 0:s(r)}),signPDF:async t=>$({path:`/api/v1/public/sign/documento/${t}`}),logOpenLink:async t=>{await z({path:"/api/v1/public/_open_link/event",body:{record_codigo:t.codigo,empresa:t.empresa,method:t.metodo,referer:t.referencia}})}},Lt=function(){const t=document.createElement("a");return function(s,r){const n=window.URL.createObjectURL(r);t.href=n,t.download=s,t.click(),window.URL.revokeObjectURL(n)}}(),Ft=()=>{const t=H(),{openModal:s}=Se(),{isMobile:r}=_e();let n=qe();n??(n=window.innerHeight);const o=Z(),{pdfname:a,estado:i}=ue(),[m,d]=c.useState(i==="published"),[l,u]=c.useState(!0),[x,h]=c.useState(null),[g,N]=c.useState(null),[w,S]=c.useState(null),[F,R]=c.useState(1),L=c.useRef(!1),P=U({mutationFn:A.signPDF,onSuccess:()=>{I.success("Documento firmado correctamente."),d(!1)},onError:p=>I.error(`Error al firmar el documento: ${p.message}`)}),j=async()=>{if(!a){alert("No se ha seleccionado ningún documento para firmar.");return}await s("Confirmar Firma","¿Estás seguro de que deseas firmar este documento?")&&P.mutate(a)};return c.useEffect(()=>{L.current||(L.current=!0,(async()=>{if(a==null){h("No PDF name provided"),u(!1);return}try{const p=await A.downloadPdf(a);N(new File([p],a,{type:"application/pdf"})),u(!1)}catch(p){h(p instanceof Error?p.message:"An unknown error occurred"),u(!1)}})())},[a]),l?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):x!=null?e.jsxs("div",{className:"flex items-center justify-center h-screen text-red-500",children:["Error: ",typeof x=="string"?x:x.message]}):g==null?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Unable to load PDF."}):e.jsxs("div",{className:E("w-full relative bg-base-100"),style:{height:r?n-72:n},children:[e.jsxs("div",{className:"absolute bg-black/20 w-full h-10 top-0 flex justify-between items-center px-4 z-10",children:[e.jsx($e,{className:"w-5 h-5 cursor-pointer select-none",onClick:()=>{var p;if(((p=t.state)==null?void 0:p.from)==="_link"){o("/dashboard",{replace:!0});return}o(-1)}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>Lt(g.name,g),children:e.jsx(ze,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-2"}),e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>R(p=>Math.min(p+.1,3)),children:e.jsx(Be,{className:"w-5 h-5"})}),e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>R(p=>Math.max(p-.1,.5)),children:e.jsx(Ve,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-auto flex flex-col items-center gap-4 h-full pt-10",children:e.jsx(fe,{file:g,onLoadSuccess:({numPages:p})=>S(p),loading:"Loading PDF...",error:"Error while loading PDF",className:"flex flex-col items-center w-full",children:Array.from(new Array(w),(p,v)=>e.jsx(he,{pageNumber:v+1,width:r?window.innerWidth:800,scale:F,className:"shadow-md rounded-lg border border-base-300"},`page_${v+1}`))})}),m&&e.jsx("div",{className:"absolute bottom-0 h-20 w-full flex justify-center items-center gap-4 z-[9999]",children:e.jsx("button",{className:"btn btn-primary flex items-center gap-2",onClick:j,disabled:l,children:P.isPending?e.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Firmando..."})}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Firmar Documento"}),e.jsx(Ge,{})]})})})]})},ie=800;function Mt(){const[t,s]=c.useState("./sample.pdf"),[r,n]=c.useState(),[o]=c.useState(),a=m=>{var l;const d=(l=m.target.files)==null?void 0:l[0];d&&s(d)},i=({numPages:m})=>{n(m)};return e.jsxs("div",{children:[e.jsx("header",{children:e.jsx("h1",{children:"react-pdf sample"})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"file",children:"Load PDF:"}),e.jsx("input",{type:"file",onChange:a}),e.jsx("div",{style:{border:"2px solid #000",padding:"10px"},children:e.jsx(fe,{file:t,onLoadSuccess:i,children:Array.from({length:r??0},(m,d)=>e.jsx(he,{pageNumber:d+1,width:o?Math.min(o,ie):ie},d))})})]})]})}const Ot=({initialOffset:t=0,initialLimit:s=1,total:r,onUpdate:n})=>{const[o,a]=c.useState(t),[i,m]=c.useState(s),[d,l]=c.useState(!1),[u,x]=c.useState(""),h=c.useRef(null),g=o+1,N=Math.min(o+i,r),w=i>1?`${g}-${N}`:`${g}`;c.useEffect(()=>{const f=b=>{h.current&&!h.current.contains(b.target)&&P()};return d&&document.addEventListener("mousedown",f,{capture:!0}),()=>document.removeEventListener("mousedown",f)},[d]);const S=(f,b,T)=>Math.max(Math.min(f,T),b),F=f=>{const[b,T]=f.trim().split(/[-,;\s]+/);let q=parseInt(b,10),Q=T?parseInt(T,10):q;return q=S(q,1,r),Q=S(Q,1,r),{minimum:q-1,maximum:Q}},R=(f,b)=>{a(f),m(b),n({offset:f,limit:b}),l(!1)},L=f=>{let b=o+i*f;b>=r?b=0:b<0&&i===1?b=r-1:b<0&&i>1&&(b=r-(r%i||i)),R(b,i)},P=()=>{const{minimum:f,maximum:b}=F(u);!isNaN(f)&&!isNaN(b)&&f<b?R(f,b-f):l(!1)},j=f=>{x(f.target.value)},p=f=>{f.key==="Enter"?(f.preventDefault(),P()):f.key==="Escape"&&(f.preventDefault(),l(!1))},v=()=>{d||(x(w),l(!0),setTimeout(()=>{var f;return(f=h.current)==null?void 0:f.focus()},0))};return e.jsxs("nav",{className:"flex gap-2 h-full items-center my-2","aria-label":"Pager",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[d?e.jsx("input",{ref:h,type:"text",className:"text-sm h-5 p-0 m-0 text-end outline-none input-sm",value:u,onBlur:P,onChange:j,onKeyDown:p}):e.jsx("span",{className:"text-sm border-transparent cursor-pointer",onClick:v,children:w}),e.jsx("span",{className:"text-sm",children:"/"}),e.jsx("span",{className:"text-sm",children:r})]}),e.jsxs("span",{className:"btn-group flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm","aria-label":"Previous",onClick:()=>L(-1),children:e.jsx(He,{})}),e.jsx("button",{type:"button",className:"btn btn-sm","aria-label":"Next",onClick:()=>L(1),children:e.jsx(We,{})})]})]})},At=({table:t})=>e.jsx("thead",{className:"bg-gray-200 dark:bg-gray-800 border-b border-gray-300 dark:border-gray-700",children:t.getHeaderGroups().map(s=>e.jsx("tr",{children:s.headers.map(r=>{var n,o;return e.jsx("th",{className:E("px-4 py-3 font-semibold text-xs text-gray-600 dark:text-gray-200 uppercase tracking-wider",{"text-left":r.column.id!=="actions","text-center":r.column.id==="actions","text-right":["amount","price"].includes(r.column.id)}),children:r.isPlaceholder?null:typeof r.column.columnDef.header=="string"?r.column.columnDef.header:(o=(n=r.column.columnDef).header)==null?void 0:o.call(n,r.getContext())},r.id)})},s.id))}),Ut=({error:t,onRetry:s,columns:r})=>e.jsx("tr",{children:e.jsxs("td",{colSpan:r.length,className:"p-6 text-center text-red-500 dark:text-red-400",children:[e.jsx("div",{children:typeof t=="string"?t:t.message}),s&&e.jsx("button",{onClick:s,className:"mt-2 px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/80",children:"Intentar nuevamente"})]})}),Ce=c.createContext(null),Tt=()=>{const t=c.useContext(Ce);if(!t)throw new Error("useContextMenu must be used inside ContextMenuProvider");return t};function qt({table:t,onRowClick:s,onRowDoubleClick:r,contextMenuAcctions:n}){const o=c.useRef(null),{openContextMenu:a}=Tt(),[i,m]=c.useState(null),d=(l,u)=>x=>{if(n==null)return;let h=[];typeof n=="function"?h=n(l):h=n,h.length!==0&&(m(u),a(x,h,l))};return e.jsx(e.Fragment,{children:t.getRowModel().rows.map(l=>{const u=l.id;return e.jsx("tr",{onClick:()=>{m(u),s==null||s(l.original)},onDoubleClick:()=>r==null?void 0:r(l.original),className:E("hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition-all duration-200 relative",{"bg-primary/10 dark:bg-primary/20":l.getIsSelected(),"bg-primary/5 dark:bg-primary/10":i===u&&!l.getIsSelected(),"after:content-[''] after:absolute after:inset-y-0 after:left-0 after:w-1 after:bg-primary":i===u}),onContextMenu:x=>d(l.original,u)(x),onTouchStart:x=>{o.current=setTimeout(()=>{d(l.original,u)(x)},500)},onTouchEnd:()=>{o.current&&clearTimeout(o.current)},children:l.getVisibleCells().map(x=>e.jsx("td",{className:E("px-4 py-3 text-sm text-gray-700 dark:text-gray-300 border-b border-gray-200 dark:border-gray-700","select-none",{"text-left":x.column.id!=="actions","text-center":x.column.id==="actions","text-right":["amount","price"].includes(x.column.id)}),children:Je(x.column.columnDef.cell,x.getContext())},x.id))},u)})})}function $t({data:t,columns:s,loading:r=!1,error:n,rowSelectionEnabled:o=!1,onRowClick:a,onRowDoubleClick:i,getRowId:m,onRetry:d,contextMenuAcctions:l}){const[u,x]=c.useState({}),h=Qe({data:t,columns:s,state:{rowSelection:u},enableRowSelection:o,getRowId:m?g=>m(g):void 0,getCoreRowModel:Ke(),onRowSelectionChange:x});return e.jsx("div",{className:E("overflow-x-auto border border-gray-200 dark:border-gray-700 rounded-md shadow-lg"),children:e.jsxs("table",{className:"w-full table-auto text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(At,{table:h}),e.jsx("tbody",{children:r?e.jsx("tr",{children:e.jsx("td",{colSpan:s.length,className:"p-6 text-center text-gray-500 dark:text-gray-400",children:"Cargando..."})}):n?e.jsx(Ut,{error:n,onRetry:d,columns:s}):e.jsx(qt,{table:h,onRowClick:a,onRowDoubleClick:i,contextMenuAcctions:l})})]})})}const zt=({onSearch:t})=>{const[s,r]=c.useState(""),n=()=>{t&&t(s)},o=a=>{a.key==="Enter"&&n()};return e.jsxs("div",{className:"mb-4 flex justify-center",children:[e.jsxs("div",{className:"relative w-full max-w-xs",children:[e.jsx("input",{type:"text",className:E("w-full","input-sm","pl-10","pr-4","py-2","rounded-md","border","border-gray-300","bg-transparent","text-gray-800","dark:text-gray-200","dark:border-gray-700","dark:focus:ring-0","focus:outline-none","focus:ring-2","focus:ring-gray-400","focus:border-gray-400","dark:focus:ring-gray-500","dark:focus:border-gray-500"),placeholder:"Search...",value:s,onChange:a=>r(a.target.value),onKeyDown:o}),e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 18l6-6-6-6"})})})]}),e.jsx("button",{type:"button",onClick:n,className:E("ml-2","px-2","py-2","btn","btn-sm","h-[36px]","filter-reset","border","border-gray-300","bg-transparent","text-gray-800","dark:text-gray-200","dark:border-gray-700","dark:focus:ring-0","focus:outline-none","focus:ring-2","focus:ring-gray-400","focus:border-gray-400","dark:focus:ring-gray-500","dark:focus:border-gray-500"),children:e.jsx(Xe,{})})]})},Bt=t=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.title&&e.jsx("h2",{className:"text-2xl font-semibold",children:t.title}),t.onSearch&&e.jsx(zt,{onSearch:t.onSearch})]})}),e.jsx($t,{...t}),t.pageProps&&e.jsx("div",{className:"flex justify-end",children:e.jsx(Ot,{initialLimit:t.pageProps.initialLimit,initialOffset:t.pageProps.initialOffset,total:t.pageProps.total,onUpdate:t.pageProps.onUpdate})})]}),Vt=t=>{const s=Ye();return t(s)},Gt=t=>{const s=c.useMemo(()=>["LISTA/DOCUMENTOS",t],[t]),r=xe(),{data:n,error:o,isFetching:a,isError:i}=ee({queryKey:s,queryFn:({signal:d})=>A.getDocumentos(d)});return{documentos:n??[],refresh:()=>r.invalidateQueries({queryKey:s}),isFetching:a,error:o,isError:i}},le=t=>(t??"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();function Ht(t,s){const r=le(String(s??"").trim());return r.length<2?t:t.filter(n=>Object.entries(n).some(([o,a])=>{if(a==null)return!1;let i=le(String(a));return typeof a=="number"&&(i=`#${i}`),o.endsWith("codigo")&&!i.startsWith("#")&&(i=`.${i}`),i.includes(r)}))}const Wt=t=>{const[s,r]=c.useState("");return[c.useMemo(()=>!t||!s.trim()?t??[]:s.split(";").map(a=>a.trim()).filter(Boolean).reduce((a,i)=>Ht(a,i),t),[t,s]),r]},Jt={"01":"Enero","02":"Febrero","03":"Marzo","04":"Abril","05":"Mayo","06":"Junio","07":"Julio","08":"Agosto","09":"Septiembre",10:"Octubre",11:"Noviembre",12:"Diciembre"},Qt=Vt(t=>[t.accessor("empresa_descripcion",{header:"Empresa",cell:({getValue:s})=>s()}),t.accessor("descripcion_proceso",{header:"Descripción del Proceso",cell:({getValue:s})=>s()}),t.accessor("anio",{header:"Año",cell:({getValue:s})=>s()}),t.accessor("mes",{header:"Mes",cell:({getValue:s})=>{const r=s();return r==null||typeof r!="string"?r:Jt[r]}}),t.accessor("item",{header:"Semana",cell:({getValue:s})=>s()}),t.accessor("estado",{header:"Estado",cell:({getValue:s})=>{const r=s();let n,o,a;switch(r){case"published":n=e.jsx(tt,{className:"w-5 h-5"}),o="bg-green-500 text-white",a="Pendiente";break;case"signed":n=e.jsx(et,{className:"w-5 h-5"}),o="bg-blue-500 text-white",a="Firmado";break;case"canceled":n=e.jsx(Ze,{className:"w-5 h-5"}),o="bg-red-500 text-white",a="Cancelado";break;default:n=null,o="bg-gray-500 text-white",a="-"}return e.jsxs("div",{className:`max-w-[150px] grid items-center grid-cols-[1fr_3fr] p-2 rounded-lg ${o} dark:bg-opacity-20`,children:[e.jsx("p",{children:n}),e.jsx("p",{children:a})]})}})]),ce=({tosign:t})=>{const s=Z(),{documentos:r,isFetching:n,error:o,refresh:a}=Gt(),i=c.useMemo(()=>t?r.filter(l=>l.estado=="published"):r,[t,r]),[m,d]=Wt(i);return e.jsx("div",{className:"p-4 md:p-8",children:e.jsx(Bt,{title:"Lista de documentos",loading:n,error:o,onRetry:a,columns:Qt,data:m,onSearch:d,contextMenuAcctions:l=>[{label:"Ver Documeto",onClick:()=>{if(l.signed_pdf_name){s(`/dashboard/pdf/${l.signed_pdf_name}/${l.estado}`);return}if(l.nombre_pdf){s(`/dashboard/pdf/${l.nombre_pdf}/${l.estado}`);return}}}],onRowDoubleClick:l=>{if(l.signed_pdf_name){s(`/dashboard/pdf/${l.signed_pdf_name}/${l.estado}`);return}if(l.nombre_pdf){s(`/dashboard/pdf/${l.nombre_pdf}/${l.estado}`);return}}})})},Kt=()=>{const{empresa:t,origin:s,record_codigo:r}=ue();return t==null||s==null||r==null?e.jsx(D,{to:"/dashboard",replace:!0}):e.jsx(Xt,{empresa:t,origin:s,record_codigo:r})},Xt=({empresa:t,origin:s,record_codigo:r})=>{const n=c.useRef(!1);c.useEffect(()=>{if(n.current)return;(async()=>{try{await A.logOpenLink({codigo:r,empresa:t,metodo:s,referencia:window.location.href})}catch(x){console.error("Failed to log open link:",x)}finally{n.current=!0}})()},[t,s,r]);const o=c.useMemo(()=>["RESUMEN_INFO_DOC_RECORD",t,s,r],[t,s,r]),a=xe(),{data:i,error:m,isLoading:d}=ee({queryKey:o,queryFn:({signal:u})=>A.getDocumentoResumen(t,r,u)}),l=()=>a.invalidateQueries({queryKey:o});return d?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):m!=null?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen text-red-500",children:[e.jsxs("p",{children:["Error: ",typeof m=="string"?m:m.message]}),e.jsx("button",{onClick:l,className:"mt-4 px-6 py-2 bg-red-600 text-white rounded-lg shadow-md hover:bg-red-700 transition",children:"Retry"})]}):i==null||i.length===0?e.jsx(D,{to:"/dashboard",replace:!0}):i[0].signed_pdf_name?e.jsx(D,{to:`/dashboard/pdf/${i[0].signed_pdf_name}/${i[0].estado}`,replace:!0,state:{from:"_link"}}):i[0].nombre_pdf?e.jsx(D,{to:`/dashboard/pdf/${i[0].nombre_pdf}/${i[0].estado}`,replace:!0,state:{from:"_link"}}):e.jsx("div",{className:"flex flex-col items-center justify-center h-screen text-red-500",children:e.jsx("button",{onClick:l,className:"mt-4 px-6 py-2 bg-red-600 text-white rounded-lg shadow-md hover:bg-red-700 transition",children:"Retry"})})},Ee={getFirmaImange:async t=>ge({abortSignal:t,path:"/api/v1/public/firma/jpg",progress:()=>{}}),uploadFirmaImange:async t=>{const s=new FormData;return s.append("image",t),bt({path:"/api/v1/public/firma/jpg",body:s})}},Yt=t=>new Promise((s,r)=>{const n=new Image;n.addEventListener("load",()=>s(n)),n.addEventListener("error",o=>r(o)),n.setAttribute("crossOrigin","anonymous"),n.src=t});function ke(t){return t*Math.PI/180}function Zt(t,s,r){const n=ke(r);return{width:Math.abs(Math.cos(n)*t)+Math.abs(Math.sin(n)*s),height:Math.abs(Math.sin(n)*t)+Math.abs(Math.cos(n)*s)}}const es={flip:{horizontal:!1,vertical:!1},output:{width:860,height:860/2}};async function ts(t,s,r=0,n=es){var h,g;const o=await Yt(t),a=document.createElement("canvas"),i=a.getContext("2d");if(!i)return null;const m=ke(r),{width:d,height:l}=Zt(o.width,o.height,r);a.width=d,a.height=l,i.translate(d/2,l/2),i.rotate(m),i.scale((h=n==null?void 0:n.flip)!=null&&h.horizontal?-1:1,(g=n==null?void 0:n.flip)!=null&&g.vertical?-1:1),i.translate(-o.width/2,-o.height/2),i.drawImage(o,0,0);const u=document.createElement("canvas"),x=u.getContext("2d");return x?(u.width=n.output.width,u.height=n.output.height,x.drawImage(a,s.x,s.y,s.width,s.height,0,0,n.output.width,n.output.height),new Promise(N=>u.toBlob(w=>N(w),"image/jpeg",.95))):null}const ss="/assets/no_image_placeholder-B4dLisTe.jpg",rs=({image:t})=>{const s=c.useRef(null),[r,n]=c.useState(!1),[o,a]=c.useState("view"),[i,m]=c.useState(t),[d,l]=c.useState(null),[u,x]=c.useState({x:0,y:0}),[h,g]=c.useState(1),[N,w]=c.useState(0),[S,F]=c.useState(null),R=c.useCallback((j,p)=>{F(p)},[]),L=j=>{var f;const p=(f=j.target.files)==null?void 0:f[0];if(!p)return;const v=new FileReader;v.onload=()=>{l(v.result),a("crop")},v.readAsDataURL(p)},P=async()=>{if(!d||!S)return;const j=await ts(d,S,N,{output:{width:860,height:860/2}});if(j==null){I.error("no se pudo procesar la imange");return}const p=I.loading("Guardando firma...");try{n(!0),await Ee.uploadFirmaImange(j),m(URL.createObjectURL(j)),a("view"),I.success("Firma guardada correctamente",{id:p})}catch(v){const f=typeof v=="string"?v:v instanceof Error?v.message:"Error al guardar la firma";I.error(f,{id:p})}finally{n(!1)}};return e.jsxs("div",{className:"w-full h-full px-5 py-8 flex flex-col items-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Firma"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center max-w-[860px] mb-4",children:"Esta imagen será utilizada como firma visual en los documentos que firmes digitalmente desde el sistema."}),o==="view"&&e.jsxs("div",{className:"w-full max-w-[860px] space-y-4",children:[e.jsxs("div",{className:"relative aspect-[2/1] rounded-lg shadow-2xl bg-white overflow-hidden",children:[e.jsx("img",{src:i||ss,alt:"Firma",className:"w-full h-full object-contain bg-white"}),e.jsx("label",{htmlFor:"fileInput",className:E("absolute inset-0","flex items-center justify-center","transition duration-200","cursor-pointer")}),e.jsx("input",{ref:s,type:"file",id:"fileInput",accept:"image/png,image/jpeg",onChange:L,className:"hidden"})]}),e.jsx("div",{className:"pt-8 flex justify-center",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{var j;return(j=s.current)==null?void 0:j.click()},children:"Subir Firma"})})]}),o==="crop"&&d&&e.jsxs("div",{className:"w-full max-w-[860px] space-y-4",children:[e.jsx("div",{className:"relative aspect-[2/1] rounded-lg shadow-2xl bg-white overflow-hidden",children:e.jsx(st,{image:d,crop:u,zoom:h,rotation:N,aspect:2/1,onCropChange:x,onZoomChange:g,onCropComplete:R,restrictPosition:!1,cropShape:"rect",showGrid:!1,style:{containerStyle:{backgroundImage:"linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%)",backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px"},mediaStyle:{backgroundColor:"transparent"}}})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"grid xl:grid-cols-2 items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-medium mb-2",children:["Zoom: ",h.toFixed(1),"x"]}),e.jsx("input",{type:"range",min:1,max:3,step:.1,value:h,onChange:j=>g(parseFloat(j.target.value)),className:"w-full range range-sm range-primary"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>w(j=>j-90),children:[e.jsx(rt,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:" Rotar Izquierda"})]}),e.jsxs("button",{className:"btn btn-outline",onClick:()=>w(j=>j+90),children:[e.jsx(nt,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:" Rotar Derecha"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[e.jsx("button",{className:"btn btn-ghost",onClick:()=>a("view"),children:"Cancelar"}),e.jsx("button",{className:"btn btn-primary disabled:opacity-50",onClick:P,disabled:r,children:r?"Guardando...":"Guardar"})]})]})]})]})},ns=()=>{const[t,s]=c.useState(null),r=c.useRef(null),[n,o]=c.useState(!0),[a,i]=c.useState(null),m=async l=>{o(!0),i(null);try{const u=await Ee.getFirmaImange(l);u!=null&&s(URL.createObjectURL(u)),o(!1)}catch(u){console.log(u),u instanceof DOMException&&u.name==="AbortError"||u instanceof Error&&u.message!=="no hay ninguna imagen"&&i(u),o(!1)}},d=c.useCallback(()=>{const l=new AbortController;r.current=l,m(l.signal)},[]);return c.useEffect(()=>(d(),()=>{var l;(l=r.current)==null||l.abort()}),[d]),n?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):a!=null?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen text-red-500",children:[e.jsxs("p",{children:["Error: ",typeof a=="string"?a:a.message]}),e.jsx("button",{onClick:d,className:"mt-4 px-6 py-2 bg-red-600 text-white rounded-lg shadow-md hover:bg-red-700 transition",children:"Retry"})]}):e.jsx(rs,{image:t})},de=({children:t})=>{const s=H(),{user:r}=W(),n=!!r;let o;return s.pathname.startsWith("/_sign/")&&(o={from:s.pathname}),n?t:e.jsx(D,{to:"/login",replace:!0,state:o})},X=({children:t})=>{var o;const{user:s}=W(),r=!!s,n=H();return r?(o=n.state)!=null&&o.from?e.jsx(D,{to:n.state.from,replace:!0}):e.jsx(D,{to:"/dashboard",replace:!0}):t},as=()=>e.jsx(at,{children:e.jsxs(ot,{children:[e.jsx(_,{path:"/login",element:e.jsx(X,{children:e.jsx(_t,{})})}),e.jsx(_,{path:"/register",element:e.jsx(X,{children:e.jsx(Et,{})})}),e.jsx(_,{path:"/recover",element:e.jsx(X,{children:e.jsx(It,{})})}),e.jsx(_,{path:"/_sign/:empresa/:record_codigo/:origin",element:e.jsx(de,{children:e.jsx(Kt,{})})}),e.jsxs(_,{path:"/dashboard",element:e.jsx(de,{children:e.jsx(Pt,{})}),children:[e.jsx(_,{index:!0,element:e.jsx(ce,{})}),e.jsx(_,{path:"pdf/:pdfname/:estado",element:e.jsx(Ft,{})}),e.jsx(_,{path:"documentos/firmar",element:e.jsx(ce,{tosign:!0})}),e.jsx(_,{path:"perfil",element:e.jsx(Rt,{})}),e.jsx(_,{path:"signature",element:e.jsx(ns,{})}),e.jsx(_,{path:"sample",element:e.jsx(Mt,{})})]}),e.jsx(_,{path:"*",element:e.jsx(D,{to:"/login",replace:!0})})]})}),os=({children:t})=>{const[s,r]=c.useState(()=>{try{const a=localStorage.getItem("session");if(a==null)return null;const i=localStorage.getItem("last_token_used");if(i!=null){const m=new Date(i),d=new Date;if(!isNaN(m.getTime())&&d.getTime()-m.getTime()>18e6)return localStorage.removeItem("session"),null}return a?JSON.parse(a):null}catch(a){return console.error("Error retrieving session data from localStorage",a),null}}),n=a=>{r(a);const i=new Date;localStorage.setItem("last_token_used",i.toISOString()),localStorage.setItem("session",JSON.stringify(a))},o=()=>{r(null),localStorage.removeItem("session")};return e.jsx(pe.Provider,{value:{user:s,login:n,logout:o},children:t})},is=({children:t})=>{const[s,r]=c.useState(!1),[n,o]=c.useState(()=>{}),[a,i]=c.useState("Confirmación"),[m,d]=c.useState("¿Estás seguro de esta acción?"),l=(N,w)=>(r(!0),i(N),d(w),new Promise(S=>o(()=>S))),u=()=>{r(!1)},x=()=>{n(!0),u()},h=()=>{n(!1),u()},g=()=>s?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{className:"bg-base-100 p-6 rounded-lg shadow-lg w-full max-w-sm",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:a}),e.jsx("p",{className:"text-base-content/80 mb-6",children:m}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{className:"btn btn-ghost",onClick:h,children:"Cancelar"}),e.jsx("button",{className:"btn btn-primary",onClick:x,children:"Confirmar"})]})]})}):null;return e.jsx(ve.Provider,{value:{openModal:l},children:e.jsxs(e.Fragment,{children:[e.jsx(g,{}),t]})})},ls=({children:t})=>{const[s,r]=c.useState({isOpen:!1,x:0,y:0,items:[]}),n=c.useCallback((a,i,m)=>{a.preventDefault();let d=0,l=0;"touches"in a&&a.touches.length>0?(d=a.touches[0].clientX,l=a.touches[0].clientY):"clientX"in a&&(d=a.clientX,l=a.clientY);const u=10,x=180,h=200,g=window.innerWidth,N=window.innerHeight;let w=d,S=l;d+x+u>g&&(w=g-x-u),l+h+u>N&&(S=N-h-u),r({isOpen:!0,x:w,y:S,items:i,data:m})},[]),o=c.useCallback(()=>{r(a=>({...a,isOpen:!1}))},[]);return c.useEffect(()=>{const a=()=>{o()};return window.addEventListener("click",a),window.addEventListener("scroll",a),()=>{window.removeEventListener("click",a),window.removeEventListener("scroll",a)}},[o]),e.jsxs(Ce.Provider,{value:{openContextMenu:n,closeContextMenu:o,state:s},children:[t,s.isOpen&&e.jsx("div",{className:"absolute  min-w-[180px] rounded-md shadow-md border border-base-300 bg-base-100 text-base-content z-50 overflow-hidden",style:{top:s.y,left:s.x},onClick:a=>a.stopPropagation(),children:s.items.map((a,i)=>{const m=a.icon,d=a.disabled;return e.jsxs("button",{onClick:()=>{d||a.onClick(s.data),o()},className:`flex items-center gap-2 w-full text-left px-4 py-2 text-sm ${d?"cursor-not-allowed text-base-content/50 hover:bg-transparent":"hover:bg-base-200"}`,disabled:d,children:[m&&e.jsx(m,{className:`w-4 h-4 ${d?"opacity-50":""}`}),e.jsx("span",{className:"select-none",children:a.label})]},i)})})]})};ut.workerSrc=new URL("/assets/pdf.worker.min-GB3t0DcA.mjs",import.meta.url).toString();const cs=new it;lt.createRoot(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsxs(ls,{children:[e.jsx(ct,{}),e.jsx(is,{children:e.jsxs(dt,{client:cs,children:[e.jsx(os,{children:e.jsx(as,{})}),e.jsx(mt,{initialIsOpen:!1})]})})]})}));
