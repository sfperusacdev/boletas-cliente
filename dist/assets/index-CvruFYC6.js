import{r as d,u as Ce,o as Ee,e as U,f as $,g as M,j as e,L as C,h as X,k as ie,l as Y,n as S,V as R,p as z,M as ke,U as De,H as Pe,S as Ie,q as Le,s as Re,D as Me,O as Fe,t as Z,v as Oe,x as le,C as Ae,A as Te,Z as qe,y as Ue,P as $e,z as ze,B as Ve,E as He,F as Be,G as We,I as Ge,J as Je,K as ce,N as Qe,Q as Ke,R as Xe,T as E,W as Ye,X as Ze,Y as N,_ as et,$ as tt,a0 as st,a1 as rt,a2 as nt}from"./react-CGAOlQJ-.js";import{D as de,P as me,_ as at}from"./pdf-DJVLwknA.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=r(o);fetch(o.href,n)}})();const ue=d.createContext(void 0),V=()=>{const t=d.useContext(ue);if(!t)throw new Error("useSession debe ser usado dentro de un SessionProvider");return t};function H(t,s){const r=Ce({resolver:Ee(t),defaultValues:s==null?void 0:s.defaultValues});return{...r,handleSubmit:(o,n)=>r.handleSubmit(o,i=>{n&&n(i)})}}class xe extends Error{constructor(s){super(s),this.name="ApiError"}}class ot extends Error{constructor(){super("No hay conexión a internet 😵"),this.name="InternetError"}}class it extends Error{constructor(){super("No hay conexión con el servicio 😵"),this.name="InternetError"}}class lt extends Error{constructor(){super("Error en la comunicacion con el servicio 😢"),this.name="SyntaxJsonError"}}const ct=()=>{const t=localStorage.getItem("session");if(!t)return null;const{token:s}=JSON.parse(t),r=new Date;return localStorage.setItem("last_token_used",r.toISOString()),s},fe=async(t,s)=>{try{const r=ct();return await fetch(t,{...s,headers:{...s==null?void 0:s.headers,...r&&{Authorization:r}}})}catch(r){throw r instanceof TypeError?new it:r}},he=(...t)=>{const s=new RegExp("^/+"),r=new RegExp("/+$");return t.map(a=>a.replace(s,"").replace(r,"")).filter(Boolean).join("/")},I="http://192.16.0.15:7771/",pe="http://192.16.0.10:8765/",ee=async({baseUrl:t,path:s,method:r,body:a,abortSignal:o,fullResponse:n=!1})=>{const i=await fe(he(t??pe,s),{method:r,headers:{"Content-Type":"application/json"},...a?{body:JSON.stringify(a)}:{},signal:o}),m=await i.json();if(!i.ok){const c=typeof(m==null?void 0:m.message)=="string"?m.message:"Unexpected error";throw new xe(c)}return n?m:m.data},dt=async t=>{try{const s=await fe(he(t.baseUrl??pe,t.path),{method:t.method??"GET",headers:{"Content-Type":"application/json"},...t.body?{body:JSON.stringify(t.body)}:{},signal:t.abortSignal}),r=s.body;if(!r)throw new xe("Archivo no encontrado");const a=r.getReader(),o=parseInt(s.headers.get("Content-Length")??"");let n=0;const i=[];for(;;){const{done:m,value:c}=await a.read();if(m)break;i.push(c),n+=c.length,t.progress(Math.round(n/o*100))}return new Blob(i)}catch(s){throw s instanceof SyntaxError?new lt:s instanceof TypeError?new ot:s}},T=t=>ee({...t,method:"GET"}),J=t=>ee({...t,method:"POST"}),mt=t=>ee({...t,method:"PUT"}),te={login:async t=>await J({baseUrl:I,path:"/v1/global/login",body:t}),register:async t=>await J({baseUrl:I,path:"/v1/global/users",body:{username:t.dni,first_name:t.first_name,last_name_paterno:t.last_name_paterno,last_name_materno:t.last_name_materno,email:t.email,phone:t.phone,gender:t.gender,password:t.new_password,origin_request:window.location.origin}}),recoverAccount:async t=>await J({baseUrl:I,path:"/v1/global/users/post/recovery/email",body:{dni:t,origin_request:window.location.origin}})},ge="Este campo es requerido",ut="Introduce una dirección de correo electrónico válida",xt="El correo electrónico es obligatorio",ft="Introduce un número de celular válido",be=t=>{if(t==null)return null;if(typeof t!="string")return t;const s=t.trim();return s===""?null:s},j=(t=ge)=>U().transform(be).required(t),Q=()=>U().transform(be).nullable().default(null),je=(t=xt)=>U().email(ut).required(t),ht=/^(?:\+51)\s?[0-9]{3}\s?[0-9]{3}\s?[0-9]{3}$/,pt=t=>{if(t==null)return null;if(typeof t!="string")return t;const s=t.trim().replace(/\s+/g,"");return s===""?null:s.startsWith("+")?s:`+51 ${s}`},ye=(t=ft)=>U().transform(pt).test("valid-phone",t,s=>s==null||s===""?!0:ht.test(s)).required(ge),gt=$({username:j("DNI requerido").min(7,"El DNI debe tener al menos 7 caracteres").max(10,"El DNI no debe superar los 10 caracteres"),password:j("Contraseña requerida").min(6,"La contraseña debe tener al menos 6 caracteres")}),bt=()=>{const{login:t}=V(),s=M({mutationFn:te.login,onSuccess:o=>t(o),onError:()=>X.error("Error al iniciar sesión")}),r=H(gt,{defaultValues:{username:"",password:""}}),a=r.handleSubmit(({password:o,username:n})=>{s.mutate({password:o??"",username:n??""})});return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-sm bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Iniciar sesión"}),e.jsx("p",{className:"text-base-content/70 text-sm mt-1",children:"Ingresa tus credenciales para continuar"})]}),e.jsxs("form",{onSubmit:a,className:"space-y-5",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"DNI"})}),e.jsx("input",{type:"text",placeholder:"Ingresa tu DNI",className:"input input-bordered w-full",...r.register("username")}),r.formState.errors.username&&e.jsx("p",{className:"text-error text-xs mt-1",children:r.formState.errors.username.message})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"Contraseña"})}),e.jsx("input",{type:"password",placeholder:"Ingresa tu contraseña",className:"input input-bordered w-full",...r.register("password")}),r.formState.errors.password&&e.jsx("p",{className:"text-error text-xs mt-1",children:r.formState.errors.password.message})]}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-block",disabled:r.formState.isSubmitting,children:r.formState.isSubmitting?"Entrando...":"Entrar"})]}),e.jsxs("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300 space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{children:"¿Aún no tienes cuenta? "}),e.jsx(C,{to:"/register",className:"link link-primary font-semibold",children:"Regístrate"})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{children:"¿Olvidaste tu contraseña? "}),e.jsx(C,{to:"/recover",className:"link link-primary font-semibold",children:"Recuperar cuenta"})]})]})]})})},y=({label:t,error:s,registration:r,placeholder:a,...o})=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{className:"font-medium",children:t}),e.jsx("input",{...r,...o,className:"input input-bordered w-full",placeholder:a}),s&&e.jsx("p",{className:"text-xs text-error mt-1",children:s.message})]}),Ne=({label:t,options:s,error:r,registration:a,...o})=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{className:"font-medium",children:t}),e.jsxs("select",{...a,...o,className:"select select-bordered w-full",children:[e.jsx("option",{value:"",children:"Selecciona una opción"}),s.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))]}),r&&e.jsx("p",{className:"text-xs text-error mt-1",children:r.message})]}),L=({label:t,error:s,registration:r,...a})=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{className:"font-medium",children:t}),e.jsx("input",{type:"password",...r,...a,className:"input input-bordered w-full"}),s&&e.jsx("p",{className:"text-xs text-error mt-1",children:s.message})]}),jt=$({dni:j().min(7,"El DNI debe tener al menos 7 caracteres").max(10,"El DNI no debe superar los 10 caracteres"),first_name:j("Nombre requerido"),last_name_paterno:j("Apellido paterno requerido"),last_name_materno:j("Apellido materno requerido"),email:je("Correo requerido"),phone:ye("Debe ser un número de celular válido de 9 dígitos"),gender:j("Género requerido").oneOf(["f","m"],"Selecciona un género válido"),new_password:j().min(8,"La contraseña debe tener al menos 8 caracteres"),confirm_password:j().oneOf([ie("new_password")],"Las nuevas contraseñas no coinciden")}),yt=()=>{const t=Y(),[s,r]=d.useState(1),a=H(jt),o=M({mutationFn:te.register,onSuccess:()=>{R.success("Usuario registrado con éxito"),t("/login",{replace:!0})},onError:()=>R.error("Error al registrar el usuario")}),n=async()=>{await a.trigger(["first_name","last_name_materno","last_name_paterno","gender"])&&r(2)},i=a.handleSubmit(m=>o.mutate(m));return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-md bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Crear cuenta"}),e.jsx("p",{className:"text-base-content/70 text-sm mt-1",children:"Completa el formulario para registrarte"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("ul",{className:"steps flex",children:[e.jsx("li",{className:S("step",{"step-primary":s>0}),onClick:()=>r(1)}),e.jsx("li",{className:S("step",{"step-primary":s>1})})]})}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[s===1&&e.jsxs(e.Fragment,{children:[e.jsx(y,{label:"Nombre",registration:a.register("first_name"),error:a.formState.errors.first_name}),e.jsx(y,{label:"Apellido paterno",registration:a.register("last_name_paterno"),error:a.formState.errors.last_name_paterno}),e.jsx(y,{label:"Apellido materno",registration:a.register("last_name_materno"),error:a.formState.errors.last_name_materno}),e.jsx(Ne,{label:"Género",registration:a.register("gender"),error:a.formState.errors.gender,options:[{label:"Femenino",value:"f"},{label:"Masculino",value:"m"}]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{type:"button",onClick:n,className:"btn btn-primary",children:"Siguiente"})})]}),s===2&&e.jsxs(e.Fragment,{children:[e.jsx(y,{label:"DNI",registration:a.register("dni"),error:a.formState.errors.dni}),e.jsx(y,{label:"Correo electrónico",registration:a.register("email"),error:a.formState.errors.email}),e.jsx(y,{label:"Teléfono",registration:a.register("phone"),error:a.formState.errors.phone}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(L,{label:"Contraseña",registration:a.register("new_password"),error:a.formState.errors.new_password}),e.jsx(L,{label:"Confirmar contraseña",registration:a.register("confirm_password"),error:a.formState.errors.confirm_password})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Crear cuenta"})})]})]}),e.jsxs("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300",children:[e.jsx("span",{children:"¿Ya tienes cuenta? "}),e.jsx(C,{to:"/login",replace:!0,className:"link link-primary font-semibold",children:"Inicia sesión"})]})]})})},Nt=$({dni:j().min(7,"El DNI debe tener al menos 7 caracteres").max(10,"El DNI no debe superar los 10 caracteres")}),wt=()=>{var a;const t=H(Nt),s=M({mutationFn:te.recoverAccount,onError:()=>R.error("Hubo un problema al enviar el correo con las instrucciones. Intenta nuevamente"),onSuccess:()=>t.reset()}),r=t.handleSubmit(o=>s.mutate(o.dni));return s.isSuccess?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-sm bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Recuperar cuenta"}),e.jsxs("p",{className:"text-base-content/70 text-sm mt-1",children:["Se envió un correo con las instrucciones a ",e.jsx("span",{className:"font-bold",children:(a=s.data)==null?void 0:a.email})]})]}),e.jsx("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300",children:e.jsx(C,{to:"/login",replace:!0,className:"link link-primary font-semibold",children:"Iniciar sesión"})})]})}):e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-sm bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Recuperar cuenta"}),e.jsx("p",{className:"text-base-content/70 text-sm mt-1",children:"Ingresa tu DNI para recuperar tu cuenta"})]}),e.jsxs("form",{onSubmit:r,className:"space-y-5",children:[e.jsx(y,{label:"DNI",registration:t.register("dni"),error:t.formState.errors.dni}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-block",disabled:s.isPending,children:s.isPending?"Enviando...":"Enviar instrucciones"})]}),e.jsxs("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300",children:[e.jsx("span",{children:"¿Ya recordaste tu contraseña? "}),e.jsx(C,{to:"/login",replace:!0,className:"link link-primary font-semibold",children:"Iniciar sesión"})]})]})})},we=d.createContext(void 0),ve=()=>{const t=d.useContext(we);if(!t)throw new Error("useModal debe ser usado dentro de un ModalProvider");return t},Se=()=>{const[t,s]=d.useState(window.innerWidth<768);return d.useEffect(()=>{const r=()=>{s(window.innerWidth<768)};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),{isMobile:t}},vt=()=>{var l,x,u;const t=z(),{openModal:s}=ve(),{user:r,logout:a}=V(),{isMobile:o}=Se(),[n,i]=d.useState(!o),m=async()=>{await s("Cerrar sesión","¿Estás seguro de que quieres cerrar sesión?")&&a()},c=()=>{o&&i(!1)};return e.jsxs("div",{className:"min-h-screen flex flex-col md:grid md:grid-cols-[250px_1fr] bg-base-200",children:[o&&e.jsxs("div",{className:"flex items-center justify-between bg-base-100 p-4",children:[e.jsx("button",{onClick:()=>i(!n),className:"btn btn-ghost",children:e.jsx(ke,{className:"w-6 h-6"})}),e.jsx("div",{className:"text-lg font-bold",children:"Dashboard"})]}),(n||!o)&&e.jsxs("aside",{className:"bg-base-100 border-b md:border-b-0 md:border-r border-base-300 p-4 flex flex-col space-y-6 md:static absolute w-full md:w-auto z-50",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[(l=r==null?void 0:r.user_info)!=null&&l.avatarUrl?e.jsx("img",{src:r.user_info.avatarUrl,alt:"Avatar",className:"w-20 h-20 md:w-24 md:h-24 rounded-full object-cover mb-2"}):e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-full bg-base-300 flex items-center justify-center mb-2",children:e.jsx(De,{className:"w-10 h-10 md:w-12 md:h-12 text-base-content/70"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-base md:text-lg",children:((x=r==null?void 0:r.user_info)==null?void 0:x.username)??""}),e.jsx("p",{className:"text-xs md:text-sm text-base-content/70",children:((u=r==null?void 0:r.user_info)==null?void 0:u.first_name)??""})]})]}),e.jsxs("nav",{className:"flex flex-col items-start gap-2",children:[e.jsxs(C,{to:"/dashboard",onClick:c,className:`btn btn-ghost justify-start w-full ${t.pathname==="/dashboard"?"btn-active":""}`,children:[e.jsx(Pe,{className:"w-5 h-5 mr-2"})," Inicio"]}),e.jsxs(C,{to:"/dashboard/documentos/firmar",onClick:c,className:`btn btn-ghost justify-start w-full ${t.pathname==="/dashboard/documentos/firmar"?"btn-active":""}`,children:[e.jsx(Ie,{className:"w-5 h-5 mr-2"})," ",e.jsx("span",{className:"text-start",children:"Documentos por Firmar"})]}),e.jsxs(C,{to:"/dashboard/perfil",onClick:c,className:`btn btn-ghost justify-start w-full ${t.pathname==="/dashboard/perfil"?"btn-active":""}`,children:[e.jsx(Le,{className:"w-5 h-5 mr-2"})," Mi Perfil"]}),e.jsxs("button",{onClick:()=>{c(),m()},className:"btn btn-ghost text-error justify-start w-full",children:[e.jsx(Re,{className:"w-5 h-5 mr-2"})," Cerrar Sesión"]})]})]}),e.jsx(Me,{className:"flex-1 overflow-y-auto",children:e.jsx(Fe,{})})]})},se={updateProfile:async t=>(console.log(t),await mt({baseUrl:I,path:"/v1/global/users/session",body:t})),getProfile:async()=>T({baseUrl:I,path:"/v1/global/users/session"})},St=$({first_name:j("Nombre requerido"),last_name_paterno:j("Apellido paterno requerido"),last_name_materno:j("Apellido materno requerido"),email:je("Correo requerido"),phone:ye("Debe ser un número de celular válido de 9 dígitos"),gender:j("Género requerido").oneOf(["f","m"],"Selecciona un género válido"),current_password:Q(),new_password:Q(),confirm_password:Q().oneOf([ie("new_password")],"Las nuevas contraseñas no coinciden")}),_t=()=>{const t=M({mutationFn:se.updateProfile,onSuccess:()=>{X.success("Perfil actualizado exitosamente"),s.setValue("current_password",""),s.setValue("new_password",""),s.setValue("confirm_password","")},onError:()=>X.error("Error al actualizar el perfil")}),s=H(St),{isLoading:r,isError:a,data:o,refetch:n}=Z({queryKey:["profile"],queryFn:se.getProfile});d.useEffect(()=>{o!=null&&s.reset({email:o.email,first_name:o.first_name,gender:o.gender,last_name_materno:o.last_name_materno,last_name_paterno:o.last_name_paterno,phone:o.phone,current_password:"",new_password:"",confirm_password:""})},[o]);const i=m=>t.mutate(m);return r?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("span",{className:"loading loading-spinner loading-lg"})}):a?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen space-y-4",children:[e.jsx("p",{className:"text-lg font-semibold text-error",children:"No se pudo cargar tu perfil."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>n(),children:"Reintentar"})]}):e.jsxs("div",{className:"flex flex-col w-full h-full px-4 md:px-10 py-8 space-y-10",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Mi Perfil"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Actualiza tu información personal"})]}),e.jsxs("form",{onSubmit:s.handleSubmit(i),className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(y,{label:"Nombre",registration:s.register("first_name"),error:s.formState.errors.first_name}),e.jsx(y,{label:"Apellido paterno",registration:s.register("last_name_paterno"),error:s.formState.errors.last_name_paterno}),e.jsx(y,{label:"Apellido materno",registration:s.register("last_name_materno"),error:s.formState.errors.last_name_materno}),e.jsx(y,{label:"Correo electrónico",registration:s.register("email"),error:s.formState.errors.email}),e.jsx(y,{label:"Teléfono",registration:s.register("phone"),error:s.formState.errors.phone}),e.jsx(Ne,{label:"Género",registration:s.register("gender"),error:s.formState.errors.gender,options:[{label:"Femenino",value:"f"},{label:"Masculino",value:"m"}]}),e.jsxs("div",{className:"md:col-span-2 pt-8 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Cambio de contraseña"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completa los campos si deseas actualizar tu contraseña."})]}),e.jsx(L,{label:"Contraseña actual",registration:s.register("current_password"),error:s.formState.errors.current_password}),e.jsx(L,{label:"Nueva contraseña",registration:s.register("new_password"),error:s.formState.errors.new_password}),e.jsx(L,{label:"Confirmar nueva contraseña",registration:s.register("confirm_password"),error:s.formState.errors.confirm_password})]}),e.jsx("div",{className:"md:col-span-2 flex justify-end",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:s.formState.isSubmitting,children:s.formState.isSubmitting?"Guardando...":"Guardar cambios"})})]})]})},q={getDocumentoResumen:async(t,s,r)=>T({path:`/api/v1/public/documentos/${t}/${s}`,abortSignal:r}),getDocumentos:async t=>T({path:"/api/v1/public/documentos",abortSignal:t}),downloadPdf:async(t,s)=>await dt({path:`/api/v1/procesos/documentos/download/${t}`,progress:r=>s==null?void 0:s(r)}),signPDF:async t=>T({path:`/api/v1/public/sign/documento/${t}`})},Ct=function(){const t=document.createElement("a");return function(s,r){const a=window.URL.createObjectURL(r);t.href=a,t.download=s,t.click(),window.URL.revokeObjectURL(a)}}(),Et=()=>{const t=z(),{openModal:s}=ve(),{isMobile:r}=Se();let a=Oe();a??(a=window.innerHeight);const o=Y(),{pdfname:n,estado:i}=le(),[m,c]=d.useState(i==="published"),[l,x]=d.useState(!0),[u,h]=d.useState(null),[b,_]=d.useState(null),[w,v]=d.useState(null),[B,D]=d.useState(1),P=d.useRef(!1),k=M({mutationFn:q.signPDF,onSuccess:()=>{R.success("Documento firmado correctamente."),c(!1)},onError:g=>R.error(`Error al firmar el documento: ${g.message}`)}),W=async()=>{if(!n){alert("No se ha seleccionado ningún documento para firmar.");return}await s("Confirmar Firma","¿Estás seguro de que deseas firmar este documento?")&&k.mutate(n)};return d.useEffect(()=>{P.current||(P.current=!0,(async()=>{if(n==null){h("No PDF name provided"),x(!1);return}try{const g=await q.downloadPdf(n);_(new File([g],n,{type:"application/pdf"})),x(!1)}catch(g){h(g instanceof Error?g.message:"An unknown error occurred"),x(!1)}})())},[n]),l?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):u!=null?e.jsxs("div",{className:"flex items-center justify-center h-screen text-red-500",children:["Error: ",typeof u=="string"?u:u.message]}):b==null?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Unable to load PDF."}):e.jsxs("div",{className:S("w-full relative bg-base-100"),style:{height:r?a-72:a},children:[e.jsxs("div",{className:"absolute bg-black/20 w-full h-10 top-0 flex justify-between items-center px-4 z-10",children:[e.jsx(Ae,{className:"w-5 h-5 cursor-pointer select-none",onClick:()=>{if(console.log(t.state),t.state.from==="_link"){o("/dashboard",{replace:!0});return}o(-1)}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>Ct(b.name,b),children:e.jsx(Te,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-2"}),e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>D(g=>Math.min(g+.1,3)),children:e.jsx(qe,{className:"w-5 h-5"})}),e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>D(g=>Math.max(g-.1,.5)),children:e.jsx(Ue,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-auto flex flex-col items-center gap-4 h-full pt-10",children:e.jsx(de,{file:b,onLoadSuccess:({numPages:g})=>v(g),loading:"Loading PDF...",error:"Error while loading PDF",className:"flex flex-col items-center w-full",children:Array.from(new Array(w),(g,F)=>e.jsx(me,{pageNumber:F+1,width:r?window.innerWidth:800,scale:B,className:"shadow-md rounded-lg border border-base-300"},`page_${F+1}`))})}),m&&e.jsx("div",{className:"absolute bottom-0 h-20 w-full flex justify-center items-center gap-4 z-[9999]",children:e.jsx("button",{className:"btn btn-primary flex items-center gap-2",onClick:W,disabled:l,children:k.isPending?e.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Firmando..."})}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Firmar Documento"}),e.jsx($e,{})]})})})]})},re=800;function kt(){const[t,s]=d.useState("./sample.pdf"),[r,a]=d.useState(),[o]=d.useState(),n=m=>{var l;const c=(l=m.target.files)==null?void 0:l[0];c&&s(c)},i=({numPages:m})=>{a(m)};return e.jsxs("div",{children:[e.jsx("header",{children:e.jsx("h1",{children:"react-pdf sample"})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"file",children:"Load PDF:"}),e.jsx("input",{type:"file",onChange:n}),e.jsx("div",{style:{border:"2px solid #000",padding:"10px"},children:e.jsx(de,{file:t,onLoadSuccess:i,children:Array.from({length:r??0},(m,c)=>e.jsx(me,{pageNumber:c+1,width:o?Math.min(o,re):re},c))})})]})]})}const Dt=({initialOffset:t=0,initialLimit:s=1,total:r,onUpdate:a})=>{const[o,n]=d.useState(t),[i,m]=d.useState(s),[c,l]=d.useState(!1),[x,u]=d.useState(""),h=d.useRef(null),b=o+1,_=Math.min(o+i,r),w=i>1?`${b}-${_}`:`${b}`;d.useEffect(()=>{const f=p=>{h.current&&!h.current.contains(p.target)&&k()};return c&&document.addEventListener("mousedown",f,{capture:!0}),()=>document.removeEventListener("mousedown",f)},[c]);const v=(f,p,O)=>Math.max(Math.min(f,O),p),B=f=>{const[p,O]=f.trim().split(/[-,;\s]+/);let A=parseInt(p,10),G=O?parseInt(O,10):A;return A=v(A,1,r),G=v(G,1,r),{minimum:A-1,maximum:G}},D=(f,p)=>{n(f),m(p),a({offset:f,limit:p}),l(!1)},P=f=>{let p=o+i*f;p>=r?p=0:p<0&&i===1?p=r-1:p<0&&i>1&&(p=r-(r%i||i)),D(p,i)},k=()=>{const{minimum:f,maximum:p}=B(x);!isNaN(f)&&!isNaN(p)&&f<p?D(f,p-f):l(!1)},W=f=>{u(f.target.value)},g=f=>{f.key==="Enter"?(f.preventDefault(),k()):f.key==="Escape"&&(f.preventDefault(),l(!1))},F=()=>{c||(u(w),l(!0),setTimeout(()=>{var f;return(f=h.current)==null?void 0:f.focus()},0))};return e.jsxs("nav",{className:"flex gap-2 h-full items-center my-2","aria-label":"Pager",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[c?e.jsx("input",{ref:h,type:"text",className:"text-sm h-5 p-0 m-0 text-end outline-none input-sm",value:x,onBlur:k,onChange:W,onKeyDown:g}):e.jsx("span",{className:"text-sm border-transparent cursor-pointer",onClick:F,children:w}),e.jsx("span",{className:"text-sm",children:"/"}),e.jsx("span",{className:"text-sm",children:r})]}),e.jsxs("span",{className:"btn-group flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm","aria-label":"Previous",onClick:()=>P(-1),children:e.jsx(ze,{})}),e.jsx("button",{type:"button",className:"btn btn-sm","aria-label":"Next",onClick:()=>P(1),children:e.jsx(Ve,{})})]})]})},Pt=({table:t})=>e.jsx("thead",{className:"bg-gray-200 dark:bg-gray-800 border-b border-gray-300 dark:border-gray-700",children:t.getHeaderGroups().map(s=>e.jsx("tr",{children:s.headers.map(r=>{var a,o;return e.jsx("th",{className:S("px-4 py-3 font-semibold text-xs text-gray-600 dark:text-gray-200 uppercase tracking-wider",{"text-left":r.column.id!=="actions","text-center":r.column.id==="actions","text-right":["amount","price"].includes(r.column.id)}),children:r.isPlaceholder?null:typeof r.column.columnDef.header=="string"?r.column.columnDef.header:(o=(a=r.column.columnDef).header)==null?void 0:o.call(a,r.getContext())},r.id)})},s.id))}),It=({error:t,onRetry:s,columns:r})=>e.jsx("tr",{children:e.jsxs("td",{colSpan:r.length,className:"p-6 text-center text-red-500 dark:text-red-400",children:[e.jsx("div",{children:typeof t=="string"?t:t.message}),s&&e.jsx("button",{onClick:s,className:"mt-2 px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/80",children:"Intentar nuevamente"})]})}),_e=d.createContext(null),Lt=()=>{const t=d.useContext(_e);if(!t)throw new Error("useContextMenu must be used inside ContextMenuProvider");return t};function Rt({table:t,onRowClick:s,onRowDoubleClick:r,contextMenuAcctions:a}){const o=d.useRef(null),{openContextMenu:n}=Lt(),[i,m]=d.useState(null),c=(l,x)=>u=>{if(a==null)return;let h=[];typeof a=="function"?h=a(l):h=a,h.length!==0&&(m(x),n(u,h,l))};return e.jsx(e.Fragment,{children:t.getRowModel().rows.map(l=>{const x=l.id;return e.jsx("tr",{onClick:()=>{m(x),s==null||s(l.original)},onDoubleClick:()=>r==null?void 0:r(l.original),className:S("hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition-all duration-200 relative",{"bg-primary/10 dark:bg-primary/20":l.getIsSelected(),"bg-primary/5 dark:bg-primary/10":i===x&&!l.getIsSelected(),"after:content-[''] after:absolute after:inset-y-0 after:left-0 after:w-1 after:bg-primary":i===x}),onContextMenu:u=>c(l.original,x)(u),onTouchStart:u=>{o.current=setTimeout(()=>{c(l.original,x)(u)},500)},onTouchEnd:()=>{o.current&&clearTimeout(o.current)},children:l.getVisibleCells().map(u=>e.jsx("td",{className:S("px-4 py-3 text-sm text-gray-700 dark:text-gray-300 border-b border-gray-200 dark:border-gray-700","select-none",{"text-left":u.column.id!=="actions","text-center":u.column.id==="actions","text-right":["amount","price"].includes(u.column.id)}),children:He(u.column.columnDef.cell,u.getContext())},u.id))},x)})})}function Mt({data:t,columns:s,loading:r=!1,error:a,rowSelectionEnabled:o=!1,onRowClick:n,onRowDoubleClick:i,getRowId:m,onRetry:c,contextMenuAcctions:l}){const[x,u]=d.useState({}),h=Be({data:t,columns:s,state:{rowSelection:x},enableRowSelection:o,getRowId:m?b=>m(b):void 0,getCoreRowModel:We(),onRowSelectionChange:u});return e.jsx("div",{className:S("overflow-x-auto border border-gray-200 dark:border-gray-700 rounded-md shadow-lg"),children:e.jsxs("table",{className:"w-full table-auto text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(Pt,{table:h}),e.jsx("tbody",{children:r?e.jsx("tr",{children:e.jsx("td",{colSpan:s.length,className:"p-6 text-center text-gray-500 dark:text-gray-400",children:"Cargando..."})}):a?e.jsx(It,{error:a,onRetry:c,columns:s}):e.jsx(Rt,{table:h,onRowClick:n,onRowDoubleClick:i,contextMenuAcctions:l})})]})})}const Ft=({onSearch:t})=>{const[s,r]=d.useState(""),a=()=>{t&&t(s)},o=n=>{n.key==="Enter"&&a()};return e.jsxs("div",{className:"mb-4 flex justify-center",children:[e.jsxs("div",{className:"relative w-full max-w-xs",children:[e.jsx("input",{type:"text",className:S("w-full","input-sm","pl-10","pr-4","py-2","rounded-md","border","border-gray-300","bg-transparent","text-gray-800","dark:text-gray-200","dark:border-gray-700","dark:focus:ring-0","focus:outline-none","focus:ring-2","focus:ring-gray-400","focus:border-gray-400","dark:focus:ring-gray-500","dark:focus:border-gray-500"),placeholder:"Search...",value:s,onChange:n=>r(n.target.value),onKeyDown:o}),e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 18l6-6-6-6"})})})]}),e.jsx("button",{type:"button",onClick:a,className:S("ml-2","px-2","py-2","btn","btn-sm","h-[36px]","filter-reset","border","border-gray-300","bg-transparent","text-gray-800","dark:text-gray-200","dark:border-gray-700","dark:focus:ring-0","focus:outline-none","focus:ring-2","focus:ring-gray-400","focus:border-gray-400","dark:focus:ring-gray-500","dark:focus:border-gray-500"),children:e.jsx(Ge,{})})]})},Ot=t=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.title&&e.jsx("h2",{className:"text-2xl font-semibold",children:t.title}),t.onSearch&&e.jsx(Ft,{onSearch:t.onSearch})]})}),e.jsx(Mt,{...t}),t.pageProps&&e.jsx("div",{className:"flex justify-end",children:e.jsx(Dt,{initialLimit:t.pageProps.initialLimit,initialOffset:t.pageProps.initialOffset,total:t.pageProps.total,onUpdate:t.pageProps.onUpdate})})]}),At=t=>{const s=Je();return t(s)},Tt=t=>{const s=d.useMemo(()=>["LISTA/DOCUMENTOS",t],[t]),r=ce(),{data:a,error:o,isFetching:n,isError:i}=Z({queryKey:s,queryFn:({signal:c})=>q.getDocumentos(c)});return{documentos:a??[],refresh:()=>r.invalidateQueries({queryKey:s}),isFetching:n,error:o,isError:i}},ne=t=>(t??"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();function qt(t,s){const r=ne(String(s??"").trim());return r.length<2?t:t.filter(a=>Object.entries(a).some(([o,n])=>{if(n==null)return!1;let i=ne(String(n));return typeof n=="number"&&(i=`#${i}`),o.endsWith("codigo")&&!i.startsWith("#")&&(i=`.${i}`),i.includes(r)}))}const Ut=t=>{const[s,r]=d.useState("");return[d.useMemo(()=>!t||!s.trim()?t??[]:s.split(";").map(n=>n.trim()).filter(Boolean).reduce((n,i)=>qt(n,i),t),[t,s]),r]},$t={"01":"Enero","02":"Febrero","03":"Marzo","04":"Abril","05":"Mayo","06":"Junio","07":"Julio","08":"Agosto","09":"Septiembre",10:"Octubre",11:"Noviembre",12:"Diciembre"},zt=At(t=>[t.accessor("empresa_descripcion",{header:"Empresa",cell:({getValue:s})=>s()}),t.accessor("descripcion_proceso",{header:"Descripción del Proceso",cell:({getValue:s})=>s()}),t.accessor("anio",{header:"Año",cell:({getValue:s})=>s()}),t.accessor("mes",{header:"Mes",cell:({getValue:s})=>{const r=s();return r==null||typeof r!="string"?r:$t[r]}}),t.accessor("item",{header:"Semana",cell:({getValue:s})=>s()}),t.accessor("estado",{header:"Estado",cell:({getValue:s})=>{const r=s();let a,o,n;switch(r){case"published":a=e.jsx(Xe,{className:"w-5 h-5"}),o="bg-green-500 text-white",n="Pendiente";break;case"signed":a=e.jsx(Ke,{className:"w-5 h-5"}),o="bg-blue-500 text-white",n="Firmado";break;case"canceled":a=e.jsx(Qe,{className:"w-5 h-5"}),o="bg-red-500 text-white",n="Cancelado";break;default:a=null,o="bg-gray-500 text-white",n="-"}return e.jsxs("div",{className:`max-w-[150px] grid items-center grid-cols-[1fr_3fr] p-2 rounded-lg ${o} dark:bg-opacity-20`,children:[e.jsx("p",{children:a}),e.jsx("p",{children:n})]})}})]),ae=({tosign:t})=>{const s=Y(),{documentos:r,isFetching:a,error:o,refresh:n}=Tt(),i=d.useMemo(()=>t?r.filter(l=>l.estado=="published"):r,[t,r]),[m,c]=Ut(i);return e.jsx("div",{className:"p-4 md:p-8",children:e.jsx(Ot,{title:"Lista de documentos",loading:a,error:o,onRetry:n,columns:zt,data:m,onSearch:c,contextMenuAcctions:l=>[{label:"Ver Documeto",onClick:()=>{if(l.signed_pdf_name){s(`/dashboard/pdf/${l.signed_pdf_name}/${l.estado}`);return}if(l.nombre_pdf){s(`/dashboard/pdf/${l.nombre_pdf}/${l.estado}`);return}}}],onRowDoubleClick:l=>{if(l.signed_pdf_name){s(`/dashboard/pdf/${l.signed_pdf_name}/${l.estado}`);return}if(l.nombre_pdf){s(`/dashboard/pdf/${l.nombre_pdf}/${l.estado}`);return}}})})},Vt=()=>{const{empresa:t,origin:s,record_codigo:r}=le();return t==null||s==null||r==null?e.jsx(E,{to:"/dashboard",replace:!0}):e.jsx(Ht,{empresa:t,origin:s,record_codigo:r})},Ht=({empresa:t,origin:s,record_codigo:r})=>{const a=d.useMemo(()=>["RESUMEN_INFO_DOC_RECORD",t,s,r],[t,s,r]),o=ce(),{data:n,error:i,isLoading:m}=Z({queryKey:a,queryFn:({signal:l})=>q.getDocumentoResumen(t,r,l)}),c=()=>o.invalidateQueries({queryKey:a});return m?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):i!=null?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen text-red-500",children:[e.jsxs("p",{children:["Error: ",typeof i=="string"?i:i.message]}),e.jsx("button",{onClick:c,className:"mt-4 px-6 py-2 bg-red-600 text-white rounded-lg shadow-md hover:bg-red-700 transition",children:"Retry"})]}):n==null||n.length===0?e.jsx(E,{to:"/dashboard",replace:!0}):n[0].signed_pdf_name?e.jsx(E,{to:`/dashboard/pdf/${n[0].signed_pdf_name}/${n[0].estado}`,replace:!0,state:{from:"_link"}}):n[0].nombre_pdf?e.jsx(E,{to:`/dashboard/pdf/${n[0].nombre_pdf}/${n[0].estado}`,replace:!0,state:{from:"_link"}}):e.jsx("div",{className:"flex flex-col items-center justify-center h-screen text-red-500",children:e.jsx("button",{onClick:c,className:"mt-4 px-6 py-2 bg-red-600 text-white rounded-lg shadow-md hover:bg-red-700 transition",children:"Retry"})})},oe=({children:t})=>{const s=z(),{user:r}=V(),a=!!r;let o;return s.pathname.startsWith("/_sign/")&&(o={from:s.pathname}),a?t:e.jsx(E,{to:"/login",replace:!0,state:o})},K=({children:t})=>{const{user:s}=V(),r=!!s,a=z();return r?a.state.from?e.jsx(E,{to:a.state.from,replace:!0}):e.jsx(E,{to:"/dashboard",replace:!0}):t},Bt=()=>e.jsx(Ye,{children:e.jsxs(Ze,{children:[e.jsx(N,{path:"/login",element:e.jsx(K,{children:e.jsx(bt,{})})}),e.jsx(N,{path:"/register",element:e.jsx(K,{children:e.jsx(yt,{})})}),e.jsx(N,{path:"/recover",element:e.jsx(K,{children:e.jsx(wt,{})})}),e.jsx(N,{path:"/_sign/:empresa/:record_codigo/:origin",element:e.jsx(oe,{children:e.jsx(Vt,{})})}),e.jsxs(N,{path:"/dashboard",element:e.jsx(oe,{children:e.jsx(vt,{})}),children:[e.jsx(N,{index:!0,element:e.jsx(ae,{})}),e.jsx(N,{path:"pdf/:pdfname/:estado",element:e.jsx(Et,{})}),e.jsx(N,{path:"documentos/firmar",element:e.jsx(ae,{tosign:!0})}),e.jsx(N,{path:"perfil",element:e.jsx(_t,{})}),e.jsx(N,{path:"sample",element:e.jsx(kt,{})})]}),e.jsx(N,{path:"*",element:e.jsx(E,{to:"/login",replace:!0})})]})}),Wt=({children:t})=>{const[s,r]=d.useState(()=>{try{const n=localStorage.getItem("session");if(n==null)return null;const i=localStorage.getItem("last_token_used");if(i!=null){const m=new Date(i),c=new Date;if(!isNaN(m.getTime())&&c.getTime()-m.getTime()>18e6)return localStorage.removeItem("session"),null}return n?JSON.parse(n):null}catch(n){return console.error("Error retrieving session data from localStorage",n),null}}),a=n=>{r(n),localStorage.setItem("session",JSON.stringify(n))},o=()=>{r(null),localStorage.removeItem("session")};return e.jsx(ue.Provider,{value:{user:s,login:a,logout:o},children:t})},Gt=({children:t})=>{const[s,r]=d.useState(!1),[a,o]=d.useState(()=>{}),[n,i]=d.useState("Confirmación"),[m,c]=d.useState("¿Estás seguro de esta acción?"),l=(_,w)=>(r(!0),i(_),c(w),new Promise(v=>o(()=>v))),x=()=>{r(!1)},u=()=>{a(!0),x()},h=()=>{a(!1),x()},b=()=>s?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{className:"bg-base-100 p-6 rounded-lg shadow-lg w-full max-w-sm",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:n}),e.jsx("p",{className:"text-base-content/80 mb-6",children:m}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{className:"btn btn-ghost",onClick:h,children:"Cancelar"}),e.jsx("button",{className:"btn btn-primary",onClick:u,children:"Confirmar"})]})]})}):null;return e.jsx(we.Provider,{value:{openModal:l},children:e.jsxs(e.Fragment,{children:[e.jsx(b,{}),t]})})},Jt=({children:t})=>{const[s,r]=d.useState({isOpen:!1,x:0,y:0,items:[]}),a=d.useCallback((n,i,m)=>{n.preventDefault();let c=0,l=0;"touches"in n&&n.touches.length>0?(c=n.touches[0].clientX,l=n.touches[0].clientY):"clientX"in n&&(c=n.clientX,l=n.clientY);const x=10,u=180,h=200,b=window.innerWidth,_=window.innerHeight;let w=c,v=l;c+u+x>b&&(w=b-u-x),l+h+x>_&&(v=_-h-x),r({isOpen:!0,x:w,y:v,items:i,data:m})},[]),o=d.useCallback(()=>{r(n=>({...n,isOpen:!1}))},[]);return d.useEffect(()=>{const n=()=>{o()};return window.addEventListener("click",n),window.addEventListener("scroll",n),()=>{window.removeEventListener("click",n),window.removeEventListener("scroll",n)}},[o]),e.jsxs(_e.Provider,{value:{openContextMenu:a,closeContextMenu:o,state:s},children:[t,s.isOpen&&e.jsx("div",{className:"absolute  min-w-[180px] rounded-md shadow-md border border-base-300 bg-base-100 text-base-content z-50 overflow-hidden",style:{top:s.y,left:s.x},onClick:n=>n.stopPropagation(),children:s.items.map((n,i)=>{const m=n.icon,c=n.disabled;return e.jsxs("button",{onClick:()=>{c||n.onClick(s.data),o()},className:`flex items-center gap-2 w-full text-left px-4 py-2 text-sm ${c?"cursor-not-allowed text-base-content/50 hover:bg-transparent":"hover:bg-base-200"}`,disabled:c,children:[m&&e.jsx(m,{className:`w-4 h-4 ${c?"opacity-50":""}`}),e.jsx("span",{className:"select-none",children:n.label})]},i)})})]})};at.workerSrc=new URL("/assets/pdf.worker.min-GB3t0DcA.mjs",import.meta.url).toString();const Qt=new et;tt.createRoot(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsxs(Jt,{children:[e.jsx(st,{}),e.jsx(Gt,{children:e.jsxs(rt,{client:Qt,children:[e.jsx(Wt,{children:e.jsx(Bt,{})}),e.jsx(nt,{initialIsOpen:!1})]})})]})}));
