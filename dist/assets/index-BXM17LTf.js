import{r as c,u as Pe,o as Ie,e as W,f as V,g as U,j as e,L as k,h as Y,k as me,l as Z,n as E,V as P,p as G,M as De,U as Re,H as Le,S as Fe,q as Me,s as Oe,t as Ae,D as Ue,O as Te,v as ee,x as qe,y as ue,C as $e,A as ze,Z as Be,z as We,P as Ve,B as Ge,E as He,F as Je,G as Qe,I as Ke,J as Xe,K as Ye,N as xe,Q as Ze,R as et,T as tt,W as D,X as st,Y as rt,_ as nt,$ as at,a0 as ot,a1 as _,a2 as it,a3 as lt,a4 as ct,a5 as dt,a6 as mt}from"./react-DsJtaBO0.js";import{D as fe,P as he,_ as ut}from"./pdf-AIDK7-hu.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();const pe=c.createContext(void 0),H=()=>{const t=c.useContext(pe);if(!t)throw new Error("useSession debe ser usado dentro de un SessionProvider");return t};function J(t,s){const r=Pe({resolver:Ie(t),defaultValues:s==null?void 0:s.defaultValues});return{...r,handleSubmit:(o,a)=>r.handleSubmit(o,i=>{a&&a(i)})}}class B extends Error{constructor(s){super(s),this.name="ApiError"}}class xt extends Error{constructor(){super("No hay conexi√≥n a internet üòµ"),this.name="InternetError"}}class ft extends Error{constructor(){super("No hay conexi√≥n con el servicio üòµ"),this.name="InternetError"}}class ht extends Error{constructor(){super("Error en la comunicacion con el servicio üò¢"),this.name="SyntaxJsonError"}}const pt=()=>{const t=localStorage.getItem("session");if(!t)return null;const{token:s}=JSON.parse(t),r=new Date;return localStorage.setItem("last_token_used",r.toISOString()),s},te=async(t,s)=>{try{const r=pt();return await fetch(t,{...s,headers:{...s==null?void 0:s.headers,...r&&{Authorization:r}}})}catch(r){throw r instanceof TypeError?new ft:r}},se=(...t)=>{const s=new RegExp("^/+"),r=new RegExp("/+$");return t.map(n=>n.replace(s,"").replace(r,"")).filter(Boolean).join("/")},M="http://192.16.0.15:7771/",re="http://192.16.0.10:8765/",ne=async({baseUrl:t,path:s,method:r,body:n,abortSignal:o,fullResponse:a=!1})=>{const i=await te(se(t??re,s),{method:r,headers:{"Content-Type":"application/json"},...n?{body:JSON.stringify(n)}:{},signal:o}),m=await i.json();if(!i.ok){const d=typeof(m==null?void 0:m.message)=="string"?m.message:"Unexpected error";throw new B(d)}return a?m:m.data},ge=async t=>{try{const s=await te(se(t.baseUrl??re,t.path),{method:t.method??"GET",headers:{"Content-Type":"application/json"},...t.body?{body:JSON.stringify(t.body)}:{},signal:t.abortSignal});if(!s.ok){const m=await s.json(),d=typeof(m==null?void 0:m.message)=="string"?m.message:"Unexpected error";throw new B(d)}const r=s.body;if(!r)throw new B("Archivo no encontrado");const n=r.getReader(),o=parseInt(s.headers.get("Content-Length")??"");let a=0;const i=[];for(;;){const{done:m,value:d}=await n.read();if(m)break;i.push(d),a+=d.length,t.progress(Math.round(a/o*100))}return new Blob(i)}catch(s){throw s instanceof SyntaxError?new ht:s instanceof TypeError?new xt:s}},$=t=>ne({...t,method:"GET"}),z=t=>ne({...t,method:"POST"}),gt=t=>ne({...t,method:"PUT"}),bt=async({baseUrl:t,path:s,body:r,method:n="POST",abortSignal:o})=>{const a=await te(se(t??re,s),{method:n,body:r,signal:o}),i=await a.json();if(!a.ok){const m=i.message;throw new B(m)}return i.data},ae={login:async t=>await z({baseUrl:M,path:"/v1/global/login",body:t}),register:async t=>await z({baseUrl:M,path:"/v1/global/users",body:{username:t.dni,first_name:t.first_name,last_name_paterno:t.last_name_paterno,last_name_materno:t.last_name_materno,email:t.email,phone:t.phone,gender:t.gender,password:t.new_password,origin_request:window.location.origin}}),recoverAccount:async t=>await z({baseUrl:M,path:"/v1/global/users/post/recovery/email",body:{dni:t,origin_request:window.location.origin}})},be="Este campo es requerido",jt="Introduce una direcci√≥n de correo electr√≥nico v√°lida",wt="El correo electr√≥nico es obligatorio",yt="Introduce un n√∫mero de celular v√°lido",je=t=>{if(t==null)return null;if(typeof t!="string")return t;const s=t.trim();return s===""?null:s},y=(t=be)=>W().transform(je).required(t),K=()=>W().transform(je).nullable().default(null),we=(t=wt)=>W().email(jt).required(t),Nt=/^(?:\+51)\s?[0-9]{3}\s?[0-9]{3}\s?[0-9]{3}$/,vt=t=>{if(t==null)return null;if(typeof t!="string")return t;const s=t.trim().replace(/\s+/g,"");return s===""?null:s.startsWith("+")?s:`+51 ${s}`},ye=(t=yt)=>W().transform(vt).test("valid-phone",t,s=>s==null||s===""?!0:Nt.test(s)).required(be),St=V({username:y("DNI requerido").min(7,"El DNI debe tener al menos 7 caracteres").max(10,"El DNI no debe superar los 10 caracteres"),password:y("Contrase√±a requerida").min(6,"La contrase√±a debe tener al menos 6 caracteres")}),_t=()=>{const{login:t}=H(),s=U({mutationFn:ae.login,onSuccess:o=>t(o),onError:()=>Y.error("Error al iniciar sesi√≥n")}),r=J(St,{defaultValues:{username:"",password:""}}),n=r.handleSubmit(({password:o,username:a})=>{s.mutate({password:o??"",username:a??""})});return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-sm bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Iniciar sesi√≥n"}),e.jsx("p",{className:"text-base-content/70 text-sm mt-1",children:"Ingresa tus credenciales para continuar"})]}),e.jsxs("form",{onSubmit:n,className:"space-y-5",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"DNI"})}),e.jsx("input",{type:"text",placeholder:"Ingresa tu DNI",className:"input input-bordered w-full",...r.register("username")}),r.formState.errors.username&&e.jsx("p",{className:"text-error text-xs mt-1",children:r.formState.errors.username.message})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"Contrase√±a"})}),e.jsx("input",{type:"password",placeholder:"Ingresa tu contrase√±a",className:"input input-bordered w-full",...r.register("password")}),r.formState.errors.password&&e.jsx("p",{className:"text-error text-xs mt-1",children:r.formState.errors.password.message})]}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-block",disabled:r.formState.isSubmitting,children:s.isPending?"Iniciando...":"Iniciar"})]}),e.jsxs("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300 space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{children:"¬øA√∫n no tienes cuenta? "}),e.jsx(k,{to:"/register",className:"link link-primary font-semibold",children:"Reg√≠strate"})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{children:"¬øOlvidaste tu contrase√±a? "}),e.jsx(k,{to:"/recover",className:"link link-primary font-semibold",children:"Recuperar cuenta"})]})]})]})})},C=({label:t,error:s,registration:r,placeholder:n,...o})=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{className:"font-medium",children:t}),e.jsx("input",{...r,...o,className:"input input-bordered w-full",placeholder:n}),s&&e.jsx("p",{className:"text-xs text-error mt-1",children:s.message})]}),Ne=({label:t,options:s,error:r,registration:n,...o})=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{className:"font-medium",children:t}),e.jsxs("select",{...n,...o,className:"select select-bordered w-full",children:[e.jsx("option",{value:"",children:"Selecciona una opci√≥n"}),s.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),r&&e.jsx("p",{className:"text-xs text-error mt-1",children:r.message})]}),O=({label:t,error:s,registration:r,...n})=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{className:"font-medium",children:t}),e.jsx("input",{type:"password",...r,...n,className:"input input-bordered w-full"}),s&&e.jsx("p",{className:"text-xs text-error mt-1",children:s.message})]}),Ct=V({dni:y().min(7,"El DNI debe tener al menos 7 caracteres").max(10,"El DNI no debe superar los 10 caracteres"),first_name:y("Nombre requerido"),last_name_paterno:y("Apellido paterno requerido"),last_name_materno:y("Apellido materno requerido"),email:we("Correo requerido"),phone:ye("Debe ser un n√∫mero de celular v√°lido de 9 d√≠gitos"),gender:y("G√©nero requerido").oneOf(["f","m"],"Selecciona un g√©nero v√°lido"),new_password:y().min(8,"La contrase√±a debe tener al menos 8 caracteres"),confirm_password:y().oneOf([me("new_password")],"Las nuevas contrase√±as no coinciden")}),Et=()=>{const t=Z(),[s,r]=c.useState(1),n=J(Ct),o=U({mutationFn:ae.register,onSuccess:()=>{P.success("Usuario registrado con √©xito"),t("/login",{replace:!0})},onError:()=>P.error("Error al registrar el usuario")}),a=async()=>{await n.trigger(["first_name","last_name_materno","last_name_paterno","gender"])&&r(2)},i=n.handleSubmit(m=>o.mutate(m));return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-md bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Crear cuenta"}),e.jsx("p",{className:"text-base-content/70 text-sm mt-1",children:"Completa el formulario para registrarte"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("ul",{className:"steps flex",children:[e.jsx("li",{className:E("step",{"step-primary":s>0}),onClick:()=>r(1)}),e.jsx("li",{className:E("step",{"step-primary":s>1})})]})}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[s===1&&e.jsxs(e.Fragment,{children:[e.jsx(C,{label:"Nombre",registration:n.register("first_name"),error:n.formState.errors.first_name}),e.jsx(C,{label:"Apellido paterno",registration:n.register("last_name_paterno"),error:n.formState.errors.last_name_paterno}),e.jsx(C,{label:"Apellido materno",registration:n.register("last_name_materno"),error:n.formState.errors.last_name_materno}),e.jsx(Ne,{label:"G√©nero",registration:n.register("gender"),error:n.formState.errors.gender,options:[{label:"Femenino",value:"f"},{label:"Masculino",value:"m"}]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{type:"button",onClick:a,className:"btn btn-primary",children:"Siguiente"})})]}),s===2&&e.jsxs(e.Fragment,{children:[e.jsx(C,{label:"DNI",registration:n.register("dni"),error:n.formState.errors.dni}),e.jsx(C,{label:"Correo electr√≥nico",registration:n.register("email"),error:n.formState.errors.email}),e.jsx(C,{label:"Tel√©fono",registration:n.register("phone"),error:n.formState.errors.phone}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(O,{label:"Contrase√±a",registration:n.register("new_password"),error:n.formState.errors.new_password}),e.jsx(O,{label:"Confirmar contrase√±a",registration:n.register("confirm_password"),error:n.formState.errors.confirm_password})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Crear cuenta"})})]})]}),e.jsxs("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300",children:[e.jsx("span",{children:"¬øYa tienes cuenta? "}),e.jsx(k,{to:"/login",replace:!0,className:"link link-primary font-semibold",children:"Inicia sesi√≥n"})]})]})})},kt=V({dni:y().min(7,"El DNI debe tener al menos 7 caracteres").max(10,"El DNI no debe superar los 10 caracteres")}),Pt=()=>{var n;const t=J(kt),s=U({mutationFn:ae.recoverAccount,onError:()=>P.error("Hubo un problema al enviar el correo con las instrucciones. Intenta nuevamente"),onSuccess:()=>t.reset()}),r=t.handleSubmit(o=>s.mutate(o.dni));return s.isSuccess?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-sm bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Recuperar cuenta"}),e.jsxs("p",{className:"text-base-content/70 text-sm mt-1",children:["Se envi√≥ un correo con las instrucciones a ",e.jsx("span",{className:"font-bold",children:(n=s.data)==null?void 0:n.email})]})]}),e.jsx("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300",children:e.jsx(k,{to:"/login",replace:!0,className:"link link-primary font-semibold",children:"Iniciar sesi√≥n"})})]})}):e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-sm bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Recuperar cuenta"}),e.jsx("p",{className:"text-base-content/70 text-sm mt-1",children:"Ingresa tu DNI para recuperar tu cuenta"})]}),e.jsxs("form",{onSubmit:r,className:"space-y-5",children:[e.jsx(C,{label:"DNI",registration:t.register("dni"),error:t.formState.errors.dni}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-block",disabled:s.isPending,children:s.isPending?"Enviando...":"Enviar instrucciones"})]}),e.jsxs("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300",children:[e.jsx("span",{children:"¬øYa recordaste tu contrase√±a? "}),e.jsx(k,{to:"/login",replace:!0,className:"link link-primary font-semibold",children:"Iniciar sesi√≥n"})]})]})})},ve=c.createContext(void 0),Se=()=>{const t=c.useContext(ve);if(!t)throw new Error("useModal debe ser usado dentro de un ModalProvider");return t},_e=()=>{const[t,s]=c.useState(window.innerWidth<768);return c.useEffect(()=>{const r=()=>{s(window.innerWidth<768)};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),{isMobile:t}},It=()=>{var l,x,f;const t=G(),{openModal:s}=Se(),{user:r,logout:n}=H(),{isMobile:o}=_e(),[a,i]=c.useState(!o),m=async()=>{await s("Cerrar sesi√≥n","¬øEst√°s seguro de que quieres cerrar sesi√≥n?")&&n()},d=()=>{o&&i(!1)};return e.jsxs("div",{className:"min-h-screen flex flex-col md:grid md:grid-cols-[250px_1fr] bg-base-200",children:[o&&e.jsxs("div",{className:"flex items-center justify-between bg-base-100 p-4",children:[e.jsx("button",{onClick:()=>i(!a),className:"btn btn-ghost",children:e.jsx(De,{className:"w-6 h-6"})}),e.jsx("div",{className:"text-lg font-bold",children:"Dashboard"})]}),(a||!o)&&e.jsxs("aside",{className:"bg-base-100 border-b md:border-b-0 md:border-r border-base-300 p-4 flex flex-col space-y-6 md:static absolute w-full md:w-auto z-50",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[(l=r==null?void 0:r.user_info)!=null&&l.avatarUrl?e.jsx("img",{src:r.user_info.avatarUrl,alt:"Avatar",className:"w-20 h-20 md:w-24 md:h-24 rounded-full object-cover mb-2"}):e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-full bg-base-300 flex items-center justify-center mb-2",children:e.jsx(Re,{className:"w-10 h-10 md:w-12 md:h-12 text-base-content/70"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-base md:text-lg",children:((x=r==null?void 0:r.user_info)==null?void 0:x.username)??""}),e.jsx("p",{className:"text-xs md:text-sm text-base-content/70",children:((f=r==null?void 0:r.user_info)==null?void 0:f.first_name)??""})]})]}),e.jsxs("nav",{className:"flex flex-col items-start gap-2",children:[e.jsxs(k,{to:"/dashboard",onClick:d,className:`btn btn-ghost justify-start w-full ${t.pathname==="/dashboard"?"btn-active":""}`,children:[e.jsx(Le,{className:"w-5 h-5 mr-2"})," Inicio"]}),e.jsxs(k,{to:"/dashboard/documentos/firmar",onClick:d,className:`btn btn-ghost justify-start w-full ${t.pathname==="/dashboard/documentos/firmar"?"btn-active":""}`,children:[e.jsx(Fe,{className:"w-5 h-5 mr-2"})," ",e.jsx("span",{className:"text-start",children:"Documentos por Firmar"})]}),e.jsxs(k,{to:"/dashboard/signature",onClick:d,className:`btn btn-ghost justify-start w-full ${t.pathname==="/dashboard/signature"?"btn-active":""}`,children:[e.jsx(Me,{className:"w-5 h-5 mr-2"})," Firma"]}),e.jsxs(k,{to:"/dashboard/perfil",onClick:d,className:`btn btn-ghost justify-start w-full ${t.pathname==="/dashboard/perfil"?"btn-active":""}`,children:[e.jsx(Oe,{className:"w-5 h-5 mr-2"})," Mi Perfil"]}),e.jsxs("button",{onClick:()=>{d(),m()},className:"btn btn-ghost text-error justify-start w-full",children:[e.jsx(Ae,{className:"w-5 h-5 mr-2"})," Cerrar Sesi√≥n"]})]})]}),e.jsx(Ue,{className:"flex-1 overflow-y-auto",children:e.jsx(Te,{})})]})},oe={updateProfile:async t=>await gt({baseUrl:M,path:"/v1/global/users/session",body:t}),getProfile:async()=>$({baseUrl:M,path:"/v1/global/users/session"})},Dt=V({first_name:y("Nombre requerido"),last_name_paterno:y("Apellido paterno requerido"),last_name_materno:y("Apellido materno requerido"),email:we("Correo requerido"),phone:ye("Debe ser un n√∫mero de celular v√°lido de 9 d√≠gitos"),gender:y("G√©nero requerido").oneOf(["f","m"],"Selecciona un g√©nero v√°lido"),current_password:K(),new_password:K(),confirm_password:K().oneOf([me("new_password")],"Las nuevas contrase√±as no coinciden")}),Rt=()=>{const t=U({mutationFn:oe.updateProfile,onSuccess:()=>{Y.success("Perfil actualizado exitosamente"),s.setValue("current_password",""),s.setValue("new_password",""),s.setValue("confirm_password","")},onError:()=>Y.error("Error al actualizar el perfil")}),s=J(Dt),{isLoading:r,isError:n,data:o,refetch:a}=ee({queryKey:["profile"],queryFn:oe.getProfile});c.useEffect(()=>{o!=null&&s.reset({email:o.email,first_name:o.first_name,gender:o.gender,last_name_materno:o.last_name_materno,last_name_paterno:o.last_name_paterno,phone:o.phone,current_password:"",new_password:"",confirm_password:""})},[o]);const i=m=>t.mutate(m);return r?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("span",{className:"loading loading-spinner loading-lg"})}):n?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen space-y-4",children:[e.jsx("p",{className:"text-lg font-semibold text-error",children:"No se pudo cargar tu perfil."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>a(),children:"Reintentar"})]}):e.jsxs("div",{className:"flex flex-col w-full h-full px-4 md:px-10 py-8 space-y-10",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Mi Perfil"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Actualiza tu informaci√≥n personal"})]}),e.jsxs("form",{onSubmit:s.handleSubmit(i),className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(C,{label:"Nombre",registration:s.register("first_name"),error:s.formState.errors.first_name}),e.jsx(C,{label:"Apellido paterno",registration:s.register("last_name_paterno"),error:s.formState.errors.last_name_paterno}),e.jsx(C,{label:"Apellido materno",registration:s.register("last_name_materno"),error:s.formState.errors.last_name_materno}),e.jsx(C,{label:"Correo electr√≥nico",registration:s.register("email"),error:s.formState.errors.email}),e.jsx(C,{label:"Tel√©fono",registration:s.register("phone"),error:s.formState.errors.phone}),e.jsx(Ne,{label:"G√©nero",registration:s.register("gender"),error:s.formState.errors.gender,options:[{label:"Femenino",value:"f"},{label:"Masculino",value:"m"}]}),e.jsxs("div",{className:"md:col-span-2 pt-8 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Cambio de contrase√±a"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completa los campos si deseas actualizar tu contrase√±a."})]}),e.jsx(O,{label:"Contrase√±a actual",registration:s.register("current_password"),error:s.formState.errors.current_password}),e.jsx(O,{label:"Nueva contrase√±a",registration:s.register("new_password"),error:s.formState.errors.new_password}),e.jsx(O,{label:"Confirmar nueva contrase√±a",registration:s.register("confirm_password"),error:s.formState.errors.confirm_password})]}),e.jsx("div",{className:"md:col-span-2 flex justify-end",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:s.formState.isSubmitting,children:s.formState.isSubmitting?"Guardando...":"Guardar cambios"})})]})]})},A={getDocumentoResumen:async(t,s,r)=>$({path:`/api/v1/public/documentos/${t}/${s}`,abortSignal:r}),getDocumentos:async t=>$({path:"/api/v1/public/documentos",abortSignal:t}),downloadPdf:async(t,s)=>await ge({path:`/api/v1/procesos/documentos/download/${t}`,progress:r=>s==null?void 0:s(r)}),signPDF:async t=>$({path:`/api/v1/public/sign/documento/${t}`}),logOpenLink:async t=>{await z({path:"/api/v1/public/_open_link/event",body:{record_codigo:t.codigo,empresa:t.empresa,method:t.metodo,referer:t.referencia}})}},Lt=function(){const t=document.createElement("a");return function(s,r){const n=window.URL.createObjectURL(r);t.href=n,t.download=s,t.click(),window.URL.revokeObjectURL(n)}}(),Ft=()=>{const t=G(),{openModal:s}=Se(),{isMobile:r}=_e();let n=qe();n??(n=window.innerHeight);const o=Z(),{pdfname:a,estado:i}=ue(),[m,d]=c.useState(i==="published"),[l,x]=c.useState(a),[f,h]=c.useState(!0),[b,w]=c.useState(null),[j,N]=c.useState(null),[F,R]=c.useState(null),[L,I]=c.useState(1),g=c.useRef(!1),v=U({mutationFn:A.signPDF,onSuccess:({signed_pdf_name:u})=>{P.success("Documento firmado correctamente."),d(!1),o(`/dashboard/pdf/${u}/signed`,{replace:!0}),x(u),g.current=!1},onError:u=>P.error(`Error al firmar el documento: ${u.message}`)}),S=async()=>{if(!l){alert("No se ha seleccionado ning√∫n documento para firmar.");return}await s("Confirmar Firma","¬øEst√°s seguro de que deseas firmar este documento?")&&v.mutate(l)};return c.useEffect(()=>{g.current||(g.current=!0,(async()=>{if(l==null){w("No PDF name provided"),h(!1);return}try{const u=await A.downloadPdf(l);N(new File([u],l,{type:"application/pdf"})),h(!1)}catch(u){w(u instanceof Error?u.message:"An unknown error occurred"),h(!1)}})())},[l]),f?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):b!=null?e.jsxs("div",{className:"flex items-center justify-center h-screen text-red-500",children:["Error: ",typeof b=="string"?b:b.message]}):j==null?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Unable to load PDF."}):e.jsxs("div",{className:E("w-full relative bg-base-100"),style:{height:r?n-72:n},children:[e.jsxs("div",{className:"absolute bg-black/20 w-full h-10 top-0 flex justify-between items-center px-4 z-10",children:[e.jsx($e,{className:"w-5 h-5 cursor-pointer select-none",onClick:()=>{var u;if(((u=t.state)==null?void 0:u.from)==="_link"){o("/dashboard",{replace:!0});return}o(-1)}}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>Lt(j.name,j),children:e.jsx(ze,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-2"}),e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>I(u=>Math.min(u+.1,3)),children:e.jsx(Be,{className:"w-5 h-5"})}),e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>I(u=>Math.max(u-.1,.5)),children:e.jsx(We,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-auto flex flex-col items-center gap-4 h-full pt-10",children:e.jsx(fe,{file:j,onLoadSuccess:({numPages:u})=>R(u),loading:"Loading PDF...",error:"Error while loading PDF",className:"flex flex-col items-center w-full",children:Array.from(new Array(F),(u,p)=>e.jsx(he,{pageNumber:p+1,width:r?window.innerWidth:800,scale:L,className:"shadow-md rounded-lg border border-base-300"},`page_${p+1}`))})}),m&&e.jsx("div",{className:"absolute bottom-0 h-20 w-full flex justify-center items-center gap-4 z-[9999]",children:e.jsx("button",{className:"btn btn-primary flex items-center gap-2",onClick:S,disabled:f,children:v.isPending?e.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Firmando..."})}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Firmar Documento"}),e.jsx(Ve,{})]})})})]})},ie=800;function Mt(){const[t,s]=c.useState("./sample.pdf"),[r,n]=c.useState(),[o]=c.useState(),a=m=>{var l;const d=(l=m.target.files)==null?void 0:l[0];d&&s(d)},i=({numPages:m})=>{n(m)};return e.jsxs("div",{children:[e.jsx("header",{children:e.jsx("h1",{children:"react-pdf sample"})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"file",children:"Load PDF:"}),e.jsx("input",{type:"file",onChange:a}),e.jsx("div",{style:{border:"2px solid #000",padding:"10px"},children:e.jsx(fe,{file:t,onLoadSuccess:i,children:Array.from({length:r??0},(m,d)=>e.jsx(he,{pageNumber:d+1,width:o?Math.min(o,ie):ie},d))})})]})]})}const Ot=({initialOffset:t=0,initialLimit:s=1,total:r,onUpdate:n})=>{const[o,a]=c.useState(t),[i,m]=c.useState(s),[d,l]=c.useState(!1),[x,f]=c.useState(""),h=c.useRef(null),b=o+1,w=Math.min(o+i,r),j=i>1?`${b}-${w}`:`${b}`;c.useEffect(()=>{const u=p=>{h.current&&!h.current.contains(p.target)&&I()};return d&&document.addEventListener("mousedown",u,{capture:!0}),()=>document.removeEventListener("mousedown",u)},[d]);const N=(u,p,T)=>Math.max(Math.min(u,T),p),F=u=>{const[p,T]=u.trim().split(/[-,;\s]+/);let q=parseInt(p,10),Q=T?parseInt(T,10):q;return q=N(q,1,r),Q=N(Q,1,r),{minimum:q-1,maximum:Q}},R=(u,p)=>{a(u),m(p),n({offset:u,limit:p}),l(!1)},L=u=>{let p=o+i*u;p>=r?p=0:p<0&&i===1?p=r-1:p<0&&i>1&&(p=r-(r%i||i)),R(p,i)},I=()=>{const{minimum:u,maximum:p}=F(x);!isNaN(u)&&!isNaN(p)&&u<p?R(u,p-u):l(!1)},g=u=>{f(u.target.value)},v=u=>{u.key==="Enter"?(u.preventDefault(),I()):u.key==="Escape"&&(u.preventDefault(),l(!1))},S=()=>{d||(f(j),l(!0),setTimeout(()=>{var u;return(u=h.current)==null?void 0:u.focus()},0))};return e.jsxs("nav",{className:"flex gap-2 h-full items-center my-2","aria-label":"Pager",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[d?e.jsx("input",{ref:h,type:"text",className:"text-sm h-5 p-0 m-0 text-end outline-none input-sm",value:x,onBlur:I,onChange:g,onKeyDown:v}):e.jsx("span",{className:"text-sm border-transparent cursor-pointer",onClick:S,children:j}),e.jsx("span",{className:"text-sm",children:"/"}),e.jsx("span",{className:"text-sm",children:r})]}),e.jsxs("span",{className:"btn-group flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm","aria-label":"Previous",onClick:()=>L(-1),children:e.jsx(Ge,{})}),e.jsx("button",{type:"button",className:"btn btn-sm","aria-label":"Next",onClick:()=>L(1),children:e.jsx(He,{})})]})]})},At=({table:t})=>e.jsx("thead",{className:"bg-gray-200 dark:bg-gray-800 border-b border-gray-300 dark:border-gray-700",children:t.getHeaderGroups().map(s=>e.jsx("tr",{children:s.headers.map(r=>{var n,o;return e.jsx("th",{className:E("px-4 py-3 font-semibold text-xs text-gray-600 dark:text-gray-200 uppercase tracking-wider",{"text-left":r.column.id!=="actions","text-center":r.column.id==="actions","text-right":["amount","price"].includes(r.column.id)}),children:r.isPlaceholder?null:typeof r.column.columnDef.header=="string"?r.column.columnDef.header:(o=(n=r.column.columnDef).header)==null?void 0:o.call(n,r.getContext())},r.id)})},s.id))}),Ut=({error:t,onRetry:s,columns:r})=>e.jsx("tr",{children:e.jsxs("td",{colSpan:r.length,className:"p-6 text-center text-red-500 dark:text-red-400",children:[e.jsx("div",{children:typeof t=="string"?t:t.message}),s&&e.jsx("button",{onClick:s,className:"mt-2 px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/80",children:"Intentar nuevamente"})]})}),Ce=c.createContext(null),Tt=()=>{const t=c.useContext(Ce);if(!t)throw new Error("useContextMenu must be used inside ContextMenuProvider");return t};function qt({table:t,onRowClick:s,onRowDoubleClick:r,contextMenuAcctions:n}){const o=c.useRef(null),{openContextMenu:a}=Tt(),[i,m]=c.useState(null),d=(l,x)=>f=>{if(n==null)return;let h=[];typeof n=="function"?h=n(l):h=n,h.length!==0&&(m(x),a(f,h,l))};return e.jsx(e.Fragment,{children:t.getRowModel().rows.map(l=>{const x=l.id;return e.jsx("tr",{onClick:()=>{m(x),s==null||s(l.original)},onDoubleClick:()=>r==null?void 0:r(l.original),className:E("hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition-all duration-200 relative",{"bg-primary/10 dark:bg-primary/20":l.getIsSelected(),"bg-primary/5 dark:bg-primary/10":i===x&&!l.getIsSelected(),"after:content-[''] after:absolute after:inset-y-0 after:left-0 after:w-1 after:bg-primary":i===x}),onContextMenu:f=>d(l.original,x)(f),onTouchStart:f=>{o.current=setTimeout(()=>{d(l.original,x)(f)},500)},onTouchEnd:()=>{o.current&&clearTimeout(o.current)},children:l.getVisibleCells().map(f=>e.jsx("td",{className:E("px-4 py-3 text-sm text-gray-700 dark:text-gray-300 border-b border-gray-200 dark:border-gray-700","select-none",{"text-left":f.column.id!=="actions","text-center":f.column.id==="actions","text-right":["amount","price"].includes(f.column.id)}),children:Je(f.column.columnDef.cell,f.getContext())},f.id))},x)})})}function $t({data:t,columns:s,loading:r=!1,error:n,rowSelectionEnabled:o=!1,onRowClick:a,onRowDoubleClick:i,getRowId:m,onRetry:d,contextMenuAcctions:l}){const[x,f]=c.useState({}),h=Qe({data:t,columns:s,state:{rowSelection:x},enableRowSelection:o,getRowId:m?b=>m(b):void 0,getCoreRowModel:Ke(),onRowSelectionChange:f});return e.jsx("div",{className:E("overflow-x-auto border border-gray-200 dark:border-gray-700 rounded-md shadow-lg"),children:e.jsxs("table",{className:"w-full table-auto text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(At,{table:h}),e.jsx("tbody",{children:r?e.jsx("tr",{children:e.jsx("td",{colSpan:s.length,className:"p-6 text-center text-gray-500 dark:text-gray-400",children:"Cargando..."})}):n?e.jsx(Ut,{error:n,onRetry:d,columns:s}):e.jsx(qt,{table:h,onRowClick:a,onRowDoubleClick:i,contextMenuAcctions:l})})]})})}const zt=({onSearch:t})=>{const[s,r]=c.useState(""),n=()=>{t&&t(s)},o=a=>{a.key==="Enter"&&n()};return e.jsxs("div",{className:"mb-4 flex justify-center",children:[e.jsxs("div",{className:"relative w-full max-w-xs",children:[e.jsx("input",{type:"text",className:E("w-full","input-sm","pl-10","pr-4","py-2","rounded-md","border","border-gray-300","bg-transparent","text-gray-800","dark:text-gray-200","dark:border-gray-700","dark:focus:ring-0","focus:outline-none","focus:ring-2","focus:ring-gray-400","focus:border-gray-400","dark:focus:ring-gray-500","dark:focus:border-gray-500"),placeholder:"Search...",value:s,onChange:a=>r(a.target.value),onKeyDown:o}),e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 18l6-6-6-6"})})})]}),e.jsx("button",{type:"button",onClick:n,className:E("ml-2","px-2","py-2","btn","btn-sm","h-[36px]","filter-reset","border","border-gray-300","bg-transparent","text-gray-800","dark:text-gray-200","dark:border-gray-700","dark:focus:ring-0","focus:outline-none","focus:ring-2","focus:ring-gray-400","focus:border-gray-400","dark:focus:ring-gray-500","dark:focus:border-gray-500"),children:e.jsx(Xe,{})})]})},Bt=t=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.title&&e.jsx("h2",{className:"text-2xl font-semibold",children:t.title}),t.onSearch&&e.jsx(zt,{onSearch:t.onSearch})]})}),e.jsx($t,{...t}),t.pageProps&&e.jsx("div",{className:"flex justify-end",children:e.jsx(Ot,{initialLimit:t.pageProps.initialLimit,initialOffset:t.pageProps.initialOffset,total:t.pageProps.total,onUpdate:t.pageProps.onUpdate})})]}),Wt=t=>{const s=Ye();return t(s)},Vt=t=>{const s=c.useMemo(()=>["LISTA/DOCUMENTOS",t],[t]),r=xe(),{data:n,error:o,isFetching:a,isError:i}=ee({queryKey:s,queryFn:({signal:d})=>A.getDocumentos(d),refetchOnMount:"always"});return{documentos:n??[],refresh:()=>r.invalidateQueries({queryKey:s}),isFetching:a,error:o,isError:i}},le=t=>(t??"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();function Gt(t,s){const r=le(String(s??"").trim());return r.length<2?t:t.filter(n=>Object.entries(n).some(([o,a])=>{if(a==null)return!1;let i=le(String(a));return typeof a=="number"&&(i=`#${i}`),o.endsWith("codigo")&&!i.startsWith("#")&&(i=`.${i}`),i.includes(r)}))}const Ht=t=>{const[s,r]=c.useState("");return[c.useMemo(()=>!t||!s.trim()?t??[]:s.split(";").map(a=>a.trim()).filter(Boolean).reduce((a,i)=>Gt(a,i),t),[t,s]),r]},Jt={"01":"Enero","02":"Febrero","03":"Marzo","04":"Abril","05":"Mayo","06":"Junio","07":"Julio","08":"Agosto","09":"Septiembre",10:"Octubre",11:"Noviembre",12:"Diciembre"},Qt=Wt(t=>[t.accessor("empresa_descripcion",{header:"Empresa",cell:({getValue:s})=>s()}),t.accessor("descripcion_proceso",{header:"Descripci√≥n del Proceso",cell:({getValue:s})=>s()}),t.accessor("anio",{header:"A√±o",cell:({getValue:s})=>s()}),t.accessor("mes",{header:"Mes",cell:({getValue:s})=>{const r=s();return r==null||typeof r!="string"?r:Jt[r]}}),t.accessor("item",{header:"Semana",cell:({getValue:s})=>s()}),t.accessor("estado",{header:"Estado",cell:({getValue:s})=>{const r=s();let n,o,a;switch(r){case"published":n=e.jsx(tt,{className:"w-5 h-5"}),o="bg-green-500 text-white",a="Pendiente";break;case"signed":n=e.jsx(et,{className:"w-5 h-5"}),o="bg-blue-500 text-white",a="Firmado";break;case"canceled":n=e.jsx(Ze,{className:"w-5 h-5"}),o="bg-red-500 text-white",a="Cancelado";break;default:n=null,o="bg-gray-500 text-white",a="-"}return e.jsxs("div",{className:`max-w-[150px] grid items-center grid-cols-[1fr_3fr] p-2 rounded-lg ${o} dark:bg-opacity-20`,children:[e.jsx("p",{children:n}),e.jsx("p",{children:a})]})}})]),ce=({tosign:t})=>{const s=Z(),{documentos:r,isFetching:n,error:o,refresh:a}=Vt(t?"01":"02"),i=c.useMemo(()=>t?r.filter(l=>l.estado=="published"):r,[t,r]),[m,d]=Ht(i);return e.jsx("div",{className:"p-4 md:p-8",children:e.jsx(Bt,{title:"Lista de documentos",loading:n,error:o,onRetry:a,columns:Qt,data:m,onSearch:d,contextMenuAcctions:l=>[{label:"Ver Documeto",onClick:()=>{if(l.signed_pdf_name){s(`/dashboard/pdf/${l.signed_pdf_name}/${l.estado}`);return}if(l.nombre_pdf){s(`/dashboard/pdf/${l.nombre_pdf}/${l.estado}`);return}}}],onRowDoubleClick:l=>{if(l.signed_pdf_name){s(`/dashboard/pdf/${l.signed_pdf_name}/${l.estado}`);return}if(l.nombre_pdf){s(`/dashboard/pdf/${l.nombre_pdf}/${l.estado}`);return}}})})},Kt=()=>{const{empresa:t,origin:s,record_codigo:r}=ue();return t==null||s==null||r==null?e.jsx(D,{to:"/dashboard",replace:!0}):e.jsx(Xt,{empresa:t,origin:s,record_codigo:r})},Xt=({empresa:t,origin:s,record_codigo:r})=>{const n=c.useRef(!1);c.useEffect(()=>{if(n.current)return;(async()=>{try{await A.logOpenLink({codigo:r,empresa:t,metodo:s,referencia:window.location.href})}catch(f){console.error("Failed to log open link:",f)}finally{n.current=!0}})()},[t,s,r]);const o=c.useMemo(()=>["RESUMEN_INFO_DOC_RECORD",t,s,r],[t,s,r]),a=xe(),{data:i,error:m,isLoading:d}=ee({queryKey:o,queryFn:({signal:x})=>A.getDocumentoResumen(t,r,x)}),l=()=>a.invalidateQueries({queryKey:o});return d?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):m!=null?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen text-red-500",children:[e.jsxs("p",{children:["Error: ",typeof m=="string"?m:m.message]}),e.jsx("button",{onClick:l,className:"mt-4 px-6 py-2 bg-red-600 text-white rounded-lg shadow-md hover:bg-red-700 transition",children:"Retry"})]}):i==null||i.length===0?e.jsx(D,{to:"/dashboard",replace:!0}):i[0].signed_pdf_name?e.jsx(D,{to:`/dashboard/pdf/${i[0].signed_pdf_name}/${i[0].estado}`,replace:!0,state:{from:"_link"}}):i[0].nombre_pdf?e.jsx(D,{to:`/dashboard/pdf/${i[0].nombre_pdf}/${i[0].estado}`,replace:!0,state:{from:"_link"}}):e.jsx("div",{className:"flex flex-col items-center justify-center h-screen text-red-500",children:e.jsx("button",{onClick:l,className:"mt-4 px-6 py-2 bg-red-600 text-white rounded-lg shadow-md hover:bg-red-700 transition",children:"Retry"})})},Ee={getFirmaImange:async t=>ge({abortSignal:t,path:"/api/v1/public/firma/jpg",progress:()=>{}}),uploadFirmaImange:async t=>{const s=new FormData;return s.append("image",t),bt({path:"/api/v1/public/firma/jpg",body:s})}},Yt=t=>new Promise((s,r)=>{const n=new Image;n.addEventListener("load",()=>s(n)),n.addEventListener("error",o=>r(o)),n.setAttribute("crossOrigin","anonymous"),n.src=t});function ke(t){return t*Math.PI/180}function Zt(t,s,r){const n=ke(r);return{width:Math.abs(Math.cos(n)*t)+Math.abs(Math.sin(n)*s),height:Math.abs(Math.sin(n)*t)+Math.abs(Math.cos(n)*s)}}const es={flip:{horizontal:!1,vertical:!1},output:{width:860,height:860/2}};async function ts(t,s,r=0,n=es){var h,b;const o=await Yt(t),a=document.createElement("canvas"),i=a.getContext("2d");if(!i)return null;const m=ke(r),{width:d,height:l}=Zt(o.width,o.height,r);a.width=d,a.height=l,i.fillStyle="#fff",i.fillRect(0,0,a.width,a.height),i.translate(d/2,l/2),i.rotate(m),i.scale((h=n==null?void 0:n.flip)!=null&&h.horizontal?-1:1,(b=n==null?void 0:n.flip)!=null&&b.vertical?-1:1),i.translate(-o.width/2,-o.height/2),i.drawImage(o,0,0);const x=document.createElement("canvas"),f=x.getContext("2d");return f?(x.width=n.output.width,x.height=n.output.height,f.fillStyle="#fff",f.fillRect(0,0,x.width,x.height),f.drawImage(a,s.x,s.y,s.width,s.height,0,0,n.output.width,n.output.height),new Promise(w=>x.toBlob(j=>w(j),"image/jpeg",.95))):null}const ss="/assets/no_image_placeholder-B4dLisTe.jpg",rs=({image:t})=>{const s=c.useRef(null),[r,n]=c.useState(!1),[o,a]=c.useState("view"),[i,m]=c.useState(t),[d,l]=c.useState(null),[x,f]=c.useState({x:0,y:0}),[h,b]=c.useState(1),[w,j]=c.useState(0),[N,F]=c.useState(null),R=c.useCallback((g,v)=>{F(v)},[]),L=g=>{var u;const v=(u=g.target.files)==null?void 0:u[0];if(!v)return;const S=new FileReader;S.onload=()=>{l(S.result),a("crop")},S.readAsDataURL(v)},I=async()=>{if(!d||!N)return;const g=await ts(d,N,w,{output:{width:860,height:860/2}});if(g==null){P.error("no se pudo procesar la imange");return}const v=P.loading("Guardando firma...");try{n(!0),await Ee.uploadFirmaImange(g),m(URL.createObjectURL(g)),a("view"),P.success("Firma guardada correctamente",{id:v})}catch(S){const u=typeof S=="string"?S:S instanceof Error?S.message:"Error al guardar la firma";P.error(u,{id:v})}finally{n(!1)}};return e.jsxs("div",{className:"w-full h-full px-5 py-8 flex flex-col items-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Firma"}),e.jsx("p",{className:"text-sm text-muted-foreground text-center max-w-[860px] mb-4",children:"Esta imagen ser√° utilizada como firma visual en los documentos que firmes digitalmente desde el sistema."}),o==="view"&&e.jsxs("div",{className:"w-full max-w-[860px] space-y-4",children:[e.jsxs("div",{className:"relative aspect-[2/1] rounded-lg shadow-2xl bg-white overflow-hidden",children:[e.jsx("img",{src:i||ss,alt:"Firma",className:"w-full h-full object-contain bg-white"}),e.jsx("label",{htmlFor:"fileInput",className:E("absolute inset-0","flex items-center justify-center","transition duration-200","cursor-pointer")}),e.jsx("input",{ref:s,type:"file",id:"fileInput",accept:"image/png,image/jpeg",onChange:L,className:"hidden"})]}),e.jsx("div",{className:"pt-8 flex justify-center",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{var g;return(g=s.current)==null?void 0:g.click()},children:"Subir Firma"})})]}),o==="crop"&&d&&e.jsxs("div",{className:"w-full max-w-[860px] space-y-4",children:[e.jsx("div",{className:"relative aspect-[2/1] rounded-lg shadow-2xl bg-white overflow-hidden",children:e.jsx(st,{image:d,crop:x,zoom:h,rotation:w,aspect:2/1,onCropChange:f,onZoomChange:b,onCropComplete:R,restrictPosition:!1,cropShape:"rect",showGrid:!1,style:{containerStyle:{backgroundImage:"linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(-45deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(-45deg, transparent 75%, #ccc 75%)",backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px"},mediaStyle:{backgroundColor:"transparent"}}})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"grid xl:grid-cols-2 items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-sm font-medium mb-2",children:["Zoom: ",h.toFixed(1),"x"]}),e.jsx("input",{type:"range",min:1,max:3,step:.1,value:h,onChange:g=>b(parseFloat(g.target.value)),className:"w-full range range-sm range-primary"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("button",{className:"btn btn-outline",onClick:()=>j(g=>g-90),children:[e.jsx(rt,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:" Rotar Izquierda"})]}),e.jsxs("button",{className:"btn btn-outline",onClick:()=>j(g=>g+90),children:[e.jsx(nt,{className:"w-4 h-4 mr-2"}),e.jsx("span",{children:" Rotar Derecha"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[e.jsx("button",{className:"btn btn-ghost",onClick:()=>a("view"),children:"Cancelar"}),e.jsx("button",{className:"btn btn-primary disabled:opacity-50",onClick:I,disabled:r,children:r?"Guardando...":"Guardar"})]})]})]})]})},ns=()=>{const[t,s]=c.useState(null),r=c.useRef(null),[n,o]=c.useState(!0),[a,i]=c.useState(null),m=async l=>{o(!0),i(null);try{const x=await Ee.getFirmaImange(l);x!=null&&s(URL.createObjectURL(x)),o(!1)}catch(x){console.log(x),x instanceof DOMException&&x.name==="AbortError"||x instanceof Error&&x.message!=="no hay ninguna imagen"&&i(x),o(!1)}},d=c.useCallback(()=>{const l=new AbortController;r.current=l,m(l.signal)},[]);return c.useEffect(()=>(d(),()=>{var l;(l=r.current)==null||l.abort()}),[d]),n?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):a!=null?e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen text-red-500",children:[e.jsxs("p",{children:["Error: ",typeof a=="string"?a:a.message]}),e.jsx("button",{onClick:d,className:"mt-4 px-6 py-2 bg-red-600 text-white rounded-lg shadow-md hover:bg-red-700 transition",children:"Retry"})]}):e.jsx(rs,{image:t})},de=({children:t})=>{const s=G(),{user:r}=H(),n=!!r;let o;return s.pathname.startsWith("/_sign/")&&(o={from:s.pathname}),n?t:e.jsx(D,{to:"/login",replace:!0,state:o})},X=({children:t})=>{var o;const{user:s}=H(),r=!!s,n=G();return r?(o=n.state)!=null&&o.from?e.jsx(D,{to:n.state.from,replace:!0}):e.jsx(D,{to:"/dashboard",replace:!0}):t},as=()=>e.jsx(at,{children:e.jsxs(ot,{children:[e.jsx(_,{path:"/login",element:e.jsx(X,{children:e.jsx(_t,{})})}),e.jsx(_,{path:"/register",element:e.jsx(X,{children:e.jsx(Et,{})})}),e.jsx(_,{path:"/recover",element:e.jsx(X,{children:e.jsx(Pt,{})})}),e.jsx(_,{path:"/_sign/:empresa/:record_codigo/:origin",element:e.jsx(de,{children:e.jsx(Kt,{})})}),e.jsxs(_,{path:"/dashboard",element:e.jsx(de,{children:e.jsx(It,{})}),children:[e.jsx(_,{index:!0,element:e.jsx(ce,{})}),e.jsx(_,{path:"pdf/:pdfname/:estado",element:e.jsx(Ft,{})}),e.jsx(_,{path:"documentos/firmar",element:e.jsx(ce,{tosign:!0})}),e.jsx(_,{path:"perfil",element:e.jsx(Rt,{})}),e.jsx(_,{path:"signature",element:e.jsx(ns,{})}),e.jsx(_,{path:"sample",element:e.jsx(Mt,{})})]}),e.jsx(_,{path:"*",element:e.jsx(D,{to:"/login",replace:!0})})]})}),os=({children:t})=>{const[s,r]=c.useState(()=>{try{const a=localStorage.getItem("session");if(a==null)return null;const i=localStorage.getItem("last_token_used");if(i!=null){const m=new Date(i),d=new Date;if(!isNaN(m.getTime())&&d.getTime()-m.getTime()>18e6)return localStorage.removeItem("session"),null}return a?JSON.parse(a):null}catch(a){return console.error("Error retrieving session data from localStorage",a),null}}),n=a=>{r(a);const i=new Date;localStorage.setItem("last_token_used",i.toISOString()),localStorage.setItem("session",JSON.stringify(a))},o=()=>{r(null),localStorage.removeItem("session")};return e.jsx(pe.Provider,{value:{user:s,login:n,logout:o},children:t})},is=({children:t})=>{const[s,r]=c.useState(!1),[n,o]=c.useState(()=>{}),[a,i]=c.useState("Confirmaci√≥n"),[m,d]=c.useState("¬øEst√°s seguro de esta acci√≥n?"),l=(w,j)=>(r(!0),i(w),d(j),new Promise(N=>o(()=>N))),x=()=>{r(!1)},f=()=>{n(!0),x()},h=()=>{n(!1),x()},b=()=>s?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{className:"bg-base-100 p-6 rounded-lg shadow-lg w-full max-w-sm",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:a}),e.jsx("p",{className:"text-base-content/80 mb-6",children:m}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{className:"btn btn-ghost",onClick:h,children:"Cancelar"}),e.jsx("button",{className:"btn btn-primary",onClick:f,children:"Confirmar"})]})]})}):null;return e.jsx(ve.Provider,{value:{openModal:l},children:e.jsxs(e.Fragment,{children:[e.jsx(b,{}),t]})})},ls=({children:t})=>{const[s,r]=c.useState({isOpen:!1,x:0,y:0,items:[]}),n=c.useCallback((a,i,m)=>{a.preventDefault();let d=0,l=0;"touches"in a&&a.touches.length>0?(d=a.touches[0].clientX,l=a.touches[0].clientY):"clientX"in a&&(d=a.clientX,l=a.clientY);const x=10,f=180,h=200,b=window.innerWidth,w=window.innerHeight;let j=d,N=l;d+f+x>b&&(j=b-f-x),l+h+x>w&&(N=w-h-x),r({isOpen:!0,x:j,y:N,items:i,data:m})},[]),o=c.useCallback(()=>{r(a=>({...a,isOpen:!1}))},[]);return c.useEffect(()=>{const a=()=>{o()};return window.addEventListener("click",a),window.addEventListener("scroll",a),()=>{window.removeEventListener("click",a),window.removeEventListener("scroll",a)}},[o]),e.jsxs(Ce.Provider,{value:{openContextMenu:n,closeContextMenu:o,state:s},children:[t,s.isOpen&&e.jsx("div",{className:"absolute  min-w-[180px] rounded-md shadow-md border border-base-300 bg-base-100 text-base-content z-50 overflow-hidden",style:{top:s.y,left:s.x},onClick:a=>a.stopPropagation(),children:s.items.map((a,i)=>{const m=a.icon,d=a.disabled;return e.jsxs("button",{onClick:()=>{d||a.onClick(s.data),o()},className:`flex items-center gap-2 w-full text-left px-4 py-2 text-sm ${d?"cursor-not-allowed text-base-content/50 hover:bg-transparent":"hover:bg-base-200"}`,disabled:d,children:[m&&e.jsx(m,{className:`w-4 h-4 ${d?"opacity-50":""}`}),e.jsx("span",{className:"select-none",children:a.label})]},i)})})]})},cs=()=>{const t=c.useRef(null),[s,r]=c.useState(!1);c.useEffect(()=>{const a=i=>{i.preventDefault(),localStorage.getItem("pwa-is-installed")!=="true"&&(t.current=i,r(!0))};return window.addEventListener("beforeinstallprompt",a),()=>window.removeEventListener("beforeinstallprompt",a)},[]);const n=async()=>{if(!t.current)return;t.current.prompt();const a=await t.current.userChoice;r(!1),a.outcome==="accepted"&&localStorage.setItem("pwa-is-installed","true")},o=()=>{r(!1)};return s?e.jsx("div",{className:"fixed top-4 right-4 z-50 w-full max-w-xs",children:e.jsxs("div",{className:"bg-base-100 border border-base-300 shadow-xl rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h2",{className:"font-semibold text-base-content text-sm",children:"Instala esta aplicaci√≥n"}),e.jsx("button",{onClick:o,className:"btn btn-xs btn-circle btn-ghost",children:"‚úï"})]}),e.jsx("p",{className:"text-sm text-base-content/80 mb-4",children:"Para un acceso m√°s r√°pido y una mejor experiencia, puedes instalar esta app en tu dispositivo."}),e.jsx("button",{onClick:n,className:"btn btn-primary btn-sm w-full",children:"Instalar"})]})}):null};ut.workerSrc=new URL("/assets/pdf.worker.min-GB3t0DcA.mjs",import.meta.url).toString();const ds=new it({defaultOptions:{queries:{refetchOnWindowFocus:!1}}});lt.createRoot(document.getElementById("root")).render(e.jsx(c.StrictMode,{children:e.jsxs(ls,{children:[e.jsx(ct,{reverseOrder:!1}),e.jsx(is,{children:e.jsxs(dt,{client:ds,children:[e.jsxs(os,{children:[e.jsx(cs,{}),e.jsx(as,{})]}),e.jsx(mt,{initialIsOpen:!1})]})})]})}));
