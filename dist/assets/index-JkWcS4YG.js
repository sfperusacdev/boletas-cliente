import{r as d,u as we,o as ve,e as T,f as q,g as M,j as e,L as C,h as W,k as re,l as Q,n as S,V as L,p as Se,M as _e,U as Ce,H as Ee,S as ke,q as Pe,s as De,D as Ie,O as Le,t as ne,v as Me,x as Fe,C as Re,Z as Ae,y as Oe,P as Te,z as qe,A as Ue,B as $e,E as ze,F as Ve,G as He,I as Be,J as We,K as Ge,N as Je,Q as Qe,R as Ke,T as Xe,W as N,X as K,Y as Ye,_ as Ze,$ as es,a0 as ss,a1 as ts}from"./react-BoAbkJwy.js";import{D as ae,P as oe,_ as rs}from"./pdf-glyDyhBu.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(a){if(a.ep)return;a.ep=!0;const n=r(a);fetch(a.href,n)}})();const ie=d.createContext(void 0),U=()=>{const s=d.useContext(ie);if(!s)throw new Error("useSession debe ser usado dentro de un SessionProvider");return s};function $(s,t){const r=we({resolver:ve(s),defaultValues:t==null?void 0:t.defaultValues});return{...r,handleSubmit:(a,n)=>r.handleSubmit(a,i=>{n&&n(i)})}}class le extends Error{constructor(t){super(t),this.name="ApiError"}}class ns extends Error{constructor(){super("No hay conexión a internet 😵"),this.name="InternetError"}}class as extends Error{constructor(){super("No hay conexión con el servicio 😵"),this.name="InternetError"}}class os extends Error{constructor(){super("Error en la comunicacion con el servicio 😢"),this.name="SyntaxJsonError"}}const is=()=>{const s=localStorage.getItem("session");if(!s)return null;const{token:t}=JSON.parse(s),r=new Date;return localStorage.setItem("last_token_used",r.toISOString()),t},ce=async(s,t)=>{try{const r=is();return await fetch(s,{...t,headers:{...t==null?void 0:t.headers,...r&&{Authorization:r}}})}catch(r){throw r instanceof TypeError?new as:r}},de=(...s)=>{const t=new RegExp("^/+"),r=new RegExp("/+$");return s.map(o=>o.replace(t,"").replace(r,"")).filter(Boolean).join("/")},D="http://192.16.0.15:7771/",me="http://192.16.0.10:8765/",X=async({baseUrl:s,path:t,method:r,body:o,abortSignal:a,fullResponse:n=!1})=>{const i=await ce(de(s??me,t),{method:r,headers:{"Content-Type":"application/json"},...o?{body:JSON.stringify(o)}:{},signal:a}),m=await i.json();if(!i.ok){const c=typeof(m==null?void 0:m.message)=="string"?m.message:"Unexpected error";throw new le(c)}return n?m:m.data},ls=async s=>{try{const t=await ce(de(s.baseUrl??me,s.path),{method:s.method??"GET",headers:{"Content-Type":"application/json"},...s.body?{body:JSON.stringify(s.body)}:{},signal:s.abortSignal}),r=t.body;if(!r)throw new le("Archivo no encontrado");const o=r.getReader(),a=parseInt(t.headers.get("Content-Length")??"");let n=0;const i=[];for(;;){const{done:m,value:c}=await o.read();if(m)break;i.push(c),n+=c.length,s.progress(Math.round(n/a*100))}return new Blob(i)}catch(t){throw t instanceof SyntaxError?new os:t instanceof TypeError?new ns:t}},G=s=>X({...s,method:"GET"}),V=s=>X({...s,method:"POST"}),cs=s=>X({...s,method:"PUT"}),Y={login:async s=>await V({baseUrl:D,path:"/v1/global/login",body:s}),register:async s=>await V({baseUrl:D,path:"/v1/global/users",body:{username:s.dni,first_name:s.first_name,last_name_paterno:s.last_name_paterno,last_name_materno:s.last_name_materno,email:s.email,phone:s.phone,gender:s.gender,password:s.new_password,origin_request:window.location.origin}}),recoverAccount:async s=>await V({baseUrl:D,path:"/v1/global/users/post/recovery/email",body:{dni:s,origin_request:window.location.origin}})},ue="Este campo es requerido",ds="Introduce una dirección de correo electrónico válida",ms="El correo electrónico es obligatorio",us="Introduce un número de celular válido",xe=s=>{if(s==null)return null;if(typeof s!="string")return s;const t=s.trim();return t===""?null:t},b=(s=ue)=>T().transform(xe).required(s),H=()=>T().transform(xe).nullable().default(null),fe=(s=ms)=>T().email(ds).required(s),xs=/^(?:\+51)\s?[0-9]{3}\s?[0-9]{3}\s?[0-9]{3}$/,fs=s=>{if(s==null)return null;if(typeof s!="string")return s;const t=s.trim().replace(/\s+/g,"");return t===""?null:t.startsWith("+")?t:`+51 ${t}`},he=(s=us)=>T().transform(fs).test("valid-phone",s,t=>t==null||t===""?!0:xs.test(t)).required(ue),hs=q({username:b("DNI requerido").min(7,"El DNI debe tener al menos 7 caracteres").max(10,"El DNI no debe superar los 10 caracteres"),password:b("Contraseña requerida").min(6,"La contraseña debe tener al menos 6 caracteres")}),ps=()=>{const{login:s}=U(),t=M({mutationFn:Y.login,onSuccess:a=>s(a),onError:()=>W.error("Error al iniciar sesión")}),r=$(hs,{defaultValues:{username:"",password:""}}),o=r.handleSubmit(({password:a,username:n})=>{t.mutate({password:a??"",username:n??""})});return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-sm bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Iniciar sesión"}),e.jsx("p",{className:"text-base-content/70 text-sm mt-1",children:"Ingresa tus credenciales para continuar"})]}),e.jsxs("form",{onSubmit:o,className:"space-y-5",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"DNI"})}),e.jsx("input",{type:"text",placeholder:"Ingresa tu DNI",className:"input input-bordered w-full",...r.register("username")}),r.formState.errors.username&&e.jsx("p",{className:"text-error text-xs mt-1",children:r.formState.errors.username.message})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text font-medium",children:"Contraseña"})}),e.jsx("input",{type:"password",placeholder:"Ingresa tu contraseña",className:"input input-bordered w-full",...r.register("password")}),r.formState.errors.password&&e.jsx("p",{className:"text-error text-xs mt-1",children:r.formState.errors.password.message})]}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-block",disabled:r.formState.isSubmitting,children:r.formState.isSubmitting?"Entrando...":"Entrar"})]}),e.jsxs("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300 space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{children:"¿Aún no tienes cuenta? "}),e.jsx(C,{to:"/register",className:"link link-primary font-semibold",children:"Regístrate"})]}),e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{children:"¿Olvidaste tu contraseña? "}),e.jsx(C,{to:"/recover",className:"link link-primary font-semibold",children:"Recuperar cuenta"})]})]})]})})},j=({label:s,error:t,registration:r,placeholder:o,...a})=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{className:"font-medium",children:s}),e.jsx("input",{...r,...a,className:"input input-bordered w-full",placeholder:o}),t&&e.jsx("p",{className:"text-xs text-error mt-1",children:t.message})]}),pe=({label:s,options:t,error:r,registration:o,...a})=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{className:"font-medium",children:s}),e.jsxs("select",{...o,...a,className:"select select-bordered w-full",children:[e.jsx("option",{value:"",children:"Selecciona una opción"}),t.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))]}),r&&e.jsx("p",{className:"text-xs text-error mt-1",children:r.message})]}),I=({label:s,error:t,registration:r,...o})=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("label",{className:"font-medium",children:s}),e.jsx("input",{type:"password",...r,...o,className:"input input-bordered w-full"}),t&&e.jsx("p",{className:"text-xs text-error mt-1",children:t.message})]}),gs=q({dni:b().min(7,"El DNI debe tener al menos 7 caracteres").max(10,"El DNI no debe superar los 10 caracteres"),first_name:b("Nombre requerido"),last_name_paterno:b("Apellido paterno requerido"),last_name_materno:b("Apellido materno requerido"),email:fe("Correo requerido"),phone:he("Debe ser un número de celular válido de 9 dígitos"),gender:b("Género requerido").oneOf(["f","m"],"Selecciona un género válido"),new_password:b().min(8,"La contraseña debe tener al menos 8 caracteres"),confirm_password:b().oneOf([re("new_password")],"Las nuevas contraseñas no coinciden")}),bs=()=>{const s=Q(),[t,r]=d.useState(1),o=$(gs),a=M({mutationFn:Y.register,onSuccess:()=>{L.success("Usuario registrado con éxito"),s("/login",{replace:!0})},onError:()=>L.error("Error al registrar el usuario")}),n=async()=>{await o.trigger(["first_name","last_name_materno","last_name_paterno","gender"])&&r(2)},i=o.handleSubmit(m=>a.mutate(m));return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-md bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Crear cuenta"}),e.jsx("p",{className:"text-base-content/70 text-sm mt-1",children:"Completa el formulario para registrarte"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("ul",{className:"steps flex",children:[e.jsx("li",{className:S("step",{"step-primary":t>0}),onClick:()=>r(1)}),e.jsx("li",{className:S("step",{"step-primary":t>1})})]})}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[t===1&&e.jsxs(e.Fragment,{children:[e.jsx(j,{label:"Nombre",registration:o.register("first_name"),error:o.formState.errors.first_name}),e.jsx(j,{label:"Apellido paterno",registration:o.register("last_name_paterno"),error:o.formState.errors.last_name_paterno}),e.jsx(j,{label:"Apellido materno",registration:o.register("last_name_materno"),error:o.formState.errors.last_name_materno}),e.jsx(pe,{label:"Género",registration:o.register("gender"),error:o.formState.errors.gender,options:[{label:"Femenino",value:"f"},{label:"Masculino",value:"m"}]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{type:"button",onClick:n,className:"btn btn-primary",children:"Siguiente"})})]}),t===2&&e.jsxs(e.Fragment,{children:[e.jsx(j,{label:"DNI",registration:o.register("dni"),error:o.formState.errors.dni}),e.jsx(j,{label:"Correo electrónico",registration:o.register("email"),error:o.formState.errors.email}),e.jsx(j,{label:"Teléfono",registration:o.register("phone"),error:o.formState.errors.phone}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(I,{label:"Contraseña",registration:o.register("new_password"),error:o.formState.errors.new_password}),e.jsx(I,{label:"Confirmar contraseña",registration:o.register("confirm_password"),error:o.formState.errors.confirm_password})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Crear cuenta"})})]})]}),e.jsxs("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300",children:[e.jsx("span",{children:"¿Ya tienes cuenta? "}),e.jsx(C,{to:"/login",replace:!0,className:"link link-primary font-semibold",children:"Inicia sesión"})]})]})})},js=q({dni:b().min(7,"El DNI debe tener al menos 7 caracteres").max(10,"El DNI no debe superar los 10 caracteres")}),ys=()=>{var o;const s=$(js),t=M({mutationFn:Y.recoverAccount,onError:()=>L.error("Hubo un problema al enviar el correo con las instrucciones. Intenta nuevamente"),onSuccess:()=>s.reset()}),r=s.handleSubmit(a=>t.mutate(a.dni));return t.isSuccess?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-sm bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Recuperar cuenta"}),e.jsxs("p",{className:"text-base-content/70 text-sm mt-1",children:["Se envió un correo con las instrucciones a ",e.jsx("span",{className:"font-bold",children:(o=t.data)==null?void 0:o.email})]})]}),e.jsx("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300",children:e.jsx(C,{to:"/login",replace:!0,className:"link link-primary font-semibold",children:"Iniciar sesión"})})]})}):e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-200 px-4",children:e.jsxs("div",{className:"w-full max-w-sm bg-base-100 border border-base-300 shadow-xl rounded-xl p-8 space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Recuperar cuenta"}),e.jsx("p",{className:"text-base-content/70 text-sm mt-1",children:"Ingresa tu DNI para recuperar tu cuenta"})]}),e.jsxs("form",{onSubmit:r,className:"space-y-5",children:[e.jsx(j,{label:"DNI",registration:s.register("dni"),error:s.formState.errors.dni}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-block",disabled:t.isPending,children:t.isPending?"Enviando...":"Enviar instrucciones"})]}),e.jsxs("div",{className:"text-center text-sm text-base-content/70 pt-2 border-t border-base-300",children:[e.jsx("span",{children:"¿Ya recordaste tu contraseña? "}),e.jsx(C,{to:"/login",replace:!0,className:"link link-primary font-semibold",children:"Iniciar sesión"})]})]})})},ge=d.createContext(void 0),be=()=>{const s=d.useContext(ge);if(!s)throw new Error("useModal debe ser usado dentro de un ModalProvider");return s},je=()=>{const[s,t]=d.useState(window.innerWidth<768);return d.useEffect(()=>{const r=()=>{t(window.innerWidth<768)};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),{isMobile:s}},Ns=()=>{var l,u,x;const s=Se(),{openModal:t}=be(),{user:r,logout:o}=U(),{isMobile:a}=je(),[n,i]=d.useState(!a),m=async()=>{await t("Cerrar sesión","¿Estás seguro de que quieres cerrar sesión?")&&o()},c=()=>{a&&i(!1)};return e.jsxs("div",{className:"min-h-screen flex flex-col md:grid md:grid-cols-[250px_1fr] bg-base-200",children:[a&&e.jsxs("div",{className:"flex items-center justify-between bg-base-100 p-4",children:[e.jsx("button",{onClick:()=>i(!n),className:"btn btn-ghost",children:e.jsx(_e,{className:"w-6 h-6"})}),e.jsx("div",{className:"text-lg font-bold",children:"Dashboard"})]}),(n||!a)&&e.jsxs("aside",{className:"bg-base-100 border-b md:border-b-0 md:border-r border-base-300 p-4 flex flex-col space-y-6 md:static absolute w-full md:w-auto z-50",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[(l=r==null?void 0:r.user_info)!=null&&l.avatarUrl?e.jsx("img",{src:r.user_info.avatarUrl,alt:"Avatar",className:"w-20 h-20 md:w-24 md:h-24 rounded-full object-cover mb-2"}):e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-full bg-base-300 flex items-center justify-center mb-2",children:e.jsx(Ce,{className:"w-10 h-10 md:w-12 md:h-12 text-base-content/70"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-semibold text-base md:text-lg",children:((u=r==null?void 0:r.user_info)==null?void 0:u.username)??""}),e.jsx("p",{className:"text-xs md:text-sm text-base-content/70",children:((x=r==null?void 0:r.user_info)==null?void 0:x.first_name)??""})]})]}),e.jsxs("nav",{className:"flex flex-col items-start gap-2",children:[e.jsxs(C,{to:"/dashboard",onClick:c,className:`btn btn-ghost justify-start w-full ${s.pathname==="/dashboard"?"btn-active":""}`,children:[e.jsx(Ee,{className:"w-5 h-5 mr-2"})," Inicio"]}),e.jsxs(C,{to:"/dashboard/documentos/firmar",onClick:c,className:`btn btn-ghost justify-start w-full ${s.pathname==="/dashboard/documentos/firmar"?"btn-active":""}`,children:[e.jsx(ke,{className:"w-5 h-5 mr-2"})," ",e.jsx("span",{className:"text-start",children:"Documentos por Firmar"})]}),e.jsxs(C,{to:"/dashboard/perfil",onClick:c,className:`btn btn-ghost justify-start w-full ${s.pathname==="/dashboard/perfil"?"btn-active":""}`,children:[e.jsx(Pe,{className:"w-5 h-5 mr-2"})," Mi Perfil"]}),e.jsxs("button",{onClick:()=>{c(),m()},className:"btn btn-ghost text-error justify-start w-full",children:[e.jsx(De,{className:"w-5 h-5 mr-2"})," Cerrar Sesión"]})]})]}),e.jsx(Ie,{className:"flex-1 overflow-y-auto",children:e.jsx(Le,{})})]})},Z={updateProfile:async s=>(console.log(s),await cs({baseUrl:D,path:"/v1/global/users/session",body:s})),getProfile:async()=>G({baseUrl:D,path:"/v1/global/users/session"})},ws=q({first_name:b("Nombre requerido"),last_name_paterno:b("Apellido paterno requerido"),last_name_materno:b("Apellido materno requerido"),email:fe("Correo requerido"),phone:he("Debe ser un número de celular válido de 9 dígitos"),gender:b("Género requerido").oneOf(["f","m"],"Selecciona un género válido"),current_password:H(),new_password:H(),confirm_password:H().oneOf([re("new_password")],"Las nuevas contraseñas no coinciden")}),vs=()=>{const s=M({mutationFn:Z.updateProfile,onSuccess:()=>{W.success("Perfil actualizado exitosamente"),t.setValue("current_password",""),t.setValue("new_password",""),t.setValue("confirm_password","")},onError:()=>W.error("Error al actualizar el perfil")}),t=$(ws),{isLoading:r,isError:o,data:a,refetch:n}=ne({queryKey:["profile"],queryFn:Z.getProfile});d.useEffect(()=>{a!=null&&t.reset({email:a.email,first_name:a.first_name,gender:a.gender,last_name_materno:a.last_name_materno,last_name_paterno:a.last_name_paterno,phone:a.phone,current_password:"",new_password:"",confirm_password:""})},[a]);const i=m=>s.mutate(m);return r?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("span",{className:"loading loading-spinner loading-lg"})}):o?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen space-y-4",children:[e.jsx("p",{className:"text-lg font-semibold text-error",children:"No se pudo cargar tu perfil."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>n(),children:"Reintentar"})]}):e.jsxs("div",{className:"flex flex-col w-full h-full px-4 md:px-10 py-8 space-y-10",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Mi Perfil"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Actualiza tu información personal"})]}),e.jsxs("form",{onSubmit:t.handleSubmit(i),className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(j,{label:"Nombre",registration:t.register("first_name"),error:t.formState.errors.first_name}),e.jsx(j,{label:"Apellido paterno",registration:t.register("last_name_paterno"),error:t.formState.errors.last_name_paterno}),e.jsx(j,{label:"Apellido materno",registration:t.register("last_name_materno"),error:t.formState.errors.last_name_materno}),e.jsx(j,{label:"Correo electrónico",registration:t.register("email"),error:t.formState.errors.email}),e.jsx(j,{label:"Teléfono",registration:t.register("phone"),error:t.formState.errors.phone}),e.jsx(pe,{label:"Género",registration:t.register("gender"),error:t.formState.errors.gender,options:[{label:"Femenino",value:"f"},{label:"Masculino",value:"m"}]}),e.jsxs("div",{className:"md:col-span-2 pt-8 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Cambio de contraseña"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completa los campos si deseas actualizar tu contraseña."})]}),e.jsx(I,{label:"Contraseña actual",registration:t.register("current_password"),error:t.formState.errors.current_password}),e.jsx(I,{label:"Nueva contraseña",registration:t.register("new_password"),error:t.formState.errors.new_password}),e.jsx(I,{label:"Confirmar nueva contraseña",registration:t.register("confirm_password"),error:t.formState.errors.confirm_password})]}),e.jsx("div",{className:"md:col-span-2 flex justify-end",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:t.formState.isSubmitting,children:t.formState.isSubmitting?"Guardando...":"Guardar cambios"})})]})]})},J={getDocumentos:async s=>G({path:"/api/v1/public/documentos",abortSignal:s}),downloadPdf:async(s,t)=>await ls({path:`/api/v1/procesos/documentos/download/${s}`,progress:r=>t==null?void 0:t(r)}),signPDF:async s=>G({path:`/api/v1/public/sign/documento/${s}`})},Ss=()=>{const{openModal:s}=be(),{isMobile:t}=je();let r=Me();r??(r=window.innerHeight);const o=Q(),{pdfname:a,estado:n}=Fe(),[i,m]=d.useState(n==="published"),[c,l]=d.useState(!0),[u,x]=d.useState(null),[h,y]=d.useState(null),[_,w]=d.useState(null),[v,F]=d.useState(1),E=d.useRef(!1),k=M({mutationFn:J.signPDF,onSuccess:()=>{L.success("Documento firmado correctamente."),m(!1)},onError:g=>L.error(`Error al firmar el documento: ${g.message}`)}),P=async()=>{if(!a){alert("No se ha seleccionado ningún documento para firmar.");return}await s("Confirmar Firma","¿Estás seguro de que deseas firmar este documento?")&&k.mutate(a)};return d.useEffect(()=>{E.current||(E.current=!0,(async()=>{if(a==null){x("No PDF name provided"),l(!1);return}try{const g=await J.downloadPdf(a);y(new File([g],a,{type:"application/pdf"})),l(!1)}catch(g){x(g instanceof Error?g.message:"An unknown error occurred"),l(!1)}})())},[a]),c?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Loading..."}):u!=null?e.jsxs("div",{className:"flex items-center justify-center h-screen text-red-500",children:["Error: ",typeof u=="string"?u:u.message]}):h==null?e.jsx("div",{className:"flex items-center justify-center h-screen",children:"Unable to load PDF."}):e.jsxs("div",{className:S("w-full relative bg-base-100"),style:{height:t?r-72:r},children:[e.jsxs("div",{className:"absolute bg-black/20 w-full h-10 top-0 flex justify-between items-center px-4 z-10",children:[e.jsx(Re,{className:"w-5 h-5 cursor-pointer select-none",onClick:()=>o(-1)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>F(g=>Math.min(g+.1,3)),children:e.jsx(Ae,{className:"w-5 h-5"})}),e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>F(g=>Math.max(g-.1,.5)),children:e.jsx(Oe,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-auto flex flex-col items-center gap-4 h-full pt-10",children:e.jsx(ae,{file:h,onLoadSuccess:({numPages:g})=>w(g),loading:"Loading PDF...",error:"Error while loading PDF",className:"flex flex-col items-center w-full",children:Array.from(new Array(_),(g,R)=>e.jsx(oe,{pageNumber:R+1,width:t?window.innerWidth:800,scale:v,className:"shadow-md rounded-lg border border-base-300"},`page_${R+1}`))})}),i&&e.jsx("div",{className:"absolute bottom-0 h-20 w-full flex justify-center items-center gap-4 z-[9999]",children:e.jsx("button",{className:"btn btn-primary flex items-center gap-2",onClick:P,disabled:c,children:k.isPending?e.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Firmando..."})}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Firmar Documento"}),e.jsx(Te,{})]})})})]})},ee=800;function _s(){const[s,t]=d.useState("./sample.pdf"),[r,o]=d.useState(),[a]=d.useState(),n=m=>{var l;const c=(l=m.target.files)==null?void 0:l[0];c&&t(c)},i=({numPages:m})=>{o(m)};return e.jsxs("div",{children:[e.jsx("header",{children:e.jsx("h1",{children:"react-pdf sample"})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"file",children:"Load PDF:"}),e.jsx("input",{type:"file",onChange:n}),e.jsx("div",{style:{border:"2px solid #000",padding:"10px"},children:e.jsx(ae,{file:s,onLoadSuccess:i,children:Array.from({length:r??0},(m,c)=>e.jsx(oe,{pageNumber:c+1,width:a?Math.min(a,ee):ee},c))})})]})]})}const Cs=({initialOffset:s=0,initialLimit:t=1,total:r,onUpdate:o})=>{const[a,n]=d.useState(s),[i,m]=d.useState(t),[c,l]=d.useState(!1),[u,x]=d.useState(""),h=d.useRef(null),y=a+1,_=Math.min(a+i,r),w=i>1?`${y}-${_}`:`${y}`;d.useEffect(()=>{const f=p=>{h.current&&!h.current.contains(p.target)&&P()};return c&&document.addEventListener("mousedown",f,{capture:!0}),()=>document.removeEventListener("mousedown",f)},[c]);const v=(f,p,A)=>Math.max(Math.min(f,A),p),F=f=>{const[p,A]=f.trim().split(/[-,;\s]+/);let O=parseInt(p,10),z=A?parseInt(A,10):O;return O=v(O,1,r),z=v(z,1,r),{minimum:O-1,maximum:z}},E=(f,p)=>{n(f),m(p),o({offset:f,limit:p}),l(!1)},k=f=>{let p=a+i*f;p>=r?p=0:p<0&&i===1?p=r-1:p<0&&i>1&&(p=r-(r%i||i)),E(p,i)},P=()=>{const{minimum:f,maximum:p}=F(u);!isNaN(f)&&!isNaN(p)&&f<p?E(f,p-f):l(!1)},g=f=>{x(f.target.value)},R=f=>{f.key==="Enter"?(f.preventDefault(),P()):f.key==="Escape"&&(f.preventDefault(),l(!1))},Ne=()=>{c||(x(w),l(!0),setTimeout(()=>{var f;return(f=h.current)==null?void 0:f.focus()},0))};return e.jsxs("nav",{className:"flex gap-2 h-full items-center my-2","aria-label":"Pager",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[c?e.jsx("input",{ref:h,type:"text",className:"text-sm h-5 p-0 m-0 text-end outline-none input-sm",value:u,onBlur:P,onChange:g,onKeyDown:R}):e.jsx("span",{className:"text-sm border-transparent cursor-pointer",onClick:Ne,children:w}),e.jsx("span",{className:"text-sm",children:"/"}),e.jsx("span",{className:"text-sm",children:r})]}),e.jsxs("span",{className:"btn-group flex gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm","aria-label":"Previous",onClick:()=>k(-1),children:e.jsx(qe,{})}),e.jsx("button",{type:"button",className:"btn btn-sm","aria-label":"Next",onClick:()=>k(1),children:e.jsx(Ue,{})})]})]})},Es=({table:s})=>e.jsx("thead",{className:"bg-gray-200 dark:bg-gray-800 border-b border-gray-300 dark:border-gray-700",children:s.getHeaderGroups().map(t=>e.jsx("tr",{children:t.headers.map(r=>{var o,a;return e.jsx("th",{className:S("px-4 py-3 font-semibold text-xs text-gray-600 dark:text-gray-200 uppercase tracking-wider",{"text-left":r.column.id!=="actions","text-center":r.column.id==="actions","text-right":["amount","price"].includes(r.column.id)}),children:r.isPlaceholder?null:typeof r.column.columnDef.header=="string"?r.column.columnDef.header:(a=(o=r.column.columnDef).header)==null?void 0:a.call(o,r.getContext())},r.id)})},t.id))}),ks=({error:s,onRetry:t,columns:r})=>e.jsx("tr",{children:e.jsxs("td",{colSpan:r.length,className:"p-6 text-center text-red-500 dark:text-red-400",children:[e.jsx("div",{children:typeof s=="string"?s:s.message}),t&&e.jsx("button",{onClick:t,className:"mt-2 px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/80",children:"Intentar nuevamente"})]})}),ye=d.createContext(null),Ps=()=>{const s=d.useContext(ye);if(!s)throw new Error("useContextMenu must be used inside ContextMenuProvider");return s};function Ds({table:s,onRowClick:t,onRowDoubleClick:r,contextMenuAcctions:o}){const a=d.useRef(null),{openContextMenu:n}=Ps(),[i,m]=d.useState(null),c=(l,u)=>x=>{if(o==null)return;let h=[];typeof o=="function"?h=o(l):h=o,h.length!==0&&(m(u),n(x,h,l))};return e.jsx(e.Fragment,{children:s.getRowModel().rows.map(l=>{const u=l.id;return e.jsx("tr",{onClick:()=>{m(u),t==null||t(l.original)},onDoubleClick:()=>r==null?void 0:r(l.original),className:S("hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition-all duration-200 relative",{"bg-primary/10 dark:bg-primary/20":l.getIsSelected(),"bg-primary/5 dark:bg-primary/10":i===u&&!l.getIsSelected(),"after:content-[''] after:absolute after:inset-y-0 after:left-0 after:w-1 after:bg-primary":i===u}),onContextMenu:x=>c(l.original,u)(x),onTouchStart:x=>{a.current=setTimeout(()=>{c(l.original,u)(x)},500)},onTouchEnd:()=>{a.current&&clearTimeout(a.current)},children:l.getVisibleCells().map(x=>e.jsx("td",{className:S("px-4 py-3 text-sm text-gray-700 dark:text-gray-300 border-b border-gray-200 dark:border-gray-700","select-none",{"text-left":x.column.id!=="actions","text-center":x.column.id==="actions","text-right":["amount","price"].includes(x.column.id)}),children:$e(x.column.columnDef.cell,x.getContext())},x.id))},u)})})}function Is({data:s,columns:t,loading:r=!1,error:o,rowSelectionEnabled:a=!1,onRowClick:n,onRowDoubleClick:i,getRowId:m,onRetry:c,contextMenuAcctions:l}){const[u,x]=d.useState({}),h=ze({data:s,columns:t,state:{rowSelection:u},enableRowSelection:a,getRowId:m?y=>m(y):void 0,getCoreRowModel:Ve(),onRowSelectionChange:x});return e.jsx("div",{className:S("overflow-x-auto border border-gray-200 dark:border-gray-700 rounded-md shadow-lg"),children:e.jsxs("table",{className:"w-full table-auto text-sm text-gray-700 dark:text-gray-300",children:[e.jsx(Es,{table:h}),e.jsx("tbody",{children:r?e.jsx("tr",{children:e.jsx("td",{colSpan:t.length,className:"p-6 text-center text-gray-500 dark:text-gray-400",children:"Cargando..."})}):o?e.jsx(ks,{error:o,onRetry:c,columns:t}):e.jsx(Ds,{table:h,onRowClick:n,onRowDoubleClick:i,contextMenuAcctions:l})})]})})}const Ls=({onSearch:s})=>{const[t,r]=d.useState(""),o=()=>{s&&s(t)},a=n=>{n.key==="Enter"&&o()};return e.jsxs("div",{className:"mb-4 flex justify-center",children:[e.jsxs("div",{className:"relative w-full max-w-xs",children:[e.jsx("input",{type:"text",className:S("w-full","input-sm","pl-10","pr-4","py-2","rounded-md","border","border-gray-300","bg-transparent","text-gray-800","dark:text-gray-200","dark:border-gray-700","dark:focus:ring-0","focus:outline-none","focus:ring-2","focus:ring-gray-400","focus:border-gray-400","dark:focus:ring-gray-500","dark:focus:border-gray-500"),placeholder:"Search...",value:t,onChange:n=>r(n.target.value),onKeyDown:a}),e.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 dark:text-gray-400",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 18l6-6-6-6"})})})]}),e.jsx("button",{type:"button",onClick:o,className:S("ml-2","px-2","py-2","btn","btn-sm","h-[36px]","filter-reset","border","border-gray-300","bg-transparent","text-gray-800","dark:text-gray-200","dark:border-gray-700","dark:focus:ring-0","focus:outline-none","focus:ring-2","focus:ring-gray-400","focus:border-gray-400","dark:focus:ring-gray-500","dark:focus:border-gray-500"),children:e.jsx(He,{})})]})},Ms=s=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.title&&e.jsx("h2",{className:"text-2xl font-semibold",children:s.title}),s.onSearch&&e.jsx(Ls,{onSearch:s.onSearch})]})}),e.jsx(Is,{...s}),s.pageProps&&e.jsx("div",{className:"flex justify-end",children:e.jsx(Cs,{initialLimit:s.pageProps.initialLimit,initialOffset:s.pageProps.initialOffset,total:s.pageProps.total,onUpdate:s.pageProps.onUpdate})})]}),Fs=s=>{const t=Be();return s(t)},Rs=s=>{const t=d.useMemo(()=>["LISTA/DOCUMENTOS",s],[s]),r=We(),{data:o,error:a,isFetching:n,isError:i}=ne({queryKey:t,queryFn:({signal:c})=>J.getDocumentos(c)});return{documentos:o??[],refresh:()=>r.invalidateQueries({queryKey:t}),isFetching:n,error:a,isError:i}},se=s=>(s??"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();function As(s,t){const r=se(String(t??"").trim());return r.length<2?s:s.filter(o=>Object.entries(o).some(([a,n])=>{if(n==null)return!1;let i=se(String(n));return typeof n=="number"&&(i=`#${i}`),a.endsWith("codigo")&&!i.startsWith("#")&&(i=`.${i}`),i.includes(r)}))}const Os=s=>{const[t,r]=d.useState("");return[d.useMemo(()=>!s||!t.trim()?s??[]:t.split(";").map(n=>n.trim()).filter(Boolean).reduce((n,i)=>As(n,i),s),[s,t]),r]},Ts={"01":"Enero","02":"Febrero","03":"Marzo","04":"Abril","05":"Mayo","06":"Junio","07":"Julio","08":"Agosto","09":"Septiembre",10:"Octubre",11:"Noviembre",12:"Diciembre"},qs=Fs(s=>[s.accessor("descripcion_proceso",{header:"Descripción del Proceso",cell:({getValue:t})=>t()}),s.accessor("anio",{header:"Año",cell:({getValue:t})=>t()}),s.accessor("mes",{header:"Mes",cell:({getValue:t})=>{const r=t();return r==null||typeof r!="string"?r:Ts[r]}}),s.accessor("item",{header:"Semana",cell:({getValue:t})=>t()}),s.accessor("estado",{header:"Estado",cell:({getValue:t})=>{const r=t();let o,a,n;switch(r){case"published":o=e.jsx(Qe,{className:"w-5 h-5"}),a="bg-green-500 text-white",n="Pendiente";break;case"signed":o=e.jsx(Je,{className:"w-5 h-5"}),a="bg-blue-500 text-white",n="Firmado";break;case"canceled":o=e.jsx(Ge,{className:"w-5 h-5"}),a="bg-red-500 text-white",n="Cancelado";break;default:o=null,a="bg-gray-500 text-white",n="-"}return e.jsxs("div",{className:`max-w-[150px] grid items-center grid-cols-[1fr_3fr] p-2 rounded-lg ${a} dark:bg-opacity-20`,children:[e.jsx("p",{children:o}),e.jsx("p",{children:n})]})}})]),te=({tosign:s})=>{const t=Q(),{documentos:r,isFetching:o,error:a,refresh:n}=Rs(),i=d.useMemo(()=>s?r.filter(l=>l.estado=="published"):r,[s,r]),[m,c]=Os(i);return e.jsx("div",{className:"p-4 md:p-8",children:e.jsx(Ms,{title:"Lista de documentos",loading:o,error:a,onRetry:n,columns:qs,data:m,onSearch:c,contextMenuAcctions:l=>[{label:"Ver Documeto",onClick:()=>{if(l.signed_pdf_name!=null){t(`/dashboard/pdf/${l.signed_pdf_name}/${l.estado}`);return}if(l.nombre_pdf!=null){t(`/dashboard/pdf/${l.nombre_pdf}/${l.estado}`);return}}}],onRowDoubleClick:l=>{if(l.signed_pdf_name!=null){t(`/dashboard/pdf/${l.signed_pdf_name}/${l.estado}`);return}if(l.nombre_pdf!=null){t(`/dashboard/pdf/${l.nombre_pdf}/${l.estado}`);return}}})})},Us=({children:s})=>{const{user:t}=U();return!!t?s:e.jsx(K,{to:"/login",replace:!0})},B=({children:s})=>{const{user:t}=U();return!!t?e.jsx(K,{to:"/dashboard",replace:!0}):s},$s=()=>e.jsx(Ke,{children:e.jsxs(Xe,{children:[e.jsx(N,{path:"/login",element:e.jsx(B,{children:e.jsx(ps,{})})}),e.jsx(N,{path:"/register",element:e.jsx(B,{children:e.jsx(bs,{})})}),e.jsx(N,{path:"/recover",element:e.jsx(B,{children:e.jsx(ys,{})})}),e.jsxs(N,{path:"/dashboard",element:e.jsx(Us,{children:e.jsx(Ns,{})}),children:[e.jsx(N,{index:!0,element:e.jsx(te,{})}),e.jsx(N,{path:"pdf/:pdfname/:estado",element:e.jsx(Ss,{})}),e.jsx(N,{path:"documentos/firmar",element:e.jsx(te,{tosign:!0})}),e.jsx(N,{path:"perfil",element:e.jsx(vs,{})}),e.jsx(N,{path:"sample",element:e.jsx(_s,{})})]}),e.jsx(N,{path:"*",element:e.jsx(K,{to:"/login",replace:!0})})]})}),zs=({children:s})=>{const[t,r]=d.useState(()=>{try{const n=localStorage.getItem("session");if(n==null)return null;const i=localStorage.getItem("last_token_used");if(i!=null){const m=new Date(i),c=new Date;if(!isNaN(m.getTime())&&c.getTime()-m.getTime()>18e6)return localStorage.removeItem("session"),null}return n?JSON.parse(n):null}catch(n){return console.error("Error retrieving session data from localStorage",n),null}}),o=n=>{r(n),localStorage.setItem("session",JSON.stringify(n))},a=()=>{r(null),localStorage.removeItem("session")};return e.jsx(ie.Provider,{value:{user:t,login:o,logout:a},children:s})},Vs=({children:s})=>{const[t,r]=d.useState(!1),[o,a]=d.useState(()=>{}),[n,i]=d.useState("Confirmación"),[m,c]=d.useState("¿Estás seguro de esta acción?"),l=(_,w)=>(r(!0),i(_),c(w),new Promise(v=>a(()=>v))),u=()=>{r(!1)},x=()=>{o(!0),u()},h=()=>{o(!1),u()},y=()=>t?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{className:"bg-base-100 p-6 rounded-lg shadow-lg w-full max-w-sm",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:n}),e.jsx("p",{className:"text-base-content/80 mb-6",children:m}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{className:"btn btn-ghost",onClick:h,children:"Cancelar"}),e.jsx("button",{className:"btn btn-primary",onClick:x,children:"Confirmar"})]})]})}):null;return e.jsx(ge.Provider,{value:{openModal:l},children:e.jsxs(e.Fragment,{children:[e.jsx(y,{}),s]})})},Hs=({children:s})=>{const[t,r]=d.useState({isOpen:!1,x:0,y:0,items:[]}),o=d.useCallback((n,i,m)=>{n.preventDefault();let c=0,l=0;"touches"in n&&n.touches.length>0?(c=n.touches[0].clientX,l=n.touches[0].clientY):"clientX"in n&&(c=n.clientX,l=n.clientY);const u=10,x=180,h=200,y=window.innerWidth,_=window.innerHeight;let w=c,v=l;c+x+u>y&&(w=y-x-u),l+h+u>_&&(v=_-h-u),r({isOpen:!0,x:w,y:v,items:i,data:m})},[]),a=d.useCallback(()=>{r(n=>({...n,isOpen:!1}))},[]);return d.useEffect(()=>{const n=()=>{a()};return window.addEventListener("click",n),window.addEventListener("scroll",n),()=>{window.removeEventListener("click",n),window.removeEventListener("scroll",n)}},[a]),e.jsxs(ye.Provider,{value:{openContextMenu:o,closeContextMenu:a,state:t},children:[s,t.isOpen&&e.jsx("div",{className:"absolute  min-w-[180px] rounded-md shadow-md border border-base-300 bg-base-100 text-base-content z-50 overflow-hidden",style:{top:t.y,left:t.x},onClick:n=>n.stopPropagation(),children:t.items.map((n,i)=>{const m=n.icon,c=n.disabled;return e.jsxs("button",{onClick:()=>{c||n.onClick(t.data),a()},className:`flex items-center gap-2 w-full text-left px-4 py-2 text-sm ${c?"cursor-not-allowed text-base-content/50 hover:bg-transparent":"hover:bg-base-200"}`,disabled:c,children:[m&&e.jsx(m,{className:`w-4 h-4 ${c?"opacity-50":""}`}),e.jsx("span",{className:"select-none",children:n.label})]},i)})})]})};rs.workerSrc=new URL("/assets/pdf.worker.min-GB3t0DcA.mjs",import.meta.url).toString();const Bs=new Ye;Ze.createRoot(document.getElementById("root")).render(e.jsx(d.StrictMode,{children:e.jsxs(Hs,{children:[e.jsx(es,{}),e.jsx(Vs,{children:e.jsxs(ss,{client:Bs,children:[e.jsx(zs,{children:e.jsx($s,{})}),e.jsx(ts,{initialIsOpen:!1})]})})]})}));
